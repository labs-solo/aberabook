"use strict";(self.webpackChunkstrapi_docs=self.webpackChunkstrapi_docs||[]).push([[1772,2642],{3905:(e,t,a)=>{a.d(t,{Zo:()=>s,kt:()=>u});var n=a(67294);function i(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function o(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function r(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?o(Object(a),!0).forEach((function(t){i(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):o(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,i=function(e,t){if(null==e)return{};var a,n,i={},o=Object.keys(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||(i[a]=e[a]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(n=0;n<o.length;n++)a=o[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(i[a]=e[a])}return i}var p=n.createContext({}),d=function(e){var t=n.useContext(p),a=t;return e&&(a="function"==typeof e?e(t):r(r({},t),e)),a},s=function(e){var t=d(e.components);return n.createElement(p.Provider,{value:t},e.children)},c={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},m=n.forwardRef((function(e,t){var a=e.components,i=e.mdxType,o=e.originalType,p=e.parentName,s=l(e,["components","mdxType","originalType","parentName"]),m=d(a),u=i,g=m["".concat(p,".").concat(u)]||m[u]||c[u]||o;return a?n.createElement(g,r(r({ref:t},s),{},{components:a})):n.createElement(g,r({ref:t},s))}));function u(e,t){var a=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=a.length,r=new Array(o);r[0]=m;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var d=2;d<o;d++)r[d]=a[d];return n.createElement.apply(null,r)}return n.createElement.apply(null,a)}m.displayName="MDXCreateElement"},46033:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>d,contentTitle:()=>l,default:()=>k,frontMatter:()=>r,metadata:()=>p,toc:()=>s});var n=a(83117),i=(a(67294),a(3905)),o=a(14188);const r={title:"DigitalOcean App Platform",description:"Learn in this guide how to deploy your Strapi application on DigitalOcean App Platform.",displayed_sidebar:"devDocsSidebar"},l="Deploy to the DigitalOcean App Platform",p={unversionedId:"dev-docs/deployment/digitalocean-app-platform",id:"dev-docs/deployment/digitalocean-app-platform",title:"DigitalOcean App Platform",description:"Learn in this guide how to deploy your Strapi application on DigitalOcean App Platform.",source:"@site/docs/dev-docs/deployment/digitalocean-app-platform.md",sourceDirName:"dev-docs/deployment",slug:"/dev-docs/deployment/digitalocean-app-platform",permalink:"/aberabook/dev-docs/deployment/digitalocean-app-platform",draft:!1,editUrl:"https://github.com/labs-solo/aberabook/edit/main/docusaurus/docs/dev-docs/deployment/digitalocean-app-platform.md",tags:[],version:"current",frontMatter:{title:"DigitalOcean App Platform",description:"Learn in this guide how to deploy your Strapi application on DigitalOcean App Platform.",displayed_sidebar:"devDocsSidebar"},sidebar:"devDocsSidebar",previous:{title:"Azure Deployment",permalink:"/aberabook/dev-docs/deployment/azure"},next:{title:"DigitalOcean Droplet Deployment",permalink:"/aberabook/dev-docs/deployment/digitalocean"}},d={},s=[{value:"Prepare the deployment",id:"prepare-the-deployment",level:2},{value:"Setup a Strapi project for deployment",id:"setup-a-strapi-project-for-deployment",level:2},{value:"Create and configure a DigitalOcean App",id:"create-and-configure-a-digitalocean-app",level:2},{value:"Create a DigitalOcean App",id:"create-a-digitalocean-app",level:3},{value:"Connect an App to a database",id:"connect-an-app-to-a-database",level:3},{value:"Add environment variables",id:"add-environment-variables",level:3},{value:"Deploy and access a Strapi application",id:"deploy-and-access-a-strapi-application",level:2},{value:"Add a managed database",id:"add-a-managed-database",level:2},{value:"Modify the Strapi application",id:"modify-the-strapi-application",level:3},{value:"Create a managed database on DigitalOcean",id:"create-a-managed-database-on-digitalocean",level:3},{value:"Attach the managed database to an App",id:"attach-the-managed-database-to-an-app",level:3},{value:"Configure environment variables for production-ready managed database",id:"configure-environment-variables-for-production-ready-managed-database",level:3}],c=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,i.kt)("div",t)},m=c("Tabs"),u=c("TabItem"),g={toc:s};function k(e){let{components:t,...a}=e;return(0,i.kt)("wrapper",(0,n.Z)({},g,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"deploy-to-the-digitalocean-app-platform"},"Deploy to the DigitalOcean App Platform"),(0,i.kt)("p",null,"The purpose of this guide is to allow users to deploy Strapi applications on the DigitalOcean App Platform. This guide uses the PostgreSQL development database provided by DigitalOcean, so applications can be tested in a deployed environment. At the end of the guide there is information on how to connect a Strapi application to a DigitalOcean Managed Database. Additional information about ",(0,i.kt)("a",{parentName:"p",href:"https://docs.digitalocean.com/products/databases/postgresql/how-to/import-databases/"},"migrating local database content to a production database")," and other deployment topics are provided in the ",(0,i.kt)("a",{parentName:"p",href:"https://docs.digitalocean.com/"},"DigitalOcean documentation"),"."),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"Strapi maintains deployment guides to assist users in deploying projects. Since there are frequent updates to Strapi and to the hosting provider platforms, the guides are sometimes out of date. If you encounter an issue deploying your project following this guide, please ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/strapi/documentation/issues"},"open an issue on GitHub")," or ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/strapi/documentation/pulls"},"submit a pull request")," to improve the documentation.")),(0,i.kt)(o.default,{mdxType:"ConsiderStrapiCloud"}),(0,i.kt)("h2",{id:"prepare-the-deployment"},"Prepare the deployment"),(0,i.kt)("p",null,"Prior to starting the deployment process each user needs:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"a DigitalOcean account (",(0,i.kt)("a",{parentName:"li",href:"https://try.digitalocean.com/strapi/"},"The Strapi referral link for DigitalOcean provides $200 in credits."),"),"),(0,i.kt)("li",{parentName:"ul"},"a ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/join"},"GitHub account")," and ",(0,i.kt)("a",{parentName:"li",href:"https://docs.github.com/en/get-started/quickstart/set-up-git"},"Git version control"),","),(0,i.kt)("li",{parentName:"ul"},"an existing Strapi application.")),(0,i.kt)("h2",{id:"setup-a-strapi-project-for-deployment"},"Setup a Strapi project for deployment"),(0,i.kt)("p",null,"Strapi uses ",(0,i.kt)("a",{parentName:"p",href:"/aberabook/dev-docs/configurations/environment"},"environment configurations")," to maintain multiple environments inside a single application. This section describes how to setup a production environment in a Strapi application."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Add a production configuration environment by creating a sub-directory ",(0,i.kt)("inlineCode",{parentName:"li"},"./config/env/production"),"."),(0,i.kt)("li",{parentName:"ol"},"Create ",(0,i.kt)("inlineCode",{parentName:"li"},"database.js")," inside the ",(0,i.kt)("inlineCode",{parentName:"li"},"./config/env/production")," directory."),(0,i.kt)("li",{parentName:"ol"},"Add the code snippet to the ",(0,i.kt)("inlineCode",{parentName:"li"},"database")," configuration file:")),(0,i.kt)(m,{groupId:"js-ts",mdxType:"Tabs"},(0,i.kt)(u,{value:"javascript",label:"JavaScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="./config/env/production/database.js"',title:'"./config/env/production/database.js"'},"\n    module.exports = ({ env }) => ({\n      connection: {\n        client: 'postgres',\n        connection: {\n          host: env('DATABASE_HOST'),\n          port: env.int('DATABASE_PORT'),\n          database: env('DATABASE_NAME'),\n          user: env('DATABASE_USERNAME'),\n          password: env('DATABASE_PASSWORD'),\n          ssl: {\n            rejectUnauthorized:env.bool('DATABASE_SSL_SELF', false),\n          },\n        },\n        debug: false,\n      },\n    });\n"))),(0,i.kt)(u,{value:"typescript",label:"TypeScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="./config/env/production/database.ts"',title:'"./config/env/production/database.ts"'},"\n    export default ({ env }) => ({\n      connection: {\n        client: 'postgres',\n        connection: {\n          host: env('DATABASE_HOST'), \n          port: env.int('DATABASE_PORT'), \n          database: env('DATABASE_NAME'), \n          user: env('DATABASE_USERNAME'), \n          password: env('DATABASE_PASSWORD'),\n          ssl: {\n            rejectUnauthorized:env.bool('DATABASE_SSL_SELF', false),\n          },\n        },\n        debug: false,\n      },\n    });\n")))),(0,i.kt)("ol",{start:4},(0,i.kt)("li",{parentName:"ol"},"Create ",(0,i.kt)("inlineCode",{parentName:"li"},"server.js")," inside the ",(0,i.kt)("inlineCode",{parentName:"li"},"./config/env/production")," directory."),(0,i.kt)("li",{parentName:"ol"},"Add the code snippet to the ",(0,i.kt)("inlineCode",{parentName:"li"},"server")," configuration file:")),(0,i.kt)(m,{groupId:"js-ts",mdxType:"Tabs"},(0,i.kt)(u,{value:"javascript",label:"JavaScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="./config/env/production/server.js"',title:'"./config/env/production/server.js"'},"\n    module.exports = ({ env }) => ({\n        proxy: true,\n        url: env('APP_URL'), // Sets the public URL of the application.\n        app: { \n          keys: env.array('APP_KEYS')\n        },\n    });\n"))),(0,i.kt)(u,{value:"typescript",label:"TypeScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="./config/env/production/server.ts"',title:'"./config/env/production/server.ts"'},"\nexport default ({ env }) => ({\n        proxy: true,\n        url: env('APP_URL'), // Sets the public URL of the application.\n        app: { \n          keys: env.array('APP_KEYS')\n        },\n    });\n")))),(0,i.kt)("ol",{start:6},(0,i.kt)("li",{parentName:"ol"},"Add PostgreSQL dependencies by installing ",(0,i.kt)("a",{parentName:"li",href:"https://www.npmjs.com/package/pg"},(0,i.kt)("inlineCode",{parentName:"a"},"pg")," package"),":")),(0,i.kt)(m,{groupId:"yarn-npm",mdxType:"Tabs"},(0,i.kt)(u,{value:"yarn",label:"yarn",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"yarn add pg\n"))),(0,i.kt)(u,{value:"npm",label:"npm",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"npm install pg\n")))),(0,i.kt)("ol",{start:7},(0,i.kt)("li",{parentName:"ol"},"Verify that all of the new and modified files are saved locally."),(0,i.kt)("li",{parentName:"ol"},"Commit the project to a remote repository:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-sh"},'git add .\ngit commit -m "commit message"\ngit push\n')),(0,i.kt)("h2",{id:"create-and-configure-a-digitalocean-app"},"Create and configure a DigitalOcean App"),(0,i.kt)("p",null,"Deploying on the DigitalOcean App Platform requires creating an App, connecting the App to a development database, and setting environment variables. At the end of the following steps a Strapi application should be successfully deployed."),(0,i.kt)("h3",{id:"create-a-digitalocean-app"},"Create a DigitalOcean App"),(0,i.kt)("p",null,"From the DigitalOcean website create and App and connect it to a GitHub repository:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"Create")," button and select ",(0,i.kt)("em",{parentName:"li"},"Apps"),"."),(0,i.kt)("li",{parentName:"ol"},"Select GitHub and authorize access to the correct repository."),(0,i.kt)("li",{parentName:"ol"},"Select the branch."),(0,i.kt)("li",{parentName:"ol"},"(optional) Select the source directory."),(0,i.kt)("li",{parentName:"ol"},'Choose whether or not to "Autodeploy" when an update is pushed to the GitHub repository.'),(0,i.kt)("li",{parentName:"ol"},"Click the ",(0,i.kt)("strong",{parentName:"li"},"Next")," button.")),(0,i.kt)("h3",{id:"connect-an-app-to-a-database"},"Connect an App to a database"),(0,i.kt)("p",null,"After creating an App attach a development database. To add a development database on the following screen:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Click ",(0,i.kt)("strong",{parentName:"li"},"Add Resource"),"."),(0,i.kt)("li",{parentName:"ol"},"Select ",(0,i.kt)("em",{parentName:"li"},"Database")," and click ",(0,i.kt)("strong",{parentName:"li"},"Add"),"."),(0,i.kt)("li",{parentName:"ol"},"Select ",(0,i.kt)("em",{parentName:"li"},"Dev Database"),' and name the database. The default database name is "db" and is used to prefix the database values in the ',(0,i.kt)("a",{parentName:"li",href:"#add-environment-variables"},"global environment table"),'. If another database name is used, it should be substituted for "db".'),(0,i.kt)("li",{parentName:"ol"},"Click the ",(0,i.kt)("strong",{parentName:"li"},"Create and Attach")," button."),(0,i.kt)("li",{parentName:"ol"},"Click the ",(0,i.kt)("strong",{parentName:"li"},"Next")," button to set the Environment Variables (Env Vars).")),(0,i.kt)("h3",{id:"add-environment-variables"},"Add environment variables"),(0,i.kt)("p",null,"In the DigitalOcean App Platform there are Global and Component-level environment variables. Strapi applications in production need Global-level variables to set the database connection, and can use either Component or Global-level variables for secrets storage. The following procedure is to add the database variables at the Global level and store the Strapi secrets at the Component level."),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Add the database, URL, and NODE_ENV variables to the global environment table:"),(0,i.kt)("table",{parentName:"li"},(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Variable name"),(0,i.kt)("th",{parentName:"tr",align:null},"Value"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"APP_URL")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"${APP_URL}"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"DATABASE_HOST")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"${db.HOSTNAME}"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"DATABASE_PORT")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"${db.PORT}"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"DATABASE_NAME")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"${db.DATABASE}"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"DATABASE_USERNAME")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"${db.USERNAME}"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"DATABASE_PASSWORD")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"${db.PASSWORD}"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"NODE_ENV")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"production"))))),(0,i.kt)("admonition",{parentName:"li",type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"You can use the ",(0,i.kt)("strong",{parentName:"p"},"Bulk Editor")," button in the App Platform to add the preceding variables by copying and pasting the following code block:"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"APP_URL=${APP_URL}\nDATABASE_HOST=${db.HOSTNAME}\nDATABASE_PORT=${db.PORT}\nDATABASE_NAME=${db.DATABASE}\nDATABASE_USERNAME=${db.USERNAME}\nDATABASE_PASSWORD=${db.PASSWORD}\nNODE_ENV=production\n")))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Add the key-value pairs for the Strapi secrets to the component environment variables table:"),(0,i.kt)("table",{parentName:"li"},(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Variable name"),(0,i.kt)("th",{parentName:"tr",align:null},"value"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"APP_KEYS")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},'"unique user-generated secrets here"'))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"API_TOKEN_SALT")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},'"unique user-generated secret here"'))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"ADMIN_JWT_SECRET")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},'"unique user-generated secret here"'))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"JWT_SECRET")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},'"unique user-generated secret here"'))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},"(optional)",(0,i.kt)("inlineCode",{parentName:"td"},"TRANSFER_TOKEN_SALT")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},'"unique user-generated secret here"')))))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Click ",(0,i.kt)("strong",{parentName:"p"},"Next"),"."))),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"It is possible to copy the secrets from the local ",(0,i.kt)("inlineCode",{parentName:"p"},".env")," file or to generate new secrets using a random secret generator. Examples can be found at ",(0,i.kt)("a",{parentName:"p",href:"https://www.openssl.org/"},"OpenSSL"),".")),(0,i.kt)("ol",{start:4},(0,i.kt)("li",{parentName:"ol"},"(optional) Edit the App name and Region and click ",(0,i.kt)("strong",{parentName:"li"},"Save")),(0,i.kt)("li",{parentName:"ol"},"Click ",(0,i.kt)("strong",{parentName:"li"},"Next"),"."),(0,i.kt)("li",{parentName:"ol"},"Click ",(0,i.kt)("strong",{parentName:"li"},"Create Resources")," to create the App and database.")),(0,i.kt)("h2",{id:"deploy-and-access-a-strapi-application"},"Deploy and access a Strapi application"),(0,i.kt)("p",null,"When the preceding steps are completed DigitalOcean should automatically try to build and deploy the application. The Strapi admin panel is accessed at ",(0,i.kt)("inlineCode",{parentName:"p"},"{your App domain}/admin")," once the application is successfully deployed."),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"If the build does not start, click the ",(0,i.kt)("strong",{parentName:"p"},"Actions")," button and select ",(0,i.kt)("em",{parentName:"p"},"force rebuild and deploy"),".")),(0,i.kt)("h2",{id:"add-a-managed-database"},"Add a managed database"),(0,i.kt)("p",null,"DigitalOcean managed databases are a production-scale database solution for a deployed Strapi application. Switching from a development database to a managed database requires modifying the Strapi application and modifying the settings on DigitalOcean:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"removing the development database and database environment variables,"),(0,i.kt)("li",{parentName:"ul"},"installing the ",(0,i.kt)("inlineCode",{parentName:"li"},"pg-connection-string")," dependency,"),(0,i.kt)("li",{parentName:"ul"},"changing the production ",(0,i.kt)("inlineCode",{parentName:"li"},"database")," configuration file,"),(0,i.kt)("li",{parentName:"ul"},"creating and attaching the database in the DigitalOcean platform.")),(0,i.kt)("h3",{id:"modify-the-strapi-application"},"Modify the Strapi application"),(0,i.kt)("p",null,"When a managed database is attached to a Strapi application, the connection parameters are passed directly from the database to the application ",(0,i.kt)("inlineCode",{parentName:"p"},".yaml")," file (",(0,i.kt)("em",{parentName:"p"},"App Spec")," in the DigitalOcean settings). This requires a modification to the ",(0,i.kt)("inlineCode",{parentName:"p"},"config/env/production/database")," file and the addition of the ",(0,i.kt)("inlineCode",{parentName:"p"},"pg-connection-string")," dependency."),(0,i.kt)("p",null,"To add the ",(0,i.kt)("inlineCode",{parentName:"p"},"pg-connection-string")," dependency navigate to the project directory and install ",(0,i.kt)("inlineCode",{parentName:"p"},"pg-connection-string"),":"),(0,i.kt)(m,{groupId:"yarn-npm",mdxType:"Tabs"},(0,i.kt)(u,{value:"yarn",label:"yarn",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"yarn add pg-connection-string\n"))),(0,i.kt)(u,{value:"npm",label:"npm",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"npm install pg-connection-string\n")))),(0,i.kt)("p",null,"To switch to a managed database modify the ",(0,i.kt)("inlineCode",{parentName:"p"},"config/env/production/database")," file to be able to parse the ",(0,i.kt)("inlineCode",{parentName:"p"},"DATABASE_URL"),":"),(0,i.kt)(m,{groupId:"js-ts",mdxType:"Tabs"},(0,i.kt)(u,{value:"javascript",label:"JavaScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="./config/env/production/database.js"',title:'"./config/env/production/database.js"'},"\nconst parse = require(\"pg-connection-string\").parse;\n\nconst { host, port, database, user, password } = parse(\n  process.env.DATABASE_URL\n);\n\nmodule.exports = ({ env }) => ({\n  connection: {  \n    client: 'postgres',\n    connection: {\n      host,\n      port,\n      database,\n      user,\n      password,\n      ssl: {\n        rejectUnauthorized: false,\n      },\n    },\n      debug: false,\n  },\n});\n\n"))),(0,i.kt)(u,{value:"typescript",label:"TypeScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="./config/env/production/database.ts"',title:'"./config/env/production/database.ts"'},"\nconst parse = require(\"pg-connection-string\").parse;\n\nconst { host, port, database, user, password } = parse(\n  process.env.DATABASE_URL\n);\n\nexport default ({ env }) => ({\n  connection: {  \n    client: 'postgres',\n    connection: {\n      host,\n      port,\n      database,\n      user,\n      password,\n      ssl: {\n        ca: env('DATABASE_CA'),\n      },\n    },\n      debug: false,\n  },\n});\n\n")))),(0,i.kt)("h3",{id:"create-a-managed-database-on-digitalocean"},"Create a managed database on DigitalOcean"),(0,i.kt)("p",null,"Changing the settings on the DigitalOcean App Platform to incorporate a managed database requires creating and attaching the database to an existing Strapi application. Additionally, the database environment variables must be removed, as managed databases propagate the connection properties automatically.  "),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"Create")," button from any DigitalOcean page and select ",(0,i.kt)("em",{parentName:"li"},"Databases"),"."),(0,i.kt)("li",{parentName:"ol"},"Select a location (use the same location as the application location)."),(0,i.kt)("li",{parentName:"ol"},"Select the PostgreSQL database engine."),(0,i.kt)("li",{parentName:"ol"},"Select a database configuration."),(0,i.kt)("li",{parentName:"ol"},"Click the ",(0,i.kt)("strong",{parentName:"li"},"Create a Database Cluster")," button.")),(0,i.kt)("h3",{id:"attach-the-managed-database-to-an-app"},"Attach the managed database to an App"),(0,i.kt)("p",null,"After creating the managed database, navigate to the application page:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"Create")," button and select ",(0,i.kt)("em",{parentName:"li"},"Create/Attach Database"),"."),(0,i.kt)("li",{parentName:"ol"},"Select ",(0,i.kt)("em",{parentName:"li"},"Previously Created DigitalOcean Database"),"."),(0,i.kt)("li",{parentName:"ol"},"Use the picklist to select the previously created database."),(0,i.kt)("li",{parentName:"ol"},"Click ",(0,i.kt)("strong",{parentName:"li"},"Attach Database"),".")),(0,i.kt)("h3",{id:"configure-environment-variables-for-production-ready-managed-database"},"Configure environment variables for production-ready managed database"),(0,i.kt)("p",null,"Remove the previously added 'DATABASE_*' global variables added for connecting to the dev database, then set the following environment variables, inserting your database name (e.g. ",(0,i.kt)("inlineCode",{parentName:"p"},"db-postgresql-nyc3-1234"),") in place of ",(0,i.kt)("inlineCode",{parentName:"p"},"dbClusterName"),":"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Variable name"),(0,i.kt)("th",{parentName:"tr",align:null},"Value"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"DATABASE_URL")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"${dbClusterName.DATABASE_URL}"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"DATABASE_CA")),(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"${dbClusterName.CA_CERT}"))))),(0,i.kt)("p",null,"After attaching the database, DigitalOcean will attempt to auto-deploy the application. If the deployment is successful a link to the application will be provided at the top of the application page."),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"The environmental variables for the development and managed database are handled differently by DigitalOcean. When connected to a managed database DigitalOcean passes the environmental variables automatically. If the App build fails due to database connection errors check the ",(0,i.kt)("inlineCode",{parentName:"p"},".yaml")," file (",(0,i.kt)("em",{parentName:"p"},"App Spec")," in the DigitalOcean Settings) to confirm the database settings are set at the top of the file and that there are no database environment variables in the file. If there are database environment variables, download the file, delete the environment variables and upload the edited file to DigitalOcean.")))}k.isMDXComponent=!0},14188:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>p,contentTitle:()=>r,default:()=>c,frontMatter:()=>o,metadata:()=>l,toc:()=>d});var n=a(83117),i=(a(67294),a(3905));const o={},r=void 0,l={unversionedId:"snippets/consider-strapi-cloud",id:"snippets/consider-strapi-cloud",title:"consider-strapi-cloud",description:"You can also use Strapi Cloud to quickly deploy and host your project.",source:"@site/docs/snippets/consider-strapi-cloud.md",sourceDirName:"snippets",slug:"/snippets/consider-strapi-cloud",permalink:"/aberabook/snippets/consider-strapi-cloud",draft:!1,editUrl:"https://github.com/labs-solo/aberabook/edit/main/docusaurus/docs/snippets/consider-strapi-cloud.md",tags:[],version:"current",frontMatter:{}},p={},d=[],s={toc:d};function c(e){let{components:t,...a}=e;return(0,i.kt)("wrapper",(0,n.Z)({},s,a,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("admonition",{title:"\u2601\ufe0f Strapi Cloud",type:"callout"},(0,i.kt)("p",{parentName:"admonition"},"You can also use ",(0,i.kt)("a",{parentName:"p",href:"/cloud/intro"},"Strapi Cloud")," to quickly deploy and host your project.")))}c.isMDXComponent=!0}}]);