"use strict";(self.webpackChunkstrapi_docs=self.webpackChunkstrapi_docs||[]).push([[9632],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>c});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,d=o(e,["components","mdxType","originalType","parentName"]),m=p(n),c=i,h=m["".concat(s,".").concat(c)]||m[c]||u[c]||r;return n?a.createElement(h,l(l({ref:t},d),{},{components:n})):a.createElement(h,l({ref:t},d))}));function c(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,l=new Array(r);l[0]=m;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:i,l[1]=o;for(var p=2;p<r;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},39754:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>g,frontMatter:()=>r,metadata:()=>o,toc:()=>p});var a=n(83117),i=(n(67294),n(3905));const r={title:"GraphQL",displayed_sidebar:"devDocsSidebar",toc_max_heading_level:5,description:"Use a GraphQL endpoint in your Strapi project to fetch and mutate your content."},l="GraphQL plugin",o={unversionedId:"dev-docs/plugins/graphql",id:"dev-docs/plugins/graphql",title:"GraphQL",description:"Use a GraphQL endpoint in your Strapi project to fetch and mutate your content.",source:"@site/docs/dev-docs/plugins/graphql.md",sourceDirName:"dev-docs/plugins",slug:"/dev-docs/plugins/graphql",permalink:"/aberabook/dev-docs/plugins/graphql",draft:!1,editUrl:"https://github.com/labs-solo/aberabook/edit/main/docusaurus/docs/dev-docs/plugins/graphql.md",tags:[],version:"current",frontMatter:{title:"GraphQL",displayed_sidebar:"devDocsSidebar",toc_max_heading_level:5,description:"Use a GraphQL endpoint in your Strapi project to fetch and mutate your content."},sidebar:"devDocsSidebar",previous:{title:"Email",permalink:"/aberabook/dev-docs/plugins/email"},next:{title:"Internationalization (i18n)",permalink:"/aberabook/dev-docs/plugins/i18n"}},s={},p=[{value:"Usage",id:"usage",level:2},{value:"Configuration",id:"configuration",level:2},{value:"Shadow CRUD",id:"shadow-crud",level:2},{value:"Customization",id:"customization",level:2},{value:"Disabling operations in the Shadow CRUD",id:"disabling-operations-in-the-shadow-crud",level:3},{value:"Using getters",id:"using-getters",level:3},{value:"Extending the schema",id:"extending-the-schema",level:3},{value:"Custom configuration for resolvers",id:"custom-configuration-for-resolvers",level:4},{value:"Authorization configuration",id:"authorization-configuration",level:5},{value:"Policies",id:"policies",level:5},{value:"Middlewares",id:"middlewares",level:5},{value:"Usage with the Users &amp; Permissions plugin",id:"usage-with-the-users--permissions-plugin",level:2},{value:"Registration",id:"registration",level:3},{value:"Authentication",id:"authentication",level:3},{value:"API tokens",id:"api-tokens",level:2},{value:"Security",id:"security",level:2},{value:"Disable playground in production",id:"disable-playground-in-production",level:3},{value:"Limit max depth and complexity",id:"limit-max-depth-and-complexity",level:3}],d=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,i.kt)("div",t)},u=d("Tabs"),m=d("TabItem"),c=d("Request"),h={toc:p};function g(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"graphql-plugin"},"GraphQL plugin"),(0,i.kt)("p",null,"By default Strapi create ",(0,i.kt)("a",{parentName:"p",href:"/dev-docs/api/rest#endpoints"},"REST endpoints")," for each of your content-types. With the GraphQL plugin, you will be able to add a GraphQL endpoint to fetch and mutate your content."),(0,i.kt)("p",null,":::strapi Looking for the GraphQL API documentation?\nThe ",(0,i.kt)("a",{parentName:"p",href:"/dev-docs/api/graphql"},"GraphQL API reference")," describes queries, mutations and parameters you can use to interact with your API using Strapi's GraphQL plugin.\n:::"),(0,i.kt)("h2",{id:"usage"},"Usage"),(0,i.kt)("p",null,"To get started with GraphQL in your application, please install the plugin first. To do that, open your terminal and run the following command:"),(0,i.kt)(u,{groupId:"yarn-npm",mdxType:"Tabs"},(0,i.kt)(m,{value:"yarn",label:"yarn",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"yarn strapi install graphql\n"))),(0,i.kt)(m,{value:"npm",label:"npm",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"npm run strapi install graphql\n")))),(0,i.kt)("p",null,"Then, start your app and open your browser at ",(0,i.kt)("a",{parentName:"p",href:"http://localhost:1337/graphql"},"http://localhost:1337/graphql"),". You should now be able to access the ",(0,i.kt)("strong",{parentName:"p"},"GraphQL Playground")," that will help you to write your GraphQL queries and mutations."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},"The GraphQL Playground is enabled by default for both the development and staging environments but disabled in production environments. Set the ",(0,i.kt)("inlineCode",{parentName:"li"},"playgroundAlways")," configuration option to ",(0,i.kt)("inlineCode",{parentName:"li"},"true")," to also enable the GraphQL Playground in production environments (see ",(0,i.kt)("a",{parentName:"li",href:"/dev-docs/configurations/plugins#graphql-configuration"},"plugins configuration documentation"),")."),(0,i.kt)("li",{parentName:"ul"},"If the GraphQL Playground does not appear to be accessible, please ensure that the GraphQL plugin is enabled: ",(0,i.kt)("inlineCode",{parentName:"li"},"graphql: true")," should be added to the ",(0,i.kt)("inlineCode",{parentName:"li"},"config/plugins.js|ts")," configuration file; if not, edit the file to add this line (see ",(0,i.kt)("a",{parentName:"li",href:"/dev-docs/configurations/plugins"},"plugins configuration")," for more details). "))),(0,i.kt)("h2",{id:"configuration"},"Configuration"),(0,i.kt)("p",null,"Plugins configuration are defined in the ",(0,i.kt)("inlineCode",{parentName:"p"},"config/plugins.js|ts")," file. This configuration file can include a ",(0,i.kt)("inlineCode",{parentName:"p"},"graphql.config")," object to define specific configurations for the GraphQL plugin (see ",(0,i.kt)("a",{parentName:"p",href:"/dev-docs/configurations/plugins#graphql-configuration"},"plugins configuration documentation"),")."),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"https://www.apollographql.com/docs/apollo-server/api/apollo-server/#apolloserver"},"Apollo Server")," options can be set with the ",(0,i.kt)("inlineCode",{parentName:"p"},"graphql.config.apolloServer")," ",(0,i.kt)("a",{parentName:"p",href:"/dev-docs/configurations/plugins#graphql-configuration"},"configuration object"),". Apollo Server options can be used for instance to enable the ",(0,i.kt)("a",{parentName:"p",href:"https://www.apollographql.com/docs/federation/metrics/"},"tracing feature"),", which is supported by the GraphQL playground to track the response time of each part of your query. From ",(0,i.kt)("inlineCode",{parentName:"p"},"Apollo Server")," version 3.9 default cache option is ",(0,i.kt)("inlineCode",{parentName:"p"},"cache: 'bounded'"),". You can change it in the ",(0,i.kt)("inlineCode",{parentName:"p"},"apolloServer")," configuration. For more information visit ",(0,i.kt)("a",{parentName:"p",href:"https://www.apollographql.com/docs/apollo-server/performance/cache-backends/"},"Apollo Server Docs"),"."),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"The maximum number of items returned by the response is limited to 100 by default. This value can be changed using the ",(0,i.kt)("inlineCode",{parentName:"p"},"defaultLimit")," configuration option, but should only be changed after careful consideration: a large query can cause a DDoS (Distributed Denial of Service) and may cause abnormal load on your Strapi server, as well as your database server.")),(0,i.kt)(u,{groupId:"js-ts",mdxType:"Tabs"},(0,i.kt)(m,{value:"javascript",label:"JavaScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="./config/plugins.js"',title:'"./config/plugins.js"'},"\nmodule.exports = {\n  //\n  graphql: {\n    config: {\n      endpoint: '/graphql',\n      shadowCRUD: true,\n      playgroundAlways: false,\n      depthLimit: 7,\n      amountLimit: 100,\n      apolloServer: {\n        tracing: false,\n      },\n    },\n  },\n};\n"))),(0,i.kt)(m,{value:"typescript",label:"TypeScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="./config/plugins.ts"',title:'"./config/plugins.ts"'},"\nexport default {\n  //\n  graphql: {\n    config: {\n      endpoint: '/graphql',\n      shadowCRUD: true,\n      playgroundAlways: false,\n      depthLimit: 7,\n      amountLimit: 100,\n      apolloServer: {\n        tracing: false,\n      },\n    },\n  },\n};\n")))),(0,i.kt)("h2",{id:"shadow-crud"},"Shadow CRUD"),(0,i.kt)("p",null,"To simplify and automate the build of the GraphQL schema, we introduced the Shadow CRUD feature. It automatically generates the type definitions, queries, mutations and resolvers based on your models."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Example:")),(0,i.kt)("p",null,"If you've generated an API called ",(0,i.kt)("inlineCode",{parentName:"p"},"Document")," using ",(0,i.kt)("a",{parentName:"p",href:"/dev-docs/cli#strapi-generate"},"the interactive ",(0,i.kt)("inlineCode",{parentName:"a"},"strapi generate")," CLI")," or the administration panel, your model looks like this:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="./src/api/[api-name]/content-types/document/schema.json"',title:'"./src/api/[api-name]/content-types/document/schema.json"'},'\n{\n  "kind": "collectionType",\n  "collectionName": "documents",\n  "info": {\n    "singularName": "document",\n    "pluralName": "documents",\n    "displayName": "document",\n    "name": "document"\n  },\n  "options": {\n    "draftAndPublish": true\n  },\n  "pluginOptions": {},\n  "attributes": {\n    "name": {\n      "type": "string"\n    },\n    "description": {\n      "type": "richtext"\n    },\n    "locked": {\n      "type": "boolean"\n    }\n  }\n}\n')),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Generated GraphQL type and queries"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-graphql"},"# Document's Type definition\ninput DocumentFiltersInput {\n  name: StringFilterInput\n  description: StringFilterInput\n  locked: BooleanFilterInput\n  createdAt: DateTimeFilterInput\n  updatedAt: DateTimeFilterInput\n  publishedAt: DateTimeFilterInput\n  and: [DocumentFiltersInput]\n  or: [DocumentFiltersInput]\n  not: DocumentFiltersInput\n}\n\ninput DocumentInput {\n  name: String\n  description: String\n  locked: Boolean\n  createdAt: DateTime\n  updatedAt: DateTime\n  publishedAt: DateTime\n}\n\ntype Document {\n  name: String\n  description: String\n  locked: Boolean\n  createdAt: DateTime\n  updatedAt: DateTime\n  publishedAt: DateTime\n}\n\ntype DocumentEntity {\n  id: ID\n  attributes: Document\n}\n\ntype DocumentEntityResponse {\n  data: DocumentEntity\n}\n\ntype DocumentEntityResponseCollection {\n  data: [DocumentEntity!]!\n  meta: ResponseCollectionMeta!\n}\n\ntype DocumentRelationResponseCollection {\n  data: [DocumentEntity!]!\n}\n\n# Queries to retrieve one or multiple restaurants.\ntype Query  {\n  document(id: ID): DocumentEntityResponse\n  documents(\n    filters: DocumentFiltersInput\n    pagination: PaginationArg = {}\n    sort: [String] = []\n    publicationState: PublicationState = LIVE\n):DocumentEntityResponseCollection\n}\n\n# Mutations to create, update or delete a restaurant.\ntype Mutation {\n  createDocument(data: DocumentInput!): DocumentEntityResponse\n  updateDocument(id: ID!, data: DocumentInput!): DocumentEntityResponse\n  deleteDocument(id: ID!): DocumentEntityResponse\n}\n"))),(0,i.kt)("h2",{id:"customization"},"Customization"),(0,i.kt)("p",null,"Strapi provides a programmatic API to customize GraphQL, which allows:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"disabling some operations for the ",(0,i.kt)("a",{parentName:"li",href:"#shadow-crud"},"Shadow CRUD")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#using-getters"},"using getters")," to return information about allowed operations"),(0,i.kt)("li",{parentName:"ul"},"registering and using an ",(0,i.kt)("inlineCode",{parentName:"li"},"extension")," object to ",(0,i.kt)("a",{parentName:"li",href:"#extending-the-schema"},"extend the existing schema")," (e.g. extend types or define custom resolvers, policies and middlewares)")),(0,i.kt)("details",null,(0,i.kt)("summary",null,"Example of GraphQL customizations"),(0,i.kt)(u,{groupId:"js-ts",mdxType:"Tabs"},(0,i.kt)(m,{value:"javascript",label:"JavaScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="./src/index.js"',title:'"./src/index.js"'},"\nmodule.exports = {\n  /**\n   * An asynchronous register function that runs before\n   * your application is initialized.\n   *\n   * This gives you an opportunity to extend code.\n   */\n  register({ strapi }) {\n    const extensionService = strapi.plugin('graphql').service('extension');\n    \n    extensionService.shadowCRUD('api::restaurant.restaurant').disable();\n    extensionService.shadowCRUD('api::category.category').disableQueries();\n    extensionService.shadowCRUD('api::address.address').disableMutations();\n    extensionService.shadowCRUD('api::document.document').field('locked').disable();\n    extensionService.shadowCRUD('api::like.like').disableActions(['create', 'update', 'delete']);\n    \n    const extension = ({ nexus }) => ({\n      // Nexus\n      types: [\n        nexus.objectType({\n          name: 'Book',\n          definition(t) {\n            t.string('title');\n          },\n        }),\n      ],\n      plugins: [\n        nexus.plugin({\n          name: 'MyPlugin',\n          onAfterBuild(schema) {\n            console.log(schema);\n          },\n        }),\n      ],\n      // GraphQL SDL\n      typeDefs: `\n          type Article {\n              name: String\n          }\n      `,\n      resolvers: {\n        Query: {\n          address: {\n            resolve() {\n              return { value: { city: 'Montpellier' } };\n            },\n          },\n        },\n      },\n      resolversConfig: {\n        'Query.address': {\n          auth: false,\n        },\n      },\n    });\n    extensionService.use(extension);\n  },\n};\n"))),(0,i.kt)(m,{value:"typescript",label:"TypeScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="./src/index.ts"',title:'"./src/index.ts"'},"\nexport default {\n  /**\n   * An asynchronous register function that runs before\n   * your application is initialized.\n   *\n   * This gives you an opportunity to extend code.\n   */\n  register({ strapi }) {\n    const extensionService = strapi.plugin('graphql').service('extension');\n    \n    extensionService.shadowCRUD('api::restaurant.restaurant').disable();\n    extensionService.shadowCRUD('api::category.category').disableQueries();\n    extensionService.shadowCRUD('api::address.address').disableMutations();\n    extensionService.shadowCRUD('api::document.document').field('locked').disable();\n    extensionService.shadowCRUD('api::like.like').disableActions(['create', 'update', 'delete']);\n    \n    const extension = ({ nexus }) => ({\n      // Nexus\n      types: [\n        nexus.objectType({\n          name: 'Book',\n          definition(t) {\n            t.string('title');\n          },\n        }),\n      ],\n      plugins: [\n        nexus.plugin({\n          name: 'MyPlugin',\n          onAfterBuild(schema) {\n            console.log(schema);\n          },\n        }),\n      ],\n      // GraphQL SDL\n      typeDefs: `\n          type Article {\n              name: String\n          }\n      `,\n      resolvers: {\n        Query: {\n          address: {\n            resolve() {\n              return { value: { city: 'Montpellier' } };\n            },\n          },\n        },\n      },\n      resolversConfig: {\n        'Query.address': {\n          auth: false,\n        },\n      },\n    });\n    extensionService.use(extension);\n  },\n};\n"))))),(0,i.kt)("h3",{id:"disabling-operations-in-the-shadow-crud"},"Disabling operations in the Shadow CRUD"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"extension")," ",(0,i.kt)("a",{parentName:"p",href:"/dev-docs/backend-customization/services"},"service")," provided with the GraphQL plugin exposes functions that can be used to disable operations on Content-Types:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Content-type function"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"),(0,i.kt)("th",{parentName:"tr",align:null},"Argument type"),(0,i.kt)("th",{parentName:"tr",align:null},"Possible argument values"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"disable()")),(0,i.kt)("td",{parentName:"tr",align:null},"Fully disable the Content-Type"),(0,i.kt)("td",{parentName:"tr",align:null},"-"),(0,i.kt)("td",{parentName:"tr",align:null},"-")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"disableQueries()")),(0,i.kt)("td",{parentName:"tr",align:null},"Only disable queries for the Content-Type"),(0,i.kt)("td",{parentName:"tr",align:null},"-"),(0,i.kt)("td",{parentName:"tr",align:null},"-")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"disableMutations()")),(0,i.kt)("td",{parentName:"tr",align:null},"Only disable mutations for the Content-Type"),(0,i.kt)("td",{parentName:"tr",align:null},"-"),(0,i.kt)("td",{parentName:"tr",align:null},"-")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"disableAction()")),(0,i.kt)("td",{parentName:"tr",align:null},"Disable a specific action for the Content-Type"),(0,i.kt)("td",{parentName:"tr",align:null},"String"),(0,i.kt)("td",{parentName:"tr",align:null},"One value from the list:",(0,i.kt)("ul",null,(0,i.kt)("li",null,(0,i.kt)("inlineCode",{parentName:"td"},"create")),(0,i.kt)("li",null,(0,i.kt)("inlineCode",{parentName:"td"},"find")),(0,i.kt)("li",null,(0,i.kt)("inlineCode",{parentName:"td"},"findOne")),(0,i.kt)("li",null,(0,i.kt)("inlineCode",{parentName:"td"},"update")),(0,i.kt)("li",null,(0,i.kt)("inlineCode",{parentName:"td"},"delete"))))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"disableActions()")),(0,i.kt)("td",{parentName:"tr",align:null},"Disable specific actions for the Content-Type"),(0,i.kt)("td",{parentName:"tr",align:null},"Array of Strings"),(0,i.kt)("td",{parentName:"tr",align:null},"Multiple values from the list: ",(0,i.kt)("ul",null,(0,i.kt)("li",null,(0,i.kt)("inlineCode",{parentName:"td"},"create")),(0,i.kt)("li",null,(0,i.kt)("inlineCode",{parentName:"td"},"find")),(0,i.kt)("li",null,(0,i.kt)("inlineCode",{parentName:"td"},"findOne")),(0,i.kt)("li",null,(0,i.kt)("inlineCode",{parentName:"td"},"update")),(0,i.kt)("li",null,(0,i.kt)("inlineCode",{parentName:"td"},"delete"))))))),(0,i.kt)("p",null,"Actions can also be disabled at the field level, with the following functions:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Field function"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"disable()")),(0,i.kt)("td",{parentName:"tr",align:null},"Fully disable the field")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"disableOutput()")),(0,i.kt)("td",{parentName:"tr",align:null},"Disable the output on a field")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"disableInput()")),(0,i.kt)("td",{parentName:"tr",align:null},"Disable the input on a field")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"disableFilters()")),(0,i.kt)("td",{parentName:"tr",align:null},"Disable filters input on a field")))),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Examples:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"// Disable the 'find' operation on the 'restaurant' content-type in the 'restaurant' API\nstrapi\n  .plugin('graphql')\n  .service('extension')\n  .shadowCRUD('api::restaurant.restaurant')\n  .disableAction('find')\n\n// Disable the 'name' field on the 'document' content-type in the 'document' API\nstrapi\n  .plugin('graphql')\n  .service('extension')\n  .shadowCRUD('api::document.document')\n  .field('name')\n  .disable()\n")),(0,i.kt)("h3",{id:"using-getters"},"Using getters"),(0,i.kt)("p",null,"The following getters can be used to retrieve information about operations allowed on content-types:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Content-type getter"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"),(0,i.kt)("th",{parentName:"tr",align:null},"Argument type"),(0,i.kt)("th",{parentName:"tr",align:null},"Possible argument values"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"isEnabled()")),(0,i.kt)("td",{parentName:"tr",align:null},"Returns whether a content-type is enabled"),(0,i.kt)("td",{parentName:"tr",align:null},"-"),(0,i.kt)("td",{parentName:"tr",align:null},"-")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"isDisabled()")),(0,i.kt)("td",{parentName:"tr",align:null},"Returns whether a content-type is disabled"),(0,i.kt)("td",{parentName:"tr",align:null},"-"),(0,i.kt)("td",{parentName:"tr",align:null},"-")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"areQueriesEnabled()")),(0,i.kt)("td",{parentName:"tr",align:null},"Returns whether queries are enabled on a content-type"),(0,i.kt)("td",{parentName:"tr",align:null},"-"),(0,i.kt)("td",{parentName:"tr",align:null},"-")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"areQueriesDisabled()")),(0,i.kt)("td",{parentName:"tr",align:null},"Returns whether queries are disabled on a content-type"),(0,i.kt)("td",{parentName:"tr",align:null},"-"),(0,i.kt)("td",{parentName:"tr",align:null},"-")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"areMutationsEnabled()")),(0,i.kt)("td",{parentName:"tr",align:null},"Returns whether mutations are enabled on a content-type"),(0,i.kt)("td",{parentName:"tr",align:null},"-"),(0,i.kt)("td",{parentName:"tr",align:null},"-")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"areMutationsDisabled()")),(0,i.kt)("td",{parentName:"tr",align:null},"Returns whether mutations are disabled on a content-type"),(0,i.kt)("td",{parentName:"tr",align:null},"-"),(0,i.kt)("td",{parentName:"tr",align:null},"-")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"isActionEnabled(action)")),(0,i.kt)("td",{parentName:"tr",align:null},"Returns whether the passed ",(0,i.kt)("inlineCode",{parentName:"td"},"action")," is enabled on a content-type"),(0,i.kt)("td",{parentName:"tr",align:null},"String"),(0,i.kt)("td",{parentName:"tr",align:null},"One value from the list:",(0,i.kt)("ul",null,(0,i.kt)("li",null,(0,i.kt)("inlineCode",{parentName:"td"},"create")),(0,i.kt)("li",null,(0,i.kt)("inlineCode",{parentName:"td"},"find")),(0,i.kt)("li",null,(0,i.kt)("inlineCode",{parentName:"td"},"findOne")),(0,i.kt)("li",null,(0,i.kt)("inlineCode",{parentName:"td"},"update")),(0,i.kt)("li",null,(0,i.kt)("inlineCode",{parentName:"td"},"delete"))))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"isActionDisabled(action)")),(0,i.kt)("td",{parentName:"tr",align:null},"Returns whether the passed ",(0,i.kt)("inlineCode",{parentName:"td"},"action")," is disabled on a content-type"),(0,i.kt)("td",{parentName:"tr",align:null},"String"),(0,i.kt)("td",{parentName:"tr",align:null},"One value from the list:",(0,i.kt)("ul",null,(0,i.kt)("li",null,(0,i.kt)("inlineCode",{parentName:"td"},"create")),(0,i.kt)("li",null,(0,i.kt)("inlineCode",{parentName:"td"},"find")),(0,i.kt)("li",null,(0,i.kt)("inlineCode",{parentName:"td"},"findOne")),(0,i.kt)("li",null,(0,i.kt)("inlineCode",{parentName:"td"},"update")),(0,i.kt)("li",null,(0,i.kt)("inlineCode",{parentName:"td"},"delete"))))))),(0,i.kt)("p",null,"The following getters can be used to retrieve information about operations allowed on fields:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Field getter"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"isEnabled()")),(0,i.kt)("td",{parentName:"tr",align:null},"Returns whether a field is enabled")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"isDisabled()")),(0,i.kt)("td",{parentName:"tr",align:null},"Returns whether a field is disabled")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"hasInputEnabled()")),(0,i.kt)("td",{parentName:"tr",align:null},"Returns whether a field has input enabled")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"hasOutputEnabled()")),(0,i.kt)("td",{parentName:"tr",align:null},"Returns whether a field has output enabled")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"hasFiltersEnabled()")),(0,i.kt)("td",{parentName:"tr",align:null},"Returns whether a field has filtering enabled")))),(0,i.kt)("h3",{id:"extending-the-schema"},"Extending the schema"),(0,i.kt)("p",null,"The schema generated by the Content API can be extended by registering an extension."),(0,i.kt)("p",null,"This extension, defined either as an object or a function returning an object, will be used by the ",(0,i.kt)("inlineCode",{parentName:"p"},"use()")," function exposed by the ",(0,i.kt)("inlineCode",{parentName:"p"},"extension")," ",(0,i.kt)("a",{parentName:"p",href:"/dev-docs/backend-customization/services"},"service")," provided with the GraphQL plugin."),(0,i.kt)("p",null,"The object describing the extension accepts the following parameters:"),(0,i.kt)("table",null,(0,i.kt)("thead",{parentName:"table"},(0,i.kt)("tr",{parentName:"thead"},(0,i.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,i.kt)("th",{parentName:"tr",align:null},"Type"),(0,i.kt)("th",{parentName:"tr",align:null},"Description"))),(0,i.kt)("tbody",{parentName:"table"},(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"types")),(0,i.kt)("td",{parentName:"tr",align:null},"Array"),(0,i.kt)("td",{parentName:"tr",align:null},"Allows extending the schema types using ",(0,i.kt)("a",{parentName:"td",href:"https://nexusjs.org/"},"Nexus"),"-based type definitions")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"typeDefs")),(0,i.kt)("td",{parentName:"tr",align:null},"String"),(0,i.kt)("td",{parentName:"tr",align:null},"Allows extending the schema types using ",(0,i.kt)("a",{parentName:"td",href:"https://graphql.org/learn/schema/"},"GraphQL SDL"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"plugins")),(0,i.kt)("td",{parentName:"tr",align:null},"Array"),(0,i.kt)("td",{parentName:"tr",align:null},"Allows extending the schema using Nexus ",(0,i.kt)("a",{parentName:"td",href:"https://nexusjs.org/docs/plugins"},"plugins"))),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"resolvers")),(0,i.kt)("td",{parentName:"tr",align:null},"Object"),(0,i.kt)("td",{parentName:"tr",align:null},"Defines custom resolvers")),(0,i.kt)("tr",{parentName:"tbody"},(0,i.kt)("td",{parentName:"tr",align:null},(0,i.kt)("inlineCode",{parentName:"td"},"resolversConfig")),(0,i.kt)("td",{parentName:"tr",align:null},"Object"),(0,i.kt)("td",{parentName:"tr",align:null},"Defines ",(0,i.kt)("a",{parentName:"td",href:"#custom-configuration-for-resolvers"},"configuration options for the resolvers"),", such as ",(0,i.kt)("a",{parentName:"td",href:"#authorization-configuration"},"authorization"),", ",(0,i.kt)("a",{parentName:"td",href:"#policies"},"policies")," and ",(0,i.kt)("a",{parentName:"td",href:"#middlewares"},"middlewares"))))),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"The ",(0,i.kt)("inlineCode",{parentName:"p"},"types")," and ",(0,i.kt)("inlineCode",{parentName:"p"},"plugins")," parameters are based on ",(0,i.kt)("a",{parentName:"p",href:"https://nexusjs.org/"},"Nexus"),". To use them, register the extension as a function that takes ",(0,i.kt)("inlineCode",{parentName:"p"},"nexus")," as a parameter:"),(0,i.kt)("details",null,(0,i.kt)("summary",null," Example: "),(0,i.kt)(u,{groupId:"js-ts",mdxType:"Tabs"},(0,i.kt)(m,{value:"javascript",label:"JavaScript",mdxType:"TabItem"},(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="./src/index.js"',title:'"./src/index.js"'},"\nmodule.exports = {\n  register({ strapi }) {\n    const extension = ({ nexus }) => ({\n      types: [\n        nexus.objectType({\n          \u2026\n        }),\n      ],\n      plugins: [\n        nexus.plugin({\n          \u2026\n        })\n      ]\n    })\n\n    strapi.plugin('graphql').service('extension').use(extension)\n  }\n}\n"))),(0,i.kt)(m,{value:"typescript",label:"TypeScript",mdxType:"TabItem"},(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="./src/index.ts"',title:'"./src/index.ts"'},"\nexport default {\n  register({ strapi }) {\n    const extension = ({ nexus }) => ({\n      types: [\n        nexus.objectType({\n          \u2026\n        }),\n      ],\n      plugins: [\n        nexus.plugin({\n          \u2026\n        })\n      ]\n    })\n\n    strapi.plugin('graphql').service('extension').use(extension)\n  }\n}\n")))))),(0,i.kt)("h4",{id:"custom-configuration-for-resolvers"},"Custom configuration for resolvers"),(0,i.kt)("p",null,"A resolver is a GraphQL query or mutation handler (i.e. a function, or a collection of functions, that generate(s) a response for a GraphQL query or mutation). Each field has a default resolver."),(0,i.kt)("p",null,"When ",(0,i.kt)("a",{parentName:"p",href:"#extending-the-schema"},"extending the GraphQL schema"),", the ",(0,i.kt)("inlineCode",{parentName:"p"},"resolversConfig")," key can be used to define a custom configuration for a resolver, which can include:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#authorization-configuration"},"authorization configuration")," with the ",(0,i.kt)("inlineCode",{parentName:"li"},"auth")," key"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"#policies"},"policies with the ",(0,i.kt)("inlineCode",{parentName:"a"},"policies"))," key"),(0,i.kt)("li",{parentName:"ul"},"and ",(0,i.kt)("a",{parentName:"li",href:"#middlewares"},"middlewares with the ",(0,i.kt)("inlineCode",{parentName:"a"},"middlewares"))," key")),(0,i.kt)("h5",{id:"authorization-configuration"},"Authorization configuration"),(0,i.kt)("p",null,"By default, the authorization of a GraphQL request is handled by the registered authorization strategy that can be either ",(0,i.kt)("a",{parentName:"p",href:"/dev-docs/configurations/api-tokens"},"API token")," or through the ",(0,i.kt)("a",{parentName:"p",href:"#usage-with-the-users--permissions-plugin"},"Users & Permissions plugin"),". The Users & Permissions plugin offers a more granular control."),(0,i.kt)("details",null,(0,i.kt)("summary",null," Authorization with the Users & Permissions plugin"),(0,i.kt)("p",null,"With the Users & Permissions plugin, a GraphQL request is allowed if the appropriate permissions are given."),(0,i.kt)("p",null,"For instance, if a 'Category' content-type exists and is queried through GraphQL with the ",(0,i.kt)("inlineCode",{parentName:"p"},"Query.categories")," handler, the request is allowed if the appropriate ",(0,i.kt)("inlineCode",{parentName:"p"},"find")," permission for the 'Categories' content-type is given."),(0,i.kt)("p",null,"To query a single category, which is done with the ",(0,i.kt)("inlineCode",{parentName:"p"},"Query.category")," handler, the request is allowed if the the ",(0,i.kt)("inlineCode",{parentName:"p"},"findOne")," permission is given."),(0,i.kt)("p",null,"Please refer to the user guide on how to ",(0,i.kt)("a",{parentName:"p",href:"/user-docs/users-roles-permissions/configuring-administrator-roles#editing-a-role"},"define permissions with the Users & Permissions plugin"),".")),(0,i.kt)("p",null,"To change how the authorization is configured, use the resolver configuration defined at ",(0,i.kt)("inlineCode",{parentName:"p"},"resolversConfig.[MyResolverName]"),". The authorization can be configured:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"either with ",(0,i.kt)("inlineCode",{parentName:"li"},"auth: false")," to fully bypass the authorization system and allow all requests,"),(0,i.kt)("li",{parentName:"ul"},"or with a ",(0,i.kt)("inlineCode",{parentName:"li"},"scope")," attribute that accepts an array of strings to define the permissions required to authorize the request.")),(0,i.kt)("details",null,(0,i.kt)("summary",null," Examples of authorization configuration"),(0,i.kt)(u,{groupId:"js-ts",mdxType:"Tabs"},(0,i.kt)(m,{value:"javascript",label:"JavaScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="./src/index.js"',title:'"./src/index.js"'},"\nmodule.exports = {\n  register({ strapi }) {\n    const extensionService = strapi.plugin('graphql').service('extension');\n\n    extensionService.use({\n      resolversConfig: {\n        'Query.categories': {\n          /**\n           * Querying the Categories content-type\n           * bypasses the authorization system.\n           */ \n          auth: false\n        },\n        'Query.restaurants': {\n          /**\n           * Querying the Restaurants content-type\n           * requires the find permission\n           * on the 'Address' content-type\n           * of the 'Address' API\n           */\n          auth: {\n            scope: ['api::address.address.find']\n          }\n        },\n      }\n    })\n  }\n}\n\n"))),(0,i.kt)(m,{value:"typescript",label:"TypeScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="./src/index.ts"',title:'"./src/index.ts"'},"\nexport default {\n  register({ strapi }) {\n    const extensionService = strapi.plugin('graphql').service('extension');\n\n    extensionService.use({\n      resolversConfig: {\n        'Query.categories': {\n          /**\n           * Querying the Categories content-type\n           * bypasses the authorization system.\n           */ \n          auth: false\n        },\n        'Query.restaurants': {\n          /**\n           * Querying the Restaurants content-type\n           * requires the find permission\n           * on the 'Address' content-type\n           * of the 'Address' API\n           */\n          auth: {\n            scope: ['api::address.address.find']\n          }\n        },\n      }\n    })\n  }\n}\n\n"))))),(0,i.kt)("h5",{id:"policies"},"Policies"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"/dev-docs/backend-customization/policies"},"Policies")," can be applied to a GraphQL resolver through the ",(0,i.kt)("inlineCode",{parentName:"p"},"resolversConfig.[MyResolverName].policies")," key."),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"policies")," key is an array accepting a list of policies, each item in this list being either a reference to an already registered policy or an implementation that is passed directly (see ",(0,i.kt)("a",{parentName:"p",href:"/dev-docs/backend-customization/routes#policies"},"policies configuration documentation"),")."),(0,i.kt)("p",null,"Policies directly implemented in ",(0,i.kt)("inlineCode",{parentName:"p"},"resolversConfig")," are functions that take a ",(0,i.kt)("inlineCode",{parentName:"p"},"context")," object and the ",(0,i.kt)("inlineCode",{parentName:"p"},"strapi")," instance as arguments.\nThe ",(0,i.kt)("inlineCode",{parentName:"p"},"context")," object gives access to:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"the ",(0,i.kt)("inlineCode",{parentName:"li"},"parent"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"args"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"context")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"info")," arguments of the GraphQL resolver,"),(0,i.kt)("li",{parentName:"ul"},"Koa's ",(0,i.kt)("a",{parentName:"li",href:"https://koajs.com/#context"},"context")," with ",(0,i.kt)("inlineCode",{parentName:"li"},"context.http")," and ",(0,i.kt)("a",{parentName:"li",href:"https://koajs.com/#ctx-state"},"state")," with ",(0,i.kt)("inlineCode",{parentName:"li"},"context.state"),".")),(0,i.kt)("details",null,(0,i.kt)("summary",null," Example of GraphQL policies applied to resolvers"),(0,i.kt)(u,{groupId:"js-ts",mdxType:"Tabs"},(0,i.kt)(m,{value:"javascript",label:"JavaScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="./src/index.js"',title:'"./src/index.js"'},"\nmodule.exports = {\n  register({ strapi }) {\n    const extensionService = strapi.plugin('graphql').service('extension');\n\n    extensionService.use({\n      resolversConfig: {\n        'Query.categories': {\n          policies: [\n            (context, { strapi }) => {\n              console.log('hello', context.parent)\n              /**\n               * If 'categories' have a parent, the function returns true,\n               * so the request won't be blocked by the policy.\n               */ \n              return context.parent !== undefined;\n            }\n            /**\n             * Uses a policy already created in Strapi.\n             */\n            \"api::model.policy-name\",\n\n            /**\n             * Uses a policy already created in Strapi with a custom configuration\n             */\n            {name:\"api::model.policy-name\", config: {/* all config values I want to pass to the strapi policy */} },\n          ],\n          auth: false,\n        },\n      }\n    })\n  }\n}\n"))),(0,i.kt)(m,{value:"typescript",label:"TypeScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="./src/index.ts"',title:'"./src/index.ts"'},"\nexport default {\n  register({ strapi }) {\n    const extensionService = strapi.plugin('graphql').service('extension');\n\n    extensionService.use({\n      resolversConfig: {\n        'Query.categories': {\n          policies: [\n            (context, { strapi }) => {\n              console.log('hello', context.parent)\n              /**\n               * If 'categories' have a parent, the function returns true,\n               * so the request won't be blocked by the policy.\n               */ \n              return context.parent !== undefined;\n            }\n            /**\n             * Uses a policy already created in Strapi.\n             */\n            \"api::model.policy-name\",\n\n            /**\n             * Uses a policy already created in Strapi with a custom configuration\n             */\n            {name:\"api::model.policy-name\", config: {/* all the configuration values to pass to the strapi policy */} },\n          ],\n          auth: false,\n        },\n      }\n    })\n  }\n}\n"))))),(0,i.kt)("h5",{id:"middlewares"},"Middlewares"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"/dev-docs/backend-customization/middlewares"},"Middlewares")," can be applied to a GraphQL resolver through the ",(0,i.kt)("inlineCode",{parentName:"p"},"resolversConfig.[MyResolverName].middlewares")," key. The only difference between the GraphQL and REST implementations is that the ",(0,i.kt)("inlineCode",{parentName:"p"},"config")," key becomes ",(0,i.kt)("inlineCode",{parentName:"p"},"options"),".  "),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"middlewares")," key is an array accepting a list of middlewares, each item in this list being either a reference to an already registered middleware or an implementation that is passed directly (see ",(0,i.kt)("a",{parentName:"p",href:"/dev-docs/backend-customization/routes#middlewares"},"middlewares configuration documentation"),")."),(0,i.kt)("p",null,"Middlewares directly implemented in ",(0,i.kt)("inlineCode",{parentName:"p"},"resolversConfig")," can take the GraphQL resolver's ",(0,i.kt)("a",{parentName:"p",href:"https://www.apollographql.com/docs/apollo-server/data/resolvers/#resolver-arguments"},(0,i.kt)("inlineCode",{parentName:"a"},"parent"),", ",(0,i.kt)("inlineCode",{parentName:"a"},"args"),", ",(0,i.kt)("inlineCode",{parentName:"a"},"context")," and ",(0,i.kt)("inlineCode",{parentName:"a"},"info")," objects")," as arguments."),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"Middlewares with GraphQL can even act on nested resolvers, which offer a more granular control than with REST.")),(0,i.kt)("details",null,(0,i.kt)("summary",null," Examples of GraphQL middlewares applied to a resolver"),(0,i.kt)(u,{groupId:"js-ts",mdxType:"Tabs"},(0,i.kt)(m,{value:"javascript",label:"JavaScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title"./src/index.js"','title"./src/index.js"':!0},"\nmodule.exports = {\n  register({ strapi }) {\n    const extensionService = strapi.plugin('graphql').service('extension');\n\n    extensionService.use({\n      resolversConfig: {\n        'Query.categories': {\n          middlewares: [\n            /**\n             * Basic middleware example #1\n             * Log resolving time in console\n             */\n            async (next, parent, args, context, info) => {\n              console.time('Resolving categories');\n              \n              // call the next resolver\n              const res = await next(parent, args, context, info);\n              \n              console.timeEnd('Resolving categories');\n\n              return res;\n            },\n            /**\n             * Basic middleware example #2\n             * Enable server-side shared caching\n             */\n            async (next, parent, args, context, info) => {\n              info.cacheControl.setCacheHint({ maxAge: 60, scope: \"PUBLIC\" });\n              return next(parent, args, context, info);\n            },\n            /**\n             * Basic middleware example #3\n             * change the 'name' attribute of parent with id 1 to 'foobar'\n             */\n            (resolve, parent, ...rest) => {\n              if (parent.id === 1) {\n                return resolve({...parent, name: 'foobar' }, ...rest);\n              }\n\n              return resolve(parent, ...rest);\n            }\n            /**\n             * Basic middleware example #4\n             * Uses a middleware already created in Strapi.\n             */\n            \"api::model.middleware-name\",\n\n            /**\n             * Basic middleware example #5\n             * Uses a middleware already created in Strapi with a custom configuration\n             */\n            { name: \"api::model.middleware-name\", options: { /* all config values I want to pass to the strapi middleware */ } },\n          ],\n          auth: false,\n        },\n      }\n    })\n  }\n}\n"))),(0,i.kt)(m,{value:"typescript",label:"TypeScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title"./src/index.ts"','title"./src/index.ts"':!0},"\nexport default {\n  register({ strapi }) {\n    const extensionService = strapi.plugin('graphql').service('extension');\n\n    extensionService.use({\n      resolversConfig: {\n        'Query.categories': {\n          middlewares: [\n            /**\n             * Basic middleware example #1\n             * Log resolving time in console\n             */\n            async (next, parent, args, context, info) => {\n              console.time('Resolving categories');\n              \n              // call the next resolver\n              const res = await next(parent, args, context, info);\n              \n              console.timeEnd('Resolving categories');\n\n              return res;\n            },\n            /**\n             * Basic middleware example #2\n             * Enable server-side shared caching\n             */\n            async (next, parent, args, context, info) => {\n              info.cacheControl.setCacheHint({ maxAge: 60, scope: \"PUBLIC\" });\n              return next(parent, args, context, info);\n            },\n            /**\n             * Basic middleware example #3\n             * change the 'name' attribute of parent with id 1 to 'foobar'\n             */\n            (resolve, parent, ...rest) => {\n              if (parent.id === 1) {\n                return resolve({...parent, name: 'foobar' }, ...rest);\n              }\n\n              return resolve(parent, ...rest);\n            }\n\n            /**\n             * Basic middleware example #4\n             * Uses a middleware already created in Strapi.\n             */\n            \"api::model.middleware-name\",\n\n            /**\n             * Basic middleware example #5\n             * Uses a middleware already created in Strapi with a custom configuration\n             */\n            {name:\"api::model.middleware-name\", options: {/* all the configuration values to pass to the middleware */} },\n          ],\n          auth: false,\n        },\n      }\n    })\n  }\n}\n"))))),(0,i.kt)("h2",{id:"usage-with-the-users--permissions-plugin"},"Usage with the Users & Permissions plugin"),(0,i.kt)("p",null,"The ",(0,i.kt)("a",{parentName:"p",href:"/dev-docs/plugins/users-permissions"},"Users & Permissions plugin")," is an optional plugin that allows protecting the API with a full authentication process."),(0,i.kt)("h3",{id:"registration"},"Registration"),(0,i.kt)("p",null,"Usually you need to sign up or register before being recognized as a user then perform authorized requests."),(0,i.kt)(c,{title:"Mutation",mdxType:"Request"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-graphql"},'mutation {\n  register(input: { username: "username", email: "email", password: "password" }) {\n    jwt\n    user {\n      username\n      email\n    }\n  }\n}\n'))),(0,i.kt)("p",null,"You should see a new user is created in the ",(0,i.kt)("inlineCode",{parentName:"p"},"Users")," collection type in your Strapi admin panel."),(0,i.kt)("h3",{id:"authentication"},"Authentication"),(0,i.kt)("p",null,"To perform authorized requests, you must first get a JWT:"),(0,i.kt)(c,{title:"Mutation",mdxType:"Request"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-graphql"},'mutation {\n  login(input: { identifier: "email", password: "password" }) {\n    jwt\n  }\n}\n'))),(0,i.kt)("p",null,"Then on each request, send along an ",(0,i.kt)("inlineCode",{parentName:"p"},"Authorization")," header in the form of ",(0,i.kt)("inlineCode",{parentName:"p"},'{ "Authorization": "Bearer YOUR_JWT_GOES_HERE" }'),". This can be set in the HTTP Headers section of your GraphQL Playground."),(0,i.kt)("h2",{id:"api-tokens"},"API tokens"),(0,i.kt)("p",null,"To use API tokens for authentication, pass the token in the ",(0,i.kt)("inlineCode",{parentName:"p"},"Authorization")," header using the format ",(0,i.kt)("inlineCode",{parentName:"p"},"Bearer your-api-token"),"."),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"Using API tokens in the the GraphQL playground requires adding the authorization header with your token in the ",(0,i.kt)("inlineCode",{parentName:"p"},"HTTP HEADERS")," tab:"),(0,i.kt)("pre",{parentName:"admonition"},(0,i.kt)("code",{parentName:"pre",className:"language-http"},'{\n  "Authorization" : "Bearer <TOKEN>"\n}\n')),(0,i.kt)("p",{parentName:"admonition"},"Replace ",(0,i.kt)("inlineCode",{parentName:"p"},"<TOKEN>")," with your API token generated in the Strapi Admin panel.")),(0,i.kt)("h2",{id:"security"},"Security"),(0,i.kt)("p",null,"GraphQL is a query language allowing users to use a broader panel of inputs than traditional REST APIs. GraphQL APIs are inherently prone to security risks, such as credential leakage and denial of service attacks, that can be reduced by taking appropriate precautions."),(0,i.kt)("h3",{id:"disable-playground-in-production"},"Disable playground in production"),(0,i.kt)("p",null,"In production environments, disabling the GraphQL Playground is recommended.\nIf you haven't edited the ",(0,i.kt)("a",{parentName:"p",href:"/dev-docs/configurations/plugins#graphql-configuration"},"configuration file"),", it is already disabled in production by default."),(0,i.kt)("h3",{id:"limit-max-depth-and-complexity"},"Limit max depth and complexity"),(0,i.kt)("p",null,"A malicious user could send a query with a very high depth, which could overload your server. Use the ",(0,i.kt)("inlineCode",{parentName:"p"},"depthLimit")," ",(0,i.kt)("a",{parentName:"p",href:"/dev-docs/configurations/plugins#graphql-configuration"},"configuration parameter")," to limit the maximum number of nested fields that can be queried in a single request. By default, ",(0,i.kt)("inlineCode",{parentName:"p"},"depthLimit")," is set to 10 but can be set to a higher value during testing and development."),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"To increase GraphQL security even further, 3rd-party tools can be used. See the guide about ",(0,i.kt)("a",{parentName:"p",href:"https://forum.strapi.io/t/use-graphql-armor-with-strapi/"},"using GraphQL Armor with Strapi on the forum"),".")))}g.isMDXComponent=!0}}]);