"use strict";(self.webpackChunkstrapi_docs=self.webpackChunkstrapi_docs||[]).push([[7452],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>k});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function o(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},r=Object.keys(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);for(a=0;a<r.length;a++)n=r[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):l(l({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,r=e.originalType,s=e.parentName,u=o(e,["components","mdxType","originalType","parentName"]),c=p(n),k=i,d=c["".concat(s,".").concat(k)]||c[k]||m[k]||r;return n?a.createElement(d,l(l({ref:t},u),{},{components:n})):a.createElement(d,l({ref:t},u))}));function k(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var r=n.length,l=new Array(r);l[0]=c;var o={};for(var s in t)hasOwnProperty.call(t,s)&&(o[s]=t[s]);o.originalType=e,o.mdxType="string"==typeof e?e:i,l[1]=o;for(var p=2;p<r;p++)l[p]=n[p];return a.createElement.apply(null,l)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},75907:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>l,default:()=>h,frontMatter:()=>r,metadata:()=>o,toc:()=>p});var a=n(83117),i=(n(67294),n(3905));const r={title:"Users & Permissions",displayed_sidebar:"devDocsSidebar",toc_max_heading_level:4,description:"Protect your API with a full authentication process based on JWT and manage the permissions between the groups of users."},l="Users & Permissions plugin",o={unversionedId:"dev-docs/plugins/users-permissions",id:"dev-docs/plugins/users-permissions",title:"Users & Permissions",description:"Protect your API with a full authentication process based on JWT and manage the permissions between the groups of users.",source:"@site/docs/dev-docs/plugins/users-permissions.md",sourceDirName:"dev-docs/plugins",slug:"/dev-docs/plugins/users-permissions",permalink:"/aberabook/dev-docs/plugins/users-permissions",draft:!1,editUrl:"https://github.com/labs-solo/aberabook/edit/main/docusaurus/docs/dev-docs/plugins/users-permissions.md",tags:[],version:"current",frontMatter:{title:"Users & Permissions",displayed_sidebar:"devDocsSidebar",toc_max_heading_level:4,description:"Protect your API with a full authentication process based on JWT and manage the permissions between the groups of users."},sidebar:"devDocsSidebar",previous:{title:"Upload",permalink:"/aberabook/dev-docs/plugins/upload"},next:{title:"Developing plugins",permalink:"/aberabook/dev-docs/plugins/developing-plugins"}},s={},p=[{value:"Concept",id:"concept",level:2},{value:"Manage role permissions",id:"manage-role-permissions",level:2},{value:"Public role",id:"public-role",level:3},{value:"Authenticated role",id:"authenticated-role",level:3},{value:"Permissions management",id:"permissions-management",level:3},{value:"Update the default role",id:"update-the-default-role",level:3},{value:"Authentication",id:"authentication",level:2},{value:"Login",id:"login",level:3},{value:"Local",id:"local",level:4},{value:"Token usage",id:"token-usage",level:3},{value:"Usage",id:"usage",level:4},{value:"JWT configuration",id:"jwt-configuration",level:3},{value:"Registration",id:"registration",level:3},{value:"Configuration",id:"configuration",level:4},{value:"Usage",id:"usage-1",level:4},{value:"Providers",id:"providers",level:3},{value:"Understanding the login flow",id:"understanding-the-login-flow",level:4},{value:"Setting up the server url",id:"setting-up-the-server-url",level:4},{value:"Setting up the provider - examples",id:"setting-up-the-provider---examples",level:4},{value:"Setup the frontend",id:"setup-the-frontend",level:4},{value:"Reset password",id:"reset-password",level:3},{value:"Forgotten password: ask for the reset password link",id:"forgotten-password-ask-for-the-reset-password-link",level:4},{value:"Reset Password: send the new password",id:"reset-password-send-the-new-password",level:4},{value:"Email validation",id:"email-validation",level:3},{value:"User object in Strapi context",id:"user-object-in-strapi-context",level:2},{value:"Templating emails",id:"templating-emails",level:2},{value:"Reset Password",id:"reset-password-1",level:3},{value:"Email address confirmation",id:"email-address-confirmation",level:3},{value:"Security configuration",id:"security-configuration",level:2},{value:"Creating a custom callback validator",id:"creating-a-custom-callback-validator",level:3}],u=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,i.kt)("div",t)},m=u("Tabs"),c=u("TabItem"),k=u("ThemedImage"),d={toc:p};function h(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},d,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"users--permissions-plugin"},"Users & Permissions plugin"),(0,i.kt)("p",null,"This plugin provides a full authentication process based on ",(0,i.kt)("a",{parentName:"p",href:"https://en.wikipedia.org/wiki/JSON_Web_Token"},"JSON Web Tokens (JWT)")," to protect your API. It also provides an access-control list (ACL) strategy that enables you to manage permissions between groups of users."),(0,i.kt)("p",null,"To access the plugin admin panel, click on the ",(0,i.kt)("strong",{parentName:"p"},"Settings")," link in the left menu of your Strapi application dashboard and under the ",(0,i.kt)("strong",{parentName:"p"},"USERS & PERMISSIONS PLUGIN")," section you will find sections for managing ",(0,i.kt)("strong",{parentName:"p"},"Roles"),", ",(0,i.kt)("strong",{parentName:"p"},"Providers"),", ",(0,i.kt)("strong",{parentName:"p"},"Email Templates"),", and ",(0,i.kt)("strong",{parentName:"p"},"Advanced Settings"),"."),(0,i.kt)("h2",{id:"concept"},"Concept"),(0,i.kt)("p",null,"When this plugin is installed, it adds an access layer on your application.\nThe plugin uses ",(0,i.kt)("inlineCode",{parentName:"p"},"JWTs")," to authenticate users. Your JWT contains your user ID, which is matched to the group your user is in and used to determine whether to allow access to the route."),(0,i.kt)("p",null,"Each time an API request is sent the server checks if an ",(0,i.kt)("inlineCode",{parentName:"p"},"Authorization")," header is present and verifies if the user making the request has access to the resource."),(0,i.kt)("h2",{id:"manage-role-permissions"},"Manage role permissions"),(0,i.kt)("h3",{id:"public-role"},"Public role"),(0,i.kt)("p",null,"This is the default role used when the server receives a request without an ",(0,i.kt)("inlineCode",{parentName:"p"},"Authorization")," header. Any permissions (i.e. accessible endpoints) granted to this role will be accessible by anyone."),(0,i.kt)("p",null,"It is common practice to select ",(0,i.kt)("inlineCode",{parentName:"p"},"find")," / ",(0,i.kt)("inlineCode",{parentName:"p"},"findOne")," endpoints when you want your front-end application to access all the content without requiring user authentication and authorization."),(0,i.kt)("h3",{id:"authenticated-role"},"Authenticated role"),(0,i.kt)("p",null,"This is the default role that is given to every ",(0,i.kt)("strong",{parentName:"p"},"new user")," at creation if no role is provided. In this role you define routes that a user can access."),(0,i.kt)("h3",{id:"permissions-management"},"Permissions management"),(0,i.kt)("p",null,"By clicking on the ",(0,i.kt)("strong",{parentName:"p"},"Role")," name, you can see all functions available in your application (with these functions related to the specific route displayed)."),(0,i.kt)("p",null,"If you check a function name, it makes this route accessible by the current role you are editing. On the right sidebar you can see the URL related to this function."),(0,i.kt)("h3",{id:"update-the-default-role"},"Update the default role"),(0,i.kt)("p",null,"When you create a user without a role, or if you use the ",(0,i.kt)("inlineCode",{parentName:"p"},"/api/auth/local/register")," route, the ",(0,i.kt)("inlineCode",{parentName:"p"},"authenticated")," role is given to the user."),(0,i.kt)("p",null,"To change the default role, go to the ",(0,i.kt)("inlineCode",{parentName:"p"},"Advanced settings")," tab and update the ",(0,i.kt)("inlineCode",{parentName:"p"},"Default role for authenticated users")," option."),(0,i.kt)("h2",{id:"authentication"},"Authentication"),(0,i.kt)("h3",{id:"login"},"Login"),(0,i.kt)("p",null,"Submit the user's identifier and password credentials for authentication. On successful authentication the response data will have the user's information along with an authentication token."),(0,i.kt)("h4",{id:"local"},"Local"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"identifier")," param can be an ",(0,i.kt)("strong",{parentName:"p"},"email")," or ",(0,i.kt)("strong",{parentName:"p"},"username"),"."),(0,i.kt)(m,{mdxType:"Tabs"},(0,i.kt)(c,{value:"Axios",title:"Axios",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"import axios from 'axios';\n\n// Request API.\naxios\n  .post('http://localhost:1337/api/auth/local', {\n    identifier: 'user@strapi.io',\n    password: 'strapiPassword',\n  })\n  .then(response => {\n    // Handle success.\n    console.log('Well done!');\n    console.log('User profile', response.data.user);\n    console.log('User token', response.data.jwt);\n  })\n  .catch(error => {\n    // Handle error.\n    console.log('An error occurred:', error.response);\n  });\n"))),(0,i.kt)(c,{value:"Postman",title:"Postman",mdxType:"TabItem"},(0,i.kt)("p",null,"If you use ",(0,i.kt)("strong",{parentName:"p"},"Postman"),", set the ",(0,i.kt)("strong",{parentName:"p"},"body")," to ",(0,i.kt)("strong",{parentName:"p"},"raw")," and select ",(0,i.kt)("strong",{parentName:"p"},"JSON")," as your data format:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "identifier": "user@strapi.io",\n  "password": "strapiPassword"\n}\n')),(0,i.kt)("p",null,"If the request is successful you will receive the ",(0,i.kt)("strong",{parentName:"p"},"user's JWT")," in the ",(0,i.kt)("inlineCode",{parentName:"p"},"jwt")," key:  "),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n    "jwt": "eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MSwiaWF0IjoxNTc2OTM4MTUwLCJleHAiOjE1Nzk1MzAxNTB9.UgsjjXkAZ-anD257BF7y1hbjuY3ogNceKfTAQtzDEsU",\n    "user": {\n        "id": 1,\n        "username": "user",\n        ...\n    }\n}\n')))),(0,i.kt)("h3",{id:"token-usage"},"Token usage"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"jwt")," may then be used for making permission-restricted API requests. To make an API request as a user place the JWT into an ",(0,i.kt)("inlineCode",{parentName:"p"},"Authorization")," header of the ",(0,i.kt)("inlineCode",{parentName:"p"},"GET")," request."),(0,i.kt)("p",null,"Any request without a token will assume the ",(0,i.kt)("inlineCode",{parentName:"p"},"public")," role permissions by default. Modify the permissions of each user's role in the admin dashboard."),(0,i.kt)("p",null,"Authentication failures return a ",(0,i.kt)("inlineCode",{parentName:"p"},"401 (unauthorized)")," error."),(0,i.kt)("h4",{id:"usage"},"Usage"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"token")," variable is the ",(0,i.kt)("inlineCode",{parentName:"p"},"data.jwt")," received when logging in or registering."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"import axios from 'axios';\n\nconst token = 'YOUR_TOKEN_HERE';\n\n// Request API.\naxios\n  .get('http://localhost:1337/posts', {\n    headers: {\n      Authorization: `Bearer ${token}`,\n    },\n  })\n  .then(response => {\n    // Handle success.\n    console.log('Data: ', response.data);\n  })\n  .catch(error => {\n    // Handle error.\n    console.log('An error occurred:', error.response);\n  });\n")),(0,i.kt)("h3",{id:"jwt-configuration"},"JWT configuration"),(0,i.kt)("p",null,"You can configure the JWT generation by using the ",(0,i.kt)("a",{parentName:"p",href:"/dev-docs/configurations/plugins"},"plugins configuration file"),"."),(0,i.kt)("p",null,"Strapi uses ",(0,i.kt)("a",{parentName:"p",href:"https://www.npmjs.com/package/jsonwebtoken"},"jsonwebtoken")," to generate the JWT."),(0,i.kt)("p",null,"Available options:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"jwtSecret"),": random string used to create new JWTs, typically set using the ",(0,i.kt)("inlineCode",{parentName:"li"},"JWT_SECRET")," ",(0,i.kt)("a",{parentName:"li",href:"/dev-docs/configurations/environment#strapi-s-environment-variables"},"environment variable"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"jwt.expiresIn"),": expressed in seconds or a string describing a time span.",(0,i.kt)("br",null),'\nEg: 60, "45m", "10h", "2 days", "7d", "2y". A numeric value is interpreted as a seconds count. If you use a string be sure you provide the time units (minutes, hours, days, years, etc), otherwise milliseconds unit is used by default ("120" is equal to "120ms").')),(0,i.kt)(m,{groupId:"js-ts",mdxType:"Tabs"},(0,i.kt)(c,{value:"javascript",label:"JavaScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="./config/plugins.js"',title:'"./config/plugins.js"'},"\nmodule.exports = ({ env }) => ({\n  // ...\n  'users-permissions': {\n    config: {\n      jwt: {\n        expiresIn: '7d',\n      },\n    },\n  },\n  // ...\n});\n"))),(0,i.kt)(c,{value:"typescript",label:"TypeScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="./config/plugins.ts"',title:'"./config/plugins.ts"'},"\nexport default ({ env }) => ({\n  // ...\n  'users-permissions': {\n    config: {\n      jwt: {\n        expiresIn: '7d',\n      },\n    },\n  },\n  // ...\n});\n")))),(0,i.kt)("admonition",{type:"warning"},(0,i.kt)("p",{parentName:"admonition"},"Setting JWT expiry for more than 30 days is ",(0,i.kt)("strong",{parentName:"p"},"not recommended")," due to security concerns.")),(0,i.kt)("h3",{id:"registration"},"Registration"),(0,i.kt)("h4",{id:"configuration"},"Configuration"),(0,i.kt)("p",null,"If you have added any additional fields to your user model that need to be accepted on registration, they need to be added to the list of allowed fields in the ",(0,i.kt)("inlineCode",{parentName:"p"},"register")," configuration option, otherwise they will not be accepted."),(0,i.kt)("p",null,'For example, if you have added a field called "nickname" that you wish to accept from the API on user registration:'),(0,i.kt)(m,{groupId:"js-ts",mdxType:"Tabs"},(0,i.kt)(c,{value:"javascript",label:"JavaScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="./config/plugins.js"',title:'"./config/plugins.js"'},'module.exports = ({ env }) => ({\n  // ...\n  "users-permissions": {\n    config: {\n      register: {\n        allowedFields: ["nickname"],\n      },\n    },\n  },\n  // ...\n});\n'))),(0,i.kt)(c,{value:"typescript",label:"TypeScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="./config/plugins.ts"',title:'"./config/plugins.ts"'},'export default ({ env }) => ({\n  // ...\n  "users-permissions": {\n    config: {\n      register: {\n        allowedFields: ["nickname"],\n      },\n    },\n  },\n  // ...\n});\n')))),(0,i.kt)("h4",{id:"usage-1"},"Usage"),(0,i.kt)("p",null,"Creates a new user in the database with a default role as 'registered'."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"import axios from 'axios';\n\n// Request API.\n// Add your own code here to customize or restrict how the public can register new users.\naxios\n  .post('http://localhost:1337/api/auth/local/register', {\n    username: 'Strapi user',\n    email: 'user@strapi.io',\n    password: 'strapiPassword',\n  })\n  .then(response => {\n    // Handle success.\n    console.log('Well done!');\n    console.log('User profile', response.data.user);\n    console.log('User token', response.data.jwt);\n  })\n  .catch(error => {\n    // Handle error.\n    console.log('An error occurred:', error.response);\n  });\n")),(0,i.kt)("h3",{id:"providers"},"Providers"),(0,i.kt)("p",null," ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/simov/grant"},"Grant")," and ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/simov/purest"},"Purest")," allow you to use OAuth and OAuth2 providers to enable authentication in your application."),(0,i.kt)("p",null,"For a better understanding, review the following description of the login flow. The example uses",(0,i.kt)("inlineCode",{parentName:"p"},"github")," as the provider but it works the same for other providers."),(0,i.kt)("h4",{id:"understanding-the-login-flow"},"Understanding the login flow"),(0,i.kt)("p",null,"Let's say that:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Strapi's backend is located at: ",(0,i.kt)("inlineCode",{parentName:"li"},"strapi.website.com"),", and"),(0,i.kt)("li",{parentName:"ul"},"Your app frontend is located at: ",(0,i.kt)("inlineCode",{parentName:"li"},"website.com"))),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"The user goes on your frontend app (",(0,i.kt)("inlineCode",{parentName:"li"},"https://website.com"),") and clicks on your button ",(0,i.kt)("inlineCode",{parentName:"li"},"connect with Github"),"."),(0,i.kt)("li",{parentName:"ol"},"The frontend redirects the tab to the backend URL: ",(0,i.kt)("inlineCode",{parentName:"li"},"https://strapi.website.com/api/connect/github"),"."),(0,i.kt)("li",{parentName:"ol"},"The backend redirects the tab to the GitHub login page where the user logs in."),(0,i.kt)("li",{parentName:"ol"},"Once done, Github redirects the tab to the backend URL:",(0,i.kt)("inlineCode",{parentName:"li"},"https://strapi.website.com/api/connect/github/callback?code=abcdef"),"."),(0,i.kt)("li",{parentName:"ol"},"The backend uses the given ",(0,i.kt)("inlineCode",{parentName:"li"},"code")," to get an ",(0,i.kt)("inlineCode",{parentName:"li"},"access_token")," from Github that can be used for a period of time to make authorized requests to Github to get the user info."),(0,i.kt)("li",{parentName:"ol"},"Then, the backend redirects the tab to the url of your choice with the param ",(0,i.kt)("inlineCode",{parentName:"li"},"access_token")," (example: ",(0,i.kt)("inlineCode",{parentName:"li"},"http://website.com/connect/github/redirect?access_token=eyfvg"),")."),(0,i.kt)("li",{parentName:"ol"},"The frontend (",(0,i.kt)("inlineCode",{parentName:"li"},"http://website.com/connect/github/redirect"),") calls the backend with ",(0,i.kt)("inlineCode",{parentName:"li"},"https://strapi.website.com/api/auth/github/callback?access_token=eyfvg")," that returns the Strapi user profile with its ",(0,i.kt)("inlineCode",{parentName:"li"},"jwt"),". ",(0,i.kt)("br",null)," (Under the hood, the backend asks Github for the user's profile and a match is done on Github user's email address and Strapi user's email address)."),(0,i.kt)("li",{parentName:"ol"},"The frontend now possesses the user's ",(0,i.kt)("inlineCode",{parentName:"li"},"jwt"),", which means the user is connected and the frontend can make authenticated requests to the backend!")),(0,i.kt)("p",null,"An example of a frontend app that handles this flow can be found here: ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/strapi/strapi-examples/tree/master/examples/login-react"},"react login example app"),"."),(0,i.kt)("h4",{id:"setting-up-the-server-url"},"Setting up the server url"),(0,i.kt)("p",null,"Before setting up a provider you must specify the absolute url of your backend in ",(0,i.kt)("inlineCode",{parentName:"p"},"server.js"),"."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"example -")," ",(0,i.kt)("inlineCode",{parentName:"p"},"config/server.js")),(0,i.kt)(m,{groupId:"js-ts",mdxType:"Tabs"},(0,i.kt)(c,{value:"javascript",label:"JavaScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="config/server.js"',title:'"config/server.js"'},"\nmodule.exports = ({ env }) => ({\n  host: env('HOST', '0.0.0.0'),\n  port: env.int('PORT', 1337),\n  url: env('', 'http://localhost:1337'),\n});\n"))),(0,i.kt)(c,{value:"typescript",label:"TypeScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="config/server.ts"',title:'"config/server.ts"'},"\nexport default ({ env }) => ({\n  host: env('HOST', '0.0.0.0'),\n  port: env.int('PORT', 1337),\n  url: env('', 'http://localhost:1337'),\n});\n")))),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"Later you will give this url to your provider. ",(0,i.kt)("br",null)," For development, some providers accept the use of localhost urls but many don't. In this case we recommend to use ",(0,i.kt)("a",{parentName:"p",href:"https://ngrok.com/docs"},"ngrok")," (",(0,i.kt)("inlineCode",{parentName:"p"},"ngrok http 1337"),") that will make a proxy tunnel from a url it created to your localhost url (ex: ",(0,i.kt)("inlineCode",{parentName:"p"},"url: env('', 'https://5299e8514242.ngrok.io'),"),").")),(0,i.kt)("h4",{id:"setting-up-the-provider---examples"},"Setting up the provider - examples"),(0,i.kt)("p",null,"Instead of a generic explanation we decided to show an example for each provider."),(0,i.kt)("p",null,"In the following examples, the frontend app will be the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/strapi/strapi-examples/tree/master/examples/login-react"},"react login example app"),". ",(0,i.kt)("br",null),"\nIt (the frontend app) will be running on ",(0,i.kt)("inlineCode",{parentName:"p"},"http://localhost:3000"),". ",(0,i.kt)("br",null),"\nStrapi (the backend) will be running on ",(0,i.kt)("inlineCode",{parentName:"p"},"http://localhost:1337"),"."),(0,i.kt)(m,{mdxType:"Tabs"},(0,i.kt)(c,{title:"GitHub",value:"GitHub",mdxType:"TabItem"},(0,i.kt)("h4",{id:"github"},"Using ngrok"),(0,i.kt)("p",null,"Github doesn't accept ",(0,i.kt)("inlineCode",{parentName:"p"},"localhost")," urls. ",(0,i.kt)("br",null),"\nUse ",(0,i.kt)("inlineCode",{parentName:"p"},"ngrok")," to serve the backend app."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"ngrok http 1337\n")),(0,i.kt)("p",null,"Don't forget to update the server url in the backend config file ",(0,i.kt)("inlineCode",{parentName:"p"},"config/server.js")," and the server url in your frontend app (environment variable ",(0,i.kt)("inlineCode",{parentName:"p"},"REACT_APP_BACKEND_URL")," if you use ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/strapi/strapi-examples/tree/master/examples/login-react"},"react login example app"),") with the generated ngrok url."),(0,i.kt)("h4",{id:"github-config"},"Github configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the OAuth Apps list page ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/settings/developers"},"https://github.com/settings/developers")),(0,i.kt)("li",{parentName:"ul"},"Click on ",(0,i.kt)("strong",{parentName:"li"},"New OAuth App")," button"),(0,i.kt)("li",{parentName:"ul"},"Fill the information (replace with your own ngrok url):",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Application name"),": Strapi GitHub auth"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Homepage URL"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"https://65e60559.ngrok.io")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Application description"),": Strapi provider auth description"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Authorization callback URL"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"https://65e60559.ngrok.io/api/connect/github/callback"))))),(0,i.kt)("h4",{id:"github-strapi-config"},"Strapi configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the User Permissions provider settings page ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"http://localhost:1337/admin/settings/users-permissions/providers"},"http://localhost:1337/admin/settings/users-permissions/providers")),(0,i.kt)("li",{parentName:"ul"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"GitHub")," provider"),(0,i.kt)("li",{parentName:"ul"},"Fill the information (replace with your own client ID and secret):",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Enable"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"ON")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Client ID"),": 53de5258f8472c140917"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Client Secret"),": fb9d0fe1d345d9ac7f83d7a1e646b37c554dae8b"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"The redirect URL to your front-end app"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:3000/connect/github/redirect")))))),(0,i.kt)(c,{value:"Facebook",title:"Facebook",mdxType:"TabItem"},(0,i.kt)("h4",{id:"facebook"},"Using ngrok"),(0,i.kt)("p",null,"Facebook doesn't accept ",(0,i.kt)("inlineCode",{parentName:"p"},"localhost")," urls. ",(0,i.kt)("br",null),"\nUse ",(0,i.kt)("inlineCode",{parentName:"p"},"ngrok")," to serve the backend app."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"ngrok http 1337\n")),(0,i.kt)("p",null,"Don't forget to update the server url in the backend config file ",(0,i.kt)("inlineCode",{parentName:"p"},"config/server.js")," and the server url in your frontend app (environment variable ",(0,i.kt)("inlineCode",{parentName:"p"},"REACT_APP_BACKEND_URL")," if you use ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/strapi/strapi-examples/tree/master/examples/login-react"},"react login example app"),") with the generated ngrok url."),(0,i.kt)("h4",{id:"facebook-config"},"Facebook configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the Developer Apps list page ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"https://developers.facebook.com/apps/"},"https://developers.facebook.com/apps/")),(0,i.kt)("li",{parentName:"ul"},"Click on ",(0,i.kt)("strong",{parentName:"li"},"Add a New App")," button"),(0,i.kt)("li",{parentName:"ul"},"Fill the ",(0,i.kt)("strong",{parentName:"li"},"Display Name")," in the modal and create the app"),(0,i.kt)("li",{parentName:"ul"},"Setup a ",(0,i.kt)("strong",{parentName:"li"},"Facebook Login")," product"),(0,i.kt)("li",{parentName:"ul"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"PRODUCTS > Facebook login > Settings")," link in the left menu"),(0,i.kt)("li",{parentName:"ul"},"Fill the information and save (replace with your own ngrok url):",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Valid OAuth Redirect URIs"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"https://65e60559.ngrok.io/api/connect/facebook/callback")))),(0,i.kt)("li",{parentName:"ul"},"Then, click on ",(0,i.kt)("strong",{parentName:"li"},"Settings")," in the left menu"),(0,i.kt)("li",{parentName:"ul"},"Then on ",(0,i.kt)("strong",{parentName:"li"},"Basic")," link"),(0,i.kt)("li",{parentName:"ul"},"You should see your Application ID and secret, save them for later")),(0,i.kt)("h4",{id:"facebook-strapi-config"},"Strapi configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the User Permissions provider settings page ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"http://localhost:1337/admin/settings/users-permissions/providers"},"http://localhost:1337/admin/settings/users-permissions/providers")),(0,i.kt)("li",{parentName:"ul"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"Facebook")," provider"),(0,i.kt)("li",{parentName:"ul"},"Fill the information (replace with your own client ID and secret):",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Enable"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"ON")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Client ID"),": 2408954435875229"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Client Secret"),": 4fe04b740b69f31ea410b9391ff3b5b0"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"The redirect URL to your front-end app"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:3000/connect/facebook/redirect")))))),(0,i.kt)(c,{title:"Google",value:"Google",mdxType:"TabItem"},(0,i.kt)("h4",{id:"google"},"Using ngrok"),(0,i.kt)("p",null,"Google accepts the ",(0,i.kt)("inlineCode",{parentName:"p"},"localhost")," urls. ",(0,i.kt)("br",null),"\nThe use of ",(0,i.kt)("inlineCode",{parentName:"p"},"ngrok")," is not needed."),(0,i.kt)("h4",{id:"google-config"},"Google configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the Google Developer Console ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"https://console.developers.google.com/"},"https://console.developers.google.com/")),(0,i.kt)("li",{parentName:"ul"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"Select a project")," dropdown in the top menu"),(0,i.kt)("li",{parentName:"ul"},"Then click ",(0,i.kt)("strong",{parentName:"li"},"NEW PROJECT")," button"),(0,i.kt)("li",{parentName:"ul"},"Fill the ",(0,i.kt)("strong",{parentName:"li"},"Project name")," input and create")),(0,i.kt)("p",null,"Wait a few seconds while the application is created."),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"On the project dropdown, select your new project"),(0,i.kt)("li",{parentName:"ul"},"Click on ",(0,i.kt)("strong",{parentName:"li"},"Go to APIs overview")," under the ",(0,i.kt)("strong",{parentName:"li"},"APIs")," card"),(0,i.kt)("li",{parentName:"ul"},"Then click on the ",(0,i.kt)("strong",{parentName:"li"},"Credentials")," link in the left menu"),(0,i.kt)("li",{parentName:"ul"},"Click on ",(0,i.kt)("strong",{parentName:"li"},"OAuth consent screen")," button"),(0,i.kt)("li",{parentName:"ul"},"Choose ",(0,i.kt)("strong",{parentName:"li"},"External")," and click on ",(0,i.kt)("strong",{parentName:"li"},"create")),(0,i.kt)("li",{parentName:"ul"},"Fill the ",(0,i.kt)("strong",{parentName:"li"},"Application name")," and save"),(0,i.kt)("li",{parentName:"ul"},"Then click on ",(0,i.kt)("strong",{parentName:"li"},"Create credentials")," button"),(0,i.kt)("li",{parentName:"ul"},"Choose ",(0,i.kt)("strong",{parentName:"li"},"OAuth client ID")," option"),(0,i.kt)("li",{parentName:"ul"},"Fill the information:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Name"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"Strapi Auth")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Authorized redirect URIs"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:1337/api/connect/google/callback")))),(0,i.kt)("li",{parentName:"ul"},"Click on ",(0,i.kt)("strong",{parentName:"li"},"OAuth 2.0 Client IDs")," name of the client you just created"),(0,i.kt)("li",{parentName:"ul"},"You should see your Application ID and secret, save them for later")),(0,i.kt)("h4",{id:"google-strapi-config"},"Strapi configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the User Permissions provider settings page ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"http://localhost:1337/admin/settings/users-permissions/providers"},"http://localhost:1337/admin/settings/users-permissions/providers")),(0,i.kt)("li",{parentName:"ul"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"Google")," provider"),(0,i.kt)("li",{parentName:"ul"},"Fill the information (replace with your own client ID and secret):",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Enable"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"ON")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Client ID"),": 226437944084-o2mojv5i4lfnng9q8kq3jkf5v03avemk.apps.googleusercontent.com"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Client Secret"),": aiTbMoiuJQflSBy6uQrfgsni"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"The redirect URL to your front-end app"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:3000/connect/google/redirect")))))),(0,i.kt)(c,{title:"AWS Cognito",value:"AWS Cognito",mdxType:"TabItem"},(0,i.kt)("h4",{id:"aws-cognito"},"Using ngrok"),(0,i.kt)("p",null,"AWS Cognito accepts the ",(0,i.kt)("inlineCode",{parentName:"p"},"localhost")," urls. ",(0,i.kt)("br",null),"\nThe use of ",(0,i.kt)("inlineCode",{parentName:"p"},"ngrok")," is not needed."),(0,i.kt)("h4",{id:"aws-cognito-config"},"AWS Cognito configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the AWS Management Console ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"https://aws.amazon.com/console/"},"https://aws.amazon.com/console/")),(0,i.kt)("li",{parentName:"ul"},"If needed, select your ",(0,i.kt)("strong",{parentName:"li"},"Region")," in the top right corner next to the Support dropdown"),(0,i.kt)("li",{parentName:"ul"},"Select the ",(0,i.kt)("strong",{parentName:"li"},"Services")," dropdown in the top left corner"),(0,i.kt)("li",{parentName:"ul"},"Click on ",(0,i.kt)("strong",{parentName:"li"},"Cognito")," in the ",(0,i.kt)("inlineCode",{parentName:"li"},"Security, Identity & Compliance")," section"),(0,i.kt)("li",{parentName:"ul"},"Then click on the ",(0,i.kt)("strong",{parentName:"li"},"Manage User Pools")," button"),(0,i.kt)("li",{parentName:"ul"},"If applicable either create or use an existing user pool. You will find hereafter a tutorial to create a User Pool ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/cognito/latest/developerguide/tutorial-create-user-pool.html"},"https://docs.aws.amazon.com/cognito/latest/developerguide/tutorial-create-user-pool.html")),(0,i.kt)("li",{parentName:"ul"},"Go to the ",(0,i.kt)("strong",{parentName:"li"},"App clients")," section in your cognito user pool and create a new client with the name ",(0,i.kt)("inlineCode",{parentName:"li"},"Strapi Auth")," and set all the parameters and then click on ",(0,i.kt)("strong",{parentName:"li"},"Create app client")),(0,i.kt)("li",{parentName:"ul"},"You should now have an ",(0,i.kt)("strong",{parentName:"li"},"App client id")," and by clicking on the button ",(0,i.kt)("strong",{parentName:"li"},"Show Details")," you will be able to see the ",(0,i.kt)("strong",{parentName:"li"},"App client secret"),". Do copy those two values ",(0,i.kt)("strong",{parentName:"li"},"App client id")," and ",(0,i.kt)("strong",{parentName:"li"},"App client secret")," somewhere for later use when configuring the AWS Cognito provider in Strapi."),(0,i.kt)("li",{parentName:"ul"},"Go to the ",(0,i.kt)("strong",{parentName:"li"},"App integration section")," and click on ",(0,i.kt)("strong",{parentName:"li"},"App client settings")),(0,i.kt)("li",{parentName:"ul"},"Look for your app client named ",(0,i.kt)("inlineCode",{parentName:"li"},"Strapi Auth")," and enable Cognito User Pool by checking it in the ",(0,i.kt)("strong",{parentName:"li"},"Enabled Identity Providers")," section of your newly created App client"),(0,i.kt)("li",{parentName:"ul"},"Fill in your callback URL and Sign out URL with the value ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:1337/api/connect/cognito/callback")," or the one provided by your AWS Cognito provider in Strapi"),(0,i.kt)("li",{parentName:"ul"},"In the ",(0,i.kt)("strong",{parentName:"li"},"Oauth 2.0")," section select ",(0,i.kt)("inlineCode",{parentName:"li"},"Authorization code grant")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"Implicit grant")," for the ",(0,i.kt)("strong",{parentName:"li"},"Allowed OAuth Flows")," and select ",(0,i.kt)("inlineCode",{parentName:"li"},"email"),", ",(0,i.kt)("inlineCode",{parentName:"li"},"openid")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"profile")," for the ",(0,i.kt)("strong",{parentName:"li"},"Allowed OAuth Scopes")),(0,i.kt)("li",{parentName:"ul"},"You can now click on ",(0,i.kt)("strong",{parentName:"li"},"Save changes")," and if you have already configured your domain name then you should be able to see a link to the ",(0,i.kt)("strong",{parentName:"li"},"Launch Hosted UI"),". You can click on it in order to display the AWS Cognito login page. In case you haven't yet configured your domain name, use the link ",(0,i.kt)("strong",{parentName:"li"},"Choose domain name")," at the bottom right of the page in order to configure your domain name. On that page you will have an ",(0,i.kt)("inlineCode",{parentName:"li"},"Amazon Cognito Domain")," section where a ",(0,i.kt)("inlineCode",{parentName:"li"},"Domain prefix")," is already setup. Type a domain prefix to use for the sign-up and sign-in pages that are hosted by Amazon Cognito, this domain prefix together with the ",(0,i.kt)("inlineCode",{parentName:"li"},".auth.YOUR_REGION.amazoncognito.com")," will be the ",(0,i.kt)("strong",{parentName:"li"},"Host URI (Subdomain)")," value for your strapi configuration later on.")),(0,i.kt)("h4",{id:"aws-cognito-strapi-config"},"Strapi configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the User Permissions provider settings page ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"http://localhost:1337/admin/settings/users-permissions/providers"},"http://localhost:1337/admin/settings/users-permissions/providers")),(0,i.kt)("li",{parentName:"ul"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"Cognito")," provider"),(0,i.kt)("li",{parentName:"ul"},"Fill the information (replace with your own client ID and secret):",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Enable"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"ON")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Client ID"),": fill in the ",(0,i.kt)("strong",{parentName:"li"},"App client id")," (",(0,i.kt)("inlineCode",{parentName:"li"},"5bd7a786qdupjmi0b3s10vegdt"),")"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Client Secret"),": fill in the ",(0,i.kt)("strong",{parentName:"li"},"App client secret")," (",(0,i.kt)("inlineCode",{parentName:"li"},"19c5c78dsfsdfssfsdfhpdb4nkpb145vesdfdsfsffgh7vwd6g45jlipbpb"),")"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Host URI (Subdomain)"),": fill in the URL value that you copied earlier (",(0,i.kt)("inlineCode",{parentName:"li"},"myapp67b50345-67b50b17-local.auth.eu-central-1.amazoncognito.com"),")"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"The redirect URL to your front-end app"),": if you are using strapi react-login ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/strapi/strapi-examples/tree/master/examples/login-react/"},"https://github.com/strapi/strapi-examples/tree/master/examples/login-react/")," use ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:3000/connect/cognito/redirect")," but if you do not yet have a front-end app to test your Cognito configuration you can then use the following URL ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:1337/api/auth/cognito/callback")))))),(0,i.kt)(c,{title:"Twitter",value:"Twitter",mdxType:"TabItem"},(0,i.kt)("h4",{id:"twitter"},"Using ngrok"),(0,i.kt)("p",null,"Twitter doesn't accept ",(0,i.kt)("inlineCode",{parentName:"p"},"localhost")," urls. ",(0,i.kt)("br",null),"\nUse ",(0,i.kt)("inlineCode",{parentName:"p"},"ngrok")," to serve the backend app."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"ngrok http 1337\n")),(0,i.kt)("p",null,"Don't forget to update the server url in the backend config file ",(0,i.kt)("inlineCode",{parentName:"p"},"config/server.js")," and the server url in your frontend app (environment variable ",(0,i.kt)("inlineCode",{parentName:"p"},"REACT_APP_BACKEND_URL")," if you use ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/strapi/strapi-examples/tree/master/examples/login-react"},"react login example app"),") with the generated ngrok url."),(0,i.kt)("h4",{id:"twitter-config"},"Twitter configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the Apps list page ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"https://developer.twitter.com/en/apps"},"https://developer.twitter.com/en/apps")),(0,i.kt)("li",{parentName:"ul"},"Click on ",(0,i.kt)("strong",{parentName:"li"},"Create an app")," button"),(0,i.kt)("li",{parentName:"ul"},"Fill the information (replace with your own ngrok url):",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"App name"),": Strapi Twitter auth"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Application description"),": This is a demo app for Strapi auth"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Tell us how this app will be used"),": - here write a message enough long -"))),(0,i.kt)("li",{parentName:"ul"},"At the end of the process you should see your Application ID and secret, save them for later"),(0,i.kt)("li",{parentName:"ul"},"Go to you app setting and click on edit ",(0,i.kt)("strong",{parentName:"li"},"Authentication settings")),(0,i.kt)("li",{parentName:"ul"},"Enable ",(0,i.kt)("strong",{parentName:"li"},"3rd party authentication")," AND ",(0,i.kt)("strong",{parentName:"li"},"Request email address from users")),(0,i.kt)("li",{parentName:"ul"},"Fill the information (replace with your own ngrok url):",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Callback URLs"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"https://65e60559.ngrok.io/api/connect/twitter/callback")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Website URL"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"https://65e60559.ngrok.io")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Privacy policy"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"https://d73e70e88872.ngrok.io")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Terms of service"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"https://d73e70e88872.ngrok.io"))))),(0,i.kt)("h4",{id:"twitter-strapi-config"},"Strapi configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the User Permissions provider settings page ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"http://localhost:1337/admin/settings/users-permissions/providers"},"http://localhost:1337/admin/settings/users-permissions/providers")),(0,i.kt)("li",{parentName:"ul"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"Twitter")," provider"),(0,i.kt)("li",{parentName:"ul"},"Fill the information (replace with your own client ID and secret):",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Enable"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"ON")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"API Key"),": yfN4ycGGmKXiS1njtIYxuN5IH"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Api Secret"),": Nag1en8S4VwqurBvlW5OaFyKlzqrXFeyWhph6CZlpGA2V3VR3T"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"The redirect URL to your front-end app"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:3000/connect/twitter/redirect")))))),(0,i.kt)(c,{title:"Discord",value:"Discord",mdxType:"TabItem"},(0,i.kt)("h4",{id:"discord"},"Using ngrok"),(0,i.kt)("p",null,"Discord accepts the ",(0,i.kt)("inlineCode",{parentName:"p"},"localhost")," urls. ",(0,i.kt)("br",null),"\nThe use of ",(0,i.kt)("inlineCode",{parentName:"p"},"ngrok")," is not needed."),(0,i.kt)("h4",{id:"discord-configuration"},"Discord configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the Apps list page on the developer portal ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"https://discordapp.com/developers/applications/"},"https://discordapp.com/developers/applications/")),(0,i.kt)("li",{parentName:"ul"},"Click on ",(0,i.kt)("strong",{parentName:"li"},"New application")," button"),(0,i.kt)("li",{parentName:"ul"},"Fill the ",(0,i.kt)("strong",{parentName:"li"},"name")," and create"),(0,i.kt)("li",{parentName:"ul"},"Click on ",(0,i.kt)("strong",{parentName:"li"},"OAuth2")," in the left menu"),(0,i.kt)("li",{parentName:"ul"},"And click on ",(0,i.kt)("strong",{parentName:"li"},"Add redirect")," button"),(0,i.kt)("li",{parentName:"ul"},"Fill the ",(0,i.kt)("strong",{parentName:"li"},"Redirect")," input with ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:1337/api/connect/discord/callback")," URL and save"),(0,i.kt)("li",{parentName:"ul"},"Click on ",(0,i.kt)("strong",{parentName:"li"},"General information")," in the left menu"),(0,i.kt)("li",{parentName:"ul"},"You should see your Application ID and secret, save them for later")),(0,i.kt)("h4",{id:"discord-strapi-configuration"},"Strapi configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the User Permissions provider settings page ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"http://localhost:1337/admin/settings/users-permissions/providers"},"http://localhost:1337/admin/settings/users-permissions/providers")),(0,i.kt)("li",{parentName:"ul"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"Discord")," provider"),(0,i.kt)("li",{parentName:"ul"},"Fill the information (replace with your own client ID and secret):",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Enable"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"ON")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Client ID"),": 665118465148846081"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Client Secret"),": iJbr7mkyqyut-J2hGvvSDch_5Dw5U77J"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"The redirect URL to your front-end app"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:3000/connect/discord/redirect")))))),(0,i.kt)(c,{title:"Twitch",value:"Twitch",mdxType:"TabItem"},(0,i.kt)("h4",{id:"twitch"},"Using ngrok"),(0,i.kt)("p",null,"Twitch accepts the ",(0,i.kt)("inlineCode",{parentName:"p"},"localhost")," urls. ",(0,i.kt)("br",null),"\nThe use of ",(0,i.kt)("inlineCode",{parentName:"p"},"ngrok")," is not needed."),(0,i.kt)("h4",{id:"twitch-config"},"Twitch configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the Apps list page on the developer console ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"https://dev.twitch.tv/console/apps"},"https://dev.twitch.tv/console/apps")),(0,i.kt)("li",{parentName:"ul"},"Click on ",(0,i.kt)("strong",{parentName:"li"},"Register Your Application")," button"),(0,i.kt)("li",{parentName:"ul"},"Fill the information:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Name"),": Strapi auth"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"OAuth Redirect URLs"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:1337/api/connect/twitch/callback")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Category"),": Choose a category"))),(0,i.kt)("li",{parentName:"ul"},"Click on ",(0,i.kt)("strong",{parentName:"li"},"Manage")," button of your new app"),(0,i.kt)("li",{parentName:"ul"},"Generate a new ",(0,i.kt)("strong",{parentName:"li"},"Client Secret")," with the ",(0,i.kt)("strong",{parentName:"li"},"New Secret")," button"),(0,i.kt)("li",{parentName:"ul"},"You should see your Application ID and secret, save them for later")),(0,i.kt)("h4",{id:"twitch-strapi-config"},"Strapi configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the User Permissions provider settings page ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"http://localhost:1337/admin/settings/users-permissions/providers"},"http://localhost:1337/admin/settings/users-permissions/providers")),(0,i.kt)("li",{parentName:"ul"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"Twitch")," provider"),(0,i.kt)("li",{parentName:"ul"},"Fill the information (replace with your own client ID and secret):",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Enable"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"ON")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Client ID"),": amuy279g8wt68qlht3u4gek4oykh5j"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Client Secret"),": dapssh10uo97gg2l25qufr8wen3yr6"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"The redirect URL to your front-end app"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:3000/connect/twitch/redirect")))))),(0,i.kt)(c,{title:"Instagram",value:"Instagram",mdxType:"TabItem"},(0,i.kt)("h4",{id:"instagram"},"Using ngrok"),(0,i.kt)("p",null,"Facebook doesn't accept ",(0,i.kt)("inlineCode",{parentName:"p"},"localhost")," urls. ",(0,i.kt)("br",null),"\nUse ",(0,i.kt)("inlineCode",{parentName:"p"},"ngrok")," to serve the backend app."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre"},"ngrok http 1337\n")),(0,i.kt)("p",null,"Don't forget to update the server url in the backend config file ",(0,i.kt)("inlineCode",{parentName:"p"},"config/server.js")," and the server url in your frontend app (environment variable ",(0,i.kt)("inlineCode",{parentName:"p"},"REACT_APP_BACKEND_URL")," if you use ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/strapi/strapi-examples/tree/master/examples/login-react"},"react login example app"),") with the generated ngrok url."),(0,i.kt)("h4",{id:"instagram-config"},"Instagram configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the Developer Apps list page ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"https://developers.facebook.com/apps/"},"https://developers.facebook.com/apps/")),(0,i.kt)("li",{parentName:"ul"},"Click on ",(0,i.kt)("strong",{parentName:"li"},"Add a New App")," button"),(0,i.kt)("li",{parentName:"ul"},"Fill the ",(0,i.kt)("strong",{parentName:"li"},"Display Name")," in the modal and create the app"),(0,i.kt)("li",{parentName:"ul"},"Setup an ",(0,i.kt)("strong",{parentName:"li"},"Instagram")," product"),(0,i.kt)("li",{parentName:"ul"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"PRODUCTS > Instagram > Basic Display")," link in the left menu"),(0,i.kt)("li",{parentName:"ul"},"Then click on the ",(0,i.kt)("strong",{parentName:"li"},"Create new application")," button (and valid the modal)"),(0,i.kt)("li",{parentName:"ul"},"Fill the information (replace with your own ngrok url):",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Valid OAuth Redirect URIs"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"https://65e60559.ngrok.io/api/connect/instagram/callback")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Deauthorize"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"https://65e60559.ngrok.io")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Data Deletion Requests"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"https://65e60559.ngrok.io")))),(0,i.kt)("li",{parentName:"ul"},"On the ",(0,i.kt)("strong",{parentName:"li"},"App Review for Instagram Basic Display")," click on ",(0,i.kt)("strong",{parentName:"li"},"Add to submission")," for ",(0,i.kt)("strong",{parentName:"li"},"instagram_graph_user_profile"),"."),(0,i.kt)("li",{parentName:"ul"},"You should see your Application ID and secret, save them for later")),(0,i.kt)("h4",{id:"instagram-strapi-config"},"Strapi configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the User Permissions provider settings page ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"http://localhost:1337/admin/settings/users-permissions/providers"},"http://localhost:1337/admin/settings/users-permissions/providers")),(0,i.kt)("li",{parentName:"ul"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"Instagram")," provider"),(0,i.kt)("li",{parentName:"ul"},"Fill the information (replace with your own client ID and secret):",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Enable"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"ON")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Client ID"),": 563883201184965"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Client Secret"),": f5ba10a7dd78c2410ab6b8a35ab28226"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"The redirect URL to your front-end app"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:3000/connect/instagram/redirect")))))),(0,i.kt)(c,{title:"VK",value:"VK",mdxType:"TabItem"},(0,i.kt)("h4",{id:"vk"},"Using ngrok"),(0,i.kt)("p",null,"VK accepts the ",(0,i.kt)("inlineCode",{parentName:"p"},"localhost")," urls. ",(0,i.kt)("br",null),"\nThe use of ",(0,i.kt)("inlineCode",{parentName:"p"},"ngrok")," is not needed."),(0,i.kt)("h4",{id:"vk-config"},"VK configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the Apps list page ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"https://vk.com/apps?act=manage"},"https://vk.com/apps?act=manage")),(0,i.kt)("li",{parentName:"ul"},"Click on ",(0,i.kt)("strong",{parentName:"li"},"Create app")," button"),(0,i.kt)("li",{parentName:"ul"},"Fill the information:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Title"),": Strapi auth"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Platform"),": Choose ",(0,i.kt)("strong",{parentName:"li"},"Website")," option"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Website address"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:1337")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Base domain"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"localhost")))),(0,i.kt)("li",{parentName:"ul"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"Settings")," link in the left menu"),(0,i.kt)("li",{parentName:"ul"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"Open API")," link to enable this option"),(0,i.kt)("li",{parentName:"ul"},"Fill the information:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Authorized redirect URL"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:1337/api/connect/vk/callback"))))),(0,i.kt)("h4",{id:"vk-strapi-config"},"Strapi configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the User Permissions provider settings page ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"http://localhost:1337/admin/settings/users-permissions/providers"},"http://localhost:1337/admin/settings/users-permissions/providers")),(0,i.kt)("li",{parentName:"ul"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"VK")," provider"),(0,i.kt)("li",{parentName:"ul"},"Fill the information:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Enable"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"ON")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Client ID"),": 7276416"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Client Secret"),": cFBUSghLXGuxqnCyw1N3"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"The redirect URL to your front-end app"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:3000/connect/vk/redirect")))))),(0,i.kt)(c,{title:"LinkedIn",value:"LinkedIn",mdxType:"TabItem"},(0,i.kt)("h4",{id:"linkedin"},"Using ngrok"),(0,i.kt)("p",null,"LinkedIn accepts the ",(0,i.kt)("inlineCode",{parentName:"p"},"localhost")," urls. ",(0,i.kt)("br",null),"\nThe use of ",(0,i.kt)("inlineCode",{parentName:"p"},"ngrok")," is not needed."),(0,i.kt)("h4",{id:"linkedin-config"},"LinkedIn configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the Apps list page ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"https://www.linkedin.com/developers/apps"},"https://www.linkedin.com/developers/apps")),(0,i.kt)("li",{parentName:"ul"},"Click on ",(0,i.kt)("strong",{parentName:"li"},"Create app")," button"),(0,i.kt)("li",{parentName:"ul"},"Fill the information:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"App name"),": Strapi auth"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"LinkedIn Page"),": Enter a LinkedIn page name to associate with the app or click ",(0,i.kt)("strong",{parentName:"li"},"Create a new LinkedIn Page")," to create a new one"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"App Logo"),": Upload a square image that is at least 100x100 pixels."))),(0,i.kt)("li",{parentName:"ul"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"Create app")," to create the app"),(0,i.kt)("li",{parentName:"ul"},"On the app page click on ",(0,i.kt)("strong",{parentName:"li"},"Auth")," tab"),(0,i.kt)("li",{parentName:"ul"},"Fill the information:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Authorized redirect URL"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:1337/api/connect/linkedin/callback")))),(0,i.kt)("li",{parentName:"ul"},"On the app page click on ",(0,i.kt)("strong",{parentName:"li"},"Products")," tab."),(0,i.kt)("li",{parentName:"ul"},"Select ",(0,i.kt)("inlineCode",{parentName:"li"},"Sign In with LinkedIn")," from the product list to enable it.")),(0,i.kt)("h4",{id:"linkedin-strapi-config"},"Strapi configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the User Permissions provider settings page ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"http://localhost:1337/admin/settings/users-permissions/providers"},"http://localhost:1337/admin/settings/users-permissions/providers")),(0,i.kt)("li",{parentName:"ul"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"LinkedIn")," provider"),(0,i.kt)("li",{parentName:"ul"},"Fill the information:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Enable"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"ON")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Client ID"),": 84witsxk641rlv"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Client Secret"),": HdXO7a7mkrU5a6WN"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"The redirect URL to your front-end app"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:3000/connect/linkedin/redirect")))))),(0,i.kt)(c,{title:"CAS",value:"CAS",mdxType:"TabItem"},(0,i.kt)("h4",{id:"cas"},"Using ngrok"),(0,i.kt)("p",null,"A remote CAS server can be configured to accept ",(0,i.kt)("inlineCode",{parentName:"p"},"localhost")," URLs or you can run your own CAS server locally that accepts them."),(0,i.kt)("p",null,"The use of ",(0,i.kt)("inlineCode",{parentName:"p"},"ngrok")," is not needed."),(0,i.kt)("h4",{id:"cas-config"},"CAS configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/apereo/cas"},"CAS")," is an SSO server that supports many different methods of verifying a users identity,\nretrieving attributes out the user and communicating that information to applications via protocols such as SAML, OIDC, and the CAS protocol. Strapi can use a CAS server for authentication if CAS is deployed with support for OIDC."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("a",{parentName:"li",href:"https://github.com/apereo/cas"},"CAS")," could already be used by your company or organization or you can setup a local CAS server by cloning the ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/apereo/cas-overlay-template"},"CAS Overlay")," project or using the newer ",(0,i.kt)("a",{parentName:"li",href:"https://github.com/apereo/cas-initializr"},"CAS Initializr")," to create an overlay project."),(0,i.kt)("li",{parentName:"ul"},"The CAS server must be configured so it can act as an ",(0,i.kt)("a",{parentName:"li",href:"https://apereo.github.io/cas/6.6.x/installation/OIDC-Authentication.html"},"OpenID Connect Provider")),(0,i.kt)("li",{parentName:"ul"},"CAS version 6.3.x and higher is known to work with Strapi but older versions that support OIDC may work."),(0,i.kt)("li",{parentName:"ul"},"Define a CAS OIDC service for Strapi and store it in whichever CAS service registry is being used."),(0,i.kt)("li",{parentName:"ul"},"The CAS service definition might look something like this for a local strapi deployment:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{\n  "@class": "org.apereo.cas.services.OidcRegisteredService",\n  "clientId": "thestrapiclientid",\n  "clientSecret": "thestrapiclientsecret",\n  "bypassApprovalPrompt": true,\n  "serviceId": "^http(|s)://localhost:1337/.*",\n  "name": "Local Strapi",\n  "id": 20201103,\n  "evaluationOrder": 50,\n  "attributeReleasePolicy": {\n    "@class": "org.apereo.cas.services.ReturnMappedAttributeReleasePolicy",\n    "allowedAttributes": {\n      "@class": "java.util.TreeMap",\n      "strapiemail": "groovy { return attributes[\'mail\'].get(0) }",\n      "strapiusername": "groovy { return attributes[\'username\'].get(0) }"\n    }\n  }\n}\n')),(0,i.kt)("h4",{id:"cas-strapi-config"},"Strapi configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the User Permissions provider settings page ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"http://localhost:1337/admin/plugins/users-permissions/providers"},"http://localhost:1337/admin/plugins/users-permissions/providers")),(0,i.kt)("li",{parentName:"ul"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"Cas")," provider"),(0,i.kt)("li",{parentName:"ul"},"Fill the information:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Enable"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"ON")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Client ID"),": thestrapiclientid"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Client Secret"),": thestrapiclientsecret"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"The redirect URL to your front-end app"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:1337/api/connect/cas/redirect")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"The Provider Subdomain such that the following URLs are correct for the CAS deployment you are targeting:"))),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre"},"  authorize_url: https://[subdomain]/oidc/authorize\n  access_url: https://[subdomain]/oidc/token\n  profile_url: https://[subdomain]/oidc/profile\n")),"For example, if running CAS locally with a login URL of: ",(0,i.kt)("inlineCode",{parentName:"li"},"https://localhost:8443/cas/login"),", the value for the provider subdomain would be ",(0,i.kt)("inlineCode",{parentName:"li"},"localhost:8443/cas"),"."))),(0,i.kt)(c,{title:"Reddit",value:"Reddit",mdxType:"TabItem"},(0,i.kt)("h4",{id:"reddit"},"Using ngrok"),(0,i.kt)("p",null,"Reddit accepts the ",(0,i.kt)("inlineCode",{parentName:"p"},"localhost")," urls. ",(0,i.kt)("br",null),"\nThe use of ",(0,i.kt)("inlineCode",{parentName:"p"},"ngrok")," is not needed."),(0,i.kt)("h4",{id:"reddit-config"},"Reddit configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the Reddit authorized applications preferences page ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"https://www.reddit.com/prefs/apps"},"https://www.reddit.com/prefs/apps")),(0,i.kt)("li",{parentName:"ul"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"create another app...")," button near the bottom"),(0,i.kt)("li",{parentName:"ul"},"Select ",(0,i.kt)("strong",{parentName:"li"},"web app")," for the type"),(0,i.kt)("li",{parentName:"ul"},"Fill the ",(0,i.kt)("strong",{parentName:"li"},"name")," and ",(0,i.kt)("strong",{parentName:"li"},"redirect uri")," input in"),(0,i.kt)("li",{parentName:"ul"},"Click the ",(0,i.kt)("strong",{parentName:"li"},"create app")," button"),(0,i.kt)("li",{parentName:"ul"},"Note that the ",(0,i.kt)("strong",{parentName:"li"},"Client ID")," is located under the app type (web app)")),(0,i.kt)("h4",{id:"reddit-strapi-config"},"Strapi configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the User Permissions provider settings page ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"http://localhost:1337/admin/settings/users-permissions/providers"},"http://localhost:1337/admin/settings/users-permissions/providers")),(0,i.kt)("li",{parentName:"ul"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"Reddit")," provider"),(0,i.kt)("li",{parentName:"ul"},"Fill the information (replace with your own client ID and secret):",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Enable"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"ON")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Client ID"),": hmxSBOit0SCjSQ"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Client Secret"),": gwR9hCjK_PMYVYNGeDLS4WLB8g7xqg"),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"The redirect URL to your front-end app"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:3000/connect/reddit/redirect")))))),(0,i.kt)(c,{title:"Auth0",value:"Auth0",mdxType:"TabItem"},(0,i.kt)("h4",{id:"auth0"},"Using ngrok"),(0,i.kt)("p",null,"Auth0 accepts the ",(0,i.kt)("inlineCode",{parentName:"p"},"localhost")," urls. ",(0,i.kt)("br",null),"\nThe use of ",(0,i.kt)("inlineCode",{parentName:"p"},"ngrok")," is not needed."),(0,i.kt)("h4",{id:"auth0-config"},"Auth0 configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit your Auth0 tenant dashboard"),(0,i.kt)("li",{parentName:"ul"},"In API section, create a new API"),(0,i.kt)("li",{parentName:"ul"},"In application, create a ",(0,i.kt)("inlineCode",{parentName:"li"},"machine-to-machine")," application and select the API that you have just created"),(0,i.kt)("li",{parentName:"ul"},"In settings of this app set these values:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Allowed Callback URLs"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:1337/api/connect/auth0/callback")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Allowed Logout URLs"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:3000")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Allowed Web Origins"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:3000")))),(0,i.kt)("li",{parentName:"ul"},'At the bottom of settings, show "Advanced Settings" and go to the "Grant Types". Ensure that these grants are checked/enabled:',(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Implicit"),(0,i.kt)("li",{parentName:"ul"},"Authorization Code"),(0,i.kt)("li",{parentName:"ul"},"Refresh Token"),(0,i.kt)("li",{parentName:"ul"},"Client Credentials")))),(0,i.kt)("h4",{id:"auth0-strapi-config"},"Strapi configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the User Permissions provider settings page ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"http://localhost:1337/admin/settings/users-permissions/providers"},"http://localhost:1337/admin/settings/users-permissions/providers")),(0,i.kt)("li",{parentName:"ul"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"Auth0")," provider"),(0,i.kt)("li",{parentName:"ul"},"Fill the information:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Enable: ",(0,i.kt)("inlineCode",{parentName:"li"},"ON")),(0,i.kt)("li",{parentName:"ul"},"Client ID: ",(0,i.kt)("inlineCode",{parentName:"li"},"<Your Auth0 Client ID>")),(0,i.kt)("li",{parentName:"ul"},"Client Secret: ",(0,i.kt)("inlineCode",{parentName:"li"},"<Your Auth0 Client Secret>")),(0,i.kt)("li",{parentName:"ul"},"Subdomain: ",(0,i.kt)("inlineCode",{parentName:"li"},"<Your Auth0 tenant url>"),", example it is the part in bold in the following url: https://",(0,i.kt)("strong",{parentName:"li"},"my-tenant.eu"),".auth0.com/"),(0,i.kt)("li",{parentName:"ul"},"The redirect URL to your front-end app: ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:3000/connect/auth0/redirect")))))),(0,i.kt)(c,{value:"Patreon",label:"Patreon",mdxType:"TabItem"},(0,i.kt)("h4",{id:"patreon"},"Using ngrok"),(0,i.kt)("p",null,"Patreon does not accept ",(0,i.kt)("inlineCode",{parentName:"p"},"localhost")," urls. ",(0,i.kt)("br",null),"\nUse ",(0,i.kt)("inlineCode",{parentName:"p"},"ngrok")," to serve the backend app."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"ngrok http 1337\n")),(0,i.kt)("p",null,"Don't forget to update the server url in the Strapi config file ",(0,i.kt)("inlineCode",{parentName:"p"},"./config/server.js")," and the server URL in your frontend app (environment variable ",(0,i.kt)("inlineCode",{parentName:"p"},"REACT_APP_BACKEND_URL")," if you use ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/strapi/strapi-examples/tree/master/examples/login-react"},"react login example app"),") with the generated ngrok URL."),(0,i.kt)("h4",{id:"patreon-config"},"Patreon configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"You must be a Patreon Creator in order to register an Oauth client."),(0,i.kt)("li",{parentName:"ul"},"Go to the ",(0,i.kt)("a",{parentName:"li",href:"https://www.patreon.com/portal"},"Patreon developer portal")),(0,i.kt)("li",{parentName:"ul"},"Click on ",(0,i.kt)("a",{parentName:"li",href:"https://www.patreon.com/portal/registration/register-clients"},"Clients & API Keys")),(0,i.kt)("li",{parentName:"ul"},'Click on "Create Client"'),(0,i.kt)("li",{parentName:"ul"},"Enter the details of your organization and website."),(0,i.kt)("li",{parentName:"ul"},'There is a drop-down for "App Category" but no explanation of what the different categories mean.\n"Community" seems to work fine.'),(0,i.kt)("li",{parentName:"ul"},"You can choose either version 1 or version 2 of the API - neither are actively developed.\nVersion 2 is probably the best choice. See their\n",(0,i.kt)("a",{parentName:"li",href:"https://docs.patreon.com/#introduction"},"developer docs")," for more detail."),(0,i.kt)("li",{parentName:"ul"},'Under "Redirect URI\'s" enter ',(0,i.kt)("inlineCode",{parentName:"li"},"https://your-site.com/api/connect/patreon/callback")),(0,i.kt)("li",{parentName:"ul"},"Save the client details and you will then see the Client ID and Client Secret.")),(0,i.kt)("h4",{id:"patreon-strapi-config"},"Strapi configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the User Permissions provider settings page ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"http://localhost:1337/admin/settings/users-permissions/providers"},"http://localhost:1337/admin/settings/users-permissions/providers")),(0,i.kt)("li",{parentName:"ul"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"Patreon")," provider"),(0,i.kt)("li",{parentName:"ul"},"Fill the information:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Enable: ",(0,i.kt)("inlineCode",{parentName:"li"},"ON")),(0,i.kt)("li",{parentName:"ul"},"Client ID: ",(0,i.kt)("inlineCode",{parentName:"li"},"<Your Patreon Client ID>")," - as above"),(0,i.kt)("li",{parentName:"ul"},"Client Secret: ",(0,i.kt)("inlineCode",{parentName:"li"},"<Your Patreon Client Secret>")," - as above"))))),(0,i.kt)(c,{title:"Keycloak",value:"Keycloak",mdxType:"TabItem"},(0,i.kt)("h4",{id:"keycloak"},"Using ngrok"),(0,i.kt)("p",null,"Keycloak accepts the ",(0,i.kt)("inlineCode",{parentName:"p"},"localhost")," urls. ",(0,i.kt)("br",null),"\nThe use of ",(0,i.kt)("inlineCode",{parentName:"p"},"ngrok")," is not needed."),(0,i.kt)("h4",{id:"keycloak-config"},"Keycloak configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit your Keycloak admin dashboard"),(0,i.kt)("li",{parentName:"ul"},"If you don't already have a realm, you'll want to create one"),(0,i.kt)("li",{parentName:"ul"},"In the Clients section of your realm, create a new client"),(0,i.kt)("li",{parentName:"ul"},"Under the capability config, ensure you set ",(0,i.kt)("inlineCode",{parentName:"li"},"Client Authentication")," to on to ensure you can create a private key"),(0,i.kt)("li",{parentName:"ul"},"Under the access settings, ensure you set the following values:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Valid redirect URIs"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:1337/api/connect/keycloak/callback")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:1337/api/connect/keycloak")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Allowed Web Origins"),": ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:3000")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:1337")))),(0,i.kt)("li",{parentName:"ul"},"In the Client Scopes section, ensure you have the ",(0,i.kt)("inlineCode",{parentName:"li"},"email")," and ",(0,i.kt)("inlineCode",{parentName:"li"},"profile")," scopes set to default"),(0,i.kt)("li",{parentName:"ul"},"In the Client Scopes section, ensure you have the ",(0,i.kt)("inlineCode",{parentName:"li"},"openid")," scope set to default, if you don't have this you will need to manually create it in the global Client Scopes")),(0,i.kt)("h4",{id:"keycloak-strapi-config"},"Strapi configuration"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Visit the User Permissions provider settings page ",(0,i.kt)("br",null)," ",(0,i.kt)("a",{parentName:"li",href:"http://localhost:1337/admin/settings/users-permissions/providers"},"http://localhost:1337/admin/settings/users-permissions/providers")),(0,i.kt)("li",{parentName:"ul"},"Click on the ",(0,i.kt)("strong",{parentName:"li"},"Keycloak")," provider"),(0,i.kt)("li",{parentName:"ul"},"Fill the information:",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"Enable: ",(0,i.kt)("inlineCode",{parentName:"li"},"ON")),(0,i.kt)("li",{parentName:"ul"},"Client ID: ",(0,i.kt)("inlineCode",{parentName:"li"},"<Your Keycloak Client ID>")),(0,i.kt)("li",{parentName:"ul"},"Client Secret: ",(0,i.kt)("inlineCode",{parentName:"li"},"<Your Keycloak Client Secret>")),(0,i.kt)("li",{parentName:"ul"},"Subdomain: ",(0,i.kt)("inlineCode",{parentName:"li"},"<Your Keycloak realm url>"),", example is either ",(0,i.kt)("inlineCode",{parentName:"li"},"keycloak.example.com/realms/strapitest")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"keycloak.example.com/auth/realms/strapitest")," ",(0,i.kt)("strong",{parentName:"li"},"without the protocol before it")),(0,i.kt)("li",{parentName:"ul"},"The redirect URL to your front-end app: ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:3000/connect/keycloak/redirect")),(0,i.kt)("li",{parentName:"ul"},"(Optional) Set the JWKS URL if you have a custom JWKS URL, example is like ",(0,i.kt)("inlineCode",{parentName:"li"},"https://keycloak.example.com/auth/realms/strapitest/protocol/openid-connect/certs"))))))),(0,i.kt)("p",null,"Your configuration is done.\nLaunch the backend and the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/strapi/strapi-examples/tree/master/examples/login-react"},"react login example app"),", go to ",(0,i.kt)("inlineCode",{parentName:"p"},"http://localhost:3000")," and try to connect to the provider your configured."),(0,i.kt)("h4",{id:"setup-the-frontend"},"Setup the frontend"),(0,i.kt)("p",null,"Once you have configured strapi and the provider, in your frontend app you have to :"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Create a button that links to ",(0,i.kt)("inlineCode",{parentName:"li"},"GET STRAPI_BACKEND_URL/api/connect/${provider}")," (ex: ",(0,i.kt)("inlineCode",{parentName:"li"},"https://strapi.mywebsite/api/connect/github"),")."),(0,i.kt)("li",{parentName:"ul"},"Create a frontend route like ",(0,i.kt)("inlineCode",{parentName:"li"},"FRONTEND_URL/connect/${provider}/redirect")," that have to handle the ",(0,i.kt)("inlineCode",{parentName:"li"},"access_token")," param and that have to request ",(0,i.kt)("inlineCode",{parentName:"li"},"STRAPI_BACKEND_URL/api/auth/${provider}/callback")," with the ",(0,i.kt)("inlineCode",{parentName:"li"},"access_token")," parameter.",(0,i.kt)("br",null),"\nThe JSON request response will be ",(0,i.kt)("inlineCode",{parentName:"li"},'{ "jwt": "...", "user": {...} }'),".")),(0,i.kt)("p",null,"Now you can make authenticated requests. More info here: ",(0,i.kt)("a",{parentName:"p",href:"#token-usage"},"token usage"),"."),(0,i.kt)("admonition",{title:"Troubleshooting",type:"caution"},(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Error 429"),": It's most likely because your login flow fell into a loop. To make new requests to the backend, you need to wait a few minutes or restart the backend."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"Grant: missing session or misconfigured provider"),": It may be due to many things.",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"The redirect url can't be built"),": Make sure you have set the backend url in ",(0,i.kt)("inlineCode",{parentName:"li"},"config/server.js"),": ",(0,i.kt)("a",{parentName:"li",href:"#setting-up-the-server-url"},"Setting up the server url")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"A session/cookie/cache problem"),": You can try again in a private tab."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"The incorrect use of a domain with ngrok"),": Check your urls and make sure that you use the ngrok url instead of ",(0,i.kt)("inlineCode",{parentName:"li"},"http://localhost:1337"),". Don't forget to check the backend url set in the example app at ",(0,i.kt)("inlineCode",{parentName:"li"},"src/config.js"),"."))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("strong",{parentName:"li"},"You can't access your admin panel"),": It's most likely because you built it with the backend url set with a ngrok url and you stopped/restarted ngrok. You need to replace the backend url with the new ngrok url and run ",(0,i.kt)("inlineCode",{parentName:"li"},"yarn build")," or ",(0,i.kt)("inlineCode",{parentName:"li"},"npm run build")," again."))),(0,i.kt)("h3",{id:"reset-password"},"Reset password"),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"Can only be used for users registered using the email provider.")),(0,i.kt)(m,{mdxType:"Tabs"},(0,i.kt)(c,{value:"Forgot & Reset flow",mdxType:"TabItem"},(0,i.kt)("p",null,"The assumed general flow:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"The user goes to your ",(0,i.kt)("strong",{parentName:"li"},"forgotten password page"),"."),(0,i.kt)("li",{parentName:"ol"},"The user enters their email address."),(0,i.kt)("li",{parentName:"ol"},"Your forgotten password page sends a request to the backend to send an email with the reset password link to the user."),(0,i.kt)("li",{parentName:"ol"},"The user receives the email and clicks on the special link."),(0,i.kt)("li",{parentName:"ol"},"The link redirects the user to your ",(0,i.kt)("strong",{parentName:"li"},"reset password page"),"."),(0,i.kt)("li",{parentName:"ol"},"The user enters their new password."),(0,i.kt)("li",{parentName:"ol"},"The ",(0,i.kt)("strong",{parentName:"li"},"reset password page")," sends a request to the backend with the new password."),(0,i.kt)("li",{parentName:"ol"},"If the request contains the code contained in the link at step 3, the password is updated."),(0,i.kt)("li",{parentName:"ol"},"The user can log in with the new password.")),(0,i.kt)("p",null,"The following section details steps 3 and 7."),(0,i.kt)("h4",{id:"forgotten-password-ask-for-the-reset-password-link"},"Forgotten password: ask for the reset password link"),(0,i.kt)("p",null,"This action sends an email to a user with the link to your reset password page. The link will be enriched with the url param ",(0,i.kt)("inlineCode",{parentName:"p"},"code")," that is needed for the ",(0,i.kt)("a",{parentName:"p",href:"#reset-password"},"reset password")," at step 7."),(0,i.kt)("p",null,"First, you must specify the following:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"In the admin panel: ",(0,i.kt)("strong",{parentName:"li"},"Settings > USERS & PERMISSIONS PLUGIN > Advanced Settings > Reset Password")," page, the ",(0,i.kt)("inlineCode",{parentName:"li"},"url")," to your reset password page."),(0,i.kt)("li",{parentName:"ul"},"In the admin panel: ",(0,i.kt)("strong",{parentName:"li"},"Settings > USERS & PERMISSIONS PLUGIN > Email Template")," page, the ",(0,i.kt)("strong",{parentName:"li"},"Shipper email"),".")),(0,i.kt)("p",null,"Then, your ",(0,i.kt)("strong",{parentName:"p"},"forgotten password page")," has to make the following request to your backend:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"import axios from 'axios';\n\n// Request API.\naxios\n  .post('http://localhost:1337/api/auth/forgot-password', {\n    email: 'user@strapi.io', // user's email\n  })\n  .then(response => {\n    console.log('Your user received an email');\n  })\n  .catch(error => {\n    console.log('An error occurred:', error.response);\n  });\n")),(0,i.kt)("h4",{id:"reset-password-send-the-new-password"},"Reset Password: send the new password"),(0,i.kt)("p",null,"This action will update the user password.\nThis also works with the ",(0,i.kt)("a",{parentName:"p",href:"./graphql"},"GraphQL Plugin"),", with the ",(0,i.kt)("inlineCode",{parentName:"p"},"resetPassword")," mutation."),(0,i.kt)("p",null,"Your ",(0,i.kt)("strong",{parentName:"p"},"reset password page")," has to make the following request to your backend:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"import axios from 'axios';\n\n// Request API.\naxios\n  .post('http://localhost:1337/api/auth/reset-password', {\n    code: 'privateCode', // code contained in the reset link of step 3.\n    password: 'userNewPassword',\n    passwordConfirmation: 'userNewPassword',\n  })\n  .then(response => {\n    console.log(\"Your user's password has been reset.\");\n  })\n  .catch(error => {\n    console.log('An error occurred:', error.response);\n  });\n"))),(0,i.kt)(c,{title:"Change the password flow",value:"Change the password flow",mdxType:"TabItem"},(0,i.kt)("p",null,"You can also update an authenticated user password through the ",(0,i.kt)("inlineCode",{parentName:"p"},"/change-password")," API endpoint:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"import axios from 'axios';\n\n// Request API.\naxios.post(\n  'http://localhost:1337/api/auth/change-password',\n  {\n    currentPassword: 'currentPassword',\n    password: 'userNewPassword',\n    passwordConfirmation: 'userNewPassword',\n  },\n  {\n    headers: {\n      Authorization: 'Bearer <user jwt>',\n    },\n  }\n);\n")))),(0,i.kt)("h3",{id:"email-validation"},"Email validation"),(0,i.kt)("admonition",{type:"note"},(0,i.kt)("p",{parentName:"admonition"},"In production, make sure the ",(0,i.kt)("inlineCode",{parentName:"p"},"url")," config property is set. Otherwise the validation link will redirect to ",(0,i.kt)("inlineCode",{parentName:"p"},"localhost"),". More info on the config ",(0,i.kt)("a",{parentName:"p",href:"/dev-docs/configurations/server"},"here"),".")),(0,i.kt)("p",null,"After registering, if you have set ",(0,i.kt)("strong",{parentName:"p"},"Enable email confirmation")," to ",(0,i.kt)("strong",{parentName:"p"},"ON"),", the user will receive a confirmation link by email. The user has to click on it to validate their registration."),(0,i.kt)("p",null,"Example of the confirmation link: ",(0,i.kt)("inlineCode",{parentName:"p"},"https://yourwebsite.com/api/auth/email-confirmation?confirmation=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpZCI6MywiaWF0IjoxNTk0OTgxMTE3LCJleHAiOjE1OTc1NzMxMTd9.0WeB-mvuguMyr4eY8CypTZDkunR--vZYzZH6h6sChFg")),(0,i.kt)("p",null,"If needed you can re-send the confirmation email by making the following request:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"import axios from 'axios';\n\n// Request API.\naxios\n  .post(`http://localhost:1337/api/auth/send-email-confirmation`, {\n    email: 'user@strapi.io', // user's email\n  })\n  .then(response => {\n    console.log('Your user received an email');\n  })\n  .catch(error => {\n    console.error('An error occurred:', error.response);\n  });\n")),(0,i.kt)("h2",{id:"user-object-in-strapi-context"},"User object in Strapi context"),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"user")," object is available to successfully authenticated requests."),(0,i.kt)("p",null,"The authenticated ",(0,i.kt)("inlineCode",{parentName:"p"},"user")," object is a property of ",(0,i.kt)("inlineCode",{parentName:"p"},"ctx.state"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},"create: async ctx => {\n  const { id } = ctx.state.user;\n\n  const depositObj = {\n    ...ctx.request.body,\n    depositor: id,\n  };\n\n  const data = await strapi.services.deposit.add(depositObj);\n\n  // Send 201 `created`\n  ctx.created(data);\n};\n")),(0,i.kt)("h2",{id:"templating-emails"},"Templating emails"),(0,i.kt)("p",null,"By default this plugin comes with two templates: reset password and email address confirmation. The templates use Lodash's ",(0,i.kt)("inlineCode",{parentName:"p"},"template()")," method to populate the variables."),(0,i.kt)("p",null,"You can update these templates under ",(0,i.kt)("strong",{parentName:"p"},"Plugins")," > ",(0,i.kt)("strong",{parentName:"p"},"Roles & Permissions")," > ",(0,i.kt)("strong",{parentName:"p"},"Email Templates")," tab in the admin panel."),(0,i.kt)("h3",{id:"reset-password-1"},"Reset Password"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"USER")," (object)",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"username")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"email")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"TOKEN")," corresponds to the token generated to be able to reset the password."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"URL")," is the link where the user will be redirected after clicking on it in the email."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"SERVER_URL")," is the absolute server url (configured in server configuration).")),(0,i.kt)("h3",{id:"email-address-confirmation"},"Email address confirmation"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"USER")," (object)",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"username")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"email")))),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"CODE")," corresponds to the CODE generated to be able confirm the user email."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"URL")," is the Strapi backend URL that confirms the code (by default ",(0,i.kt)("inlineCode",{parentName:"li"},"/auth/email-confirmation"),")."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"SERVER_URL")," is the absolute server url (configured in server configuration).")),(0,i.kt)("h2",{id:"security-configuration"},"Security configuration"),(0,i.kt)("p",null,"JWTs can be verified and trusted because the information is digitally signed. To sign a token a ",(0,i.kt)("em",{parentName:"p"},"secret")," is required. By default Strapi generates and stores it in ",(0,i.kt)("inlineCode",{parentName:"p"},"./extensions/users-permissions/config/jwt.js"),"."),(0,i.kt)("p",null,"This is useful during development but for security reasons it is recommended to set a custom token via an environment variable ",(0,i.kt)("inlineCode",{parentName:"p"},"JWT_SECRET")," when deploying to production."),(0,i.kt)("p",null,"By default you can set a ",(0,i.kt)("inlineCode",{parentName:"p"},"JWT_SECRET")," environment variable and it will be used as secret. If you want to use another variable you can update the configuration file."),(0,i.kt)(m,{groupId:"js-ts",mdxType:"Tabs"},(0,i.kt)(c,{value:"javascript",label:"JavaScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="./extensions/users-permissions/config/jwt.js"',title:'"./extensions/users-permissions/config/jwt.js"'},"\nmodule.exports = {\n  jwtSecret: process.env.SOME_ENV_VAR,\n};\n"))),(0,i.kt)(c,{value:"typescript",label:"TypeScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="./extensions/users-permissions/config/jwt.ts"',title:'"./extensions/users-permissions/config/jwt.ts"'},"\nexport default {\n  jwtSecret: process.env.SOME_ENV_VAR,\n};\n")))),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"You can learn more about configuration ",(0,i.kt)("a",{parentName:"p",href:"/dev-docs/configurations"},"here"),".")),(0,i.kt)("h3",{id:"creating-a-custom-callback-validator"},"Creating a custom callback validator"),(0,i.kt)("p",null,"By default, Strapi SSO only redirects to the redirect URL that is exactly equal to the url in the configuration:"),(0,i.kt)(k,{alt:"Users & Permissions configuration",sources:{light:"/img/assets/users-permissions/sso-config-custom-validator.png",dark:"/img/assets/users-permissions/sso-config-custom-validator_DARK.png"},mdxType:"ThemedImage"}),(0,i.kt)("p",null,"If you need to configure a custom handler to accept other URLs, you can create a callback ",(0,i.kt)("inlineCode",{parentName:"p"},"validate")," function in your plugins.js for the ",(0,i.kt)("inlineCode",{parentName:"p"},"users-permissions")," plugin."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-tsx",metastring:'title="/config/plugins.js|ts"',title:'"/config/plugins.js|ts"'},"  // ... other plugins configuration ...\n  // Users & Permissions configuration\n  'users-permissions': {\n    enabled: true,\n    config: {\n      callback: {\n        validate: (cbUrl, options) => {\n          // cbUrl is where Strapi is being asked to redirect the auth info\n          // that was received from the provider to\n          \n          // in this case, we will only validate that the \n          // if using a base url, you should always include the trailing slash\n          // although in real-world usage you should also include the full paths\n          if (cbUrl.startsWith('https://myproxy.mysite.com/') || \n              cbUrl.startsWith('https://mysite.com/')) {\n            return;\n          }\n\n          // Note that you MUST throw an error to fail validation\n          // return values are not checked\n          throw new Error('Invalid callback url');\n        },\n      },\n    },\n  },\n")))}h.isMDXComponent=!0}}]);