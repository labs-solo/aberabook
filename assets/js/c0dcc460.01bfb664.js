"use strict";(self.webpackChunkstrapi_docs=self.webpackChunkstrapi_docs||[]).push([[1768],{3905:(e,t,a)=>{a.d(t,{Zo:()=>l,kt:()=>v});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function c(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},l=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},d=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,l=c(e,["components","mdxType","originalType","parentName"]),d=p(a),v=r,u=d["".concat(s,".").concat(v)]||d[v]||m[v]||i;return a?n.createElement(u,o(o({ref:t},l),{},{components:a})):n.createElement(u,o({ref:t},l))}));function v(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=d;var c={};for(var s in t)hasOwnProperty.call(t,s)&&(c[s]=t[s]);c.originalType=e,c.mdxType="string"==typeof e?e:r,o[1]=c;for(var p=2;p<i;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}d.displayName="MDXCreateElement"},5773:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>c,toc:()=>p});var n=a(83117),r=(a(67294),a(3905));const i={title:"Services",displayed_sidebar:"devDocsSidebar",description:"Migrate services of a Strapi application from v3.6.x to v4.0.x",next:"./content-type-schema.md"},o="v4 code migration: Updating services",c={unversionedId:"dev-docs/migration/v3-to-v4/code/services",id:"dev-docs/migration/v3-to-v4/code/services",title:"Services",description:"Migrate services of a Strapi application from v3.6.x to v4.0.x",source:"@site/docs/dev-docs/migration/v3-to-v4/code/services.md",sourceDirName:"dev-docs/migration/v3-to-v4/code",slug:"/dev-docs/migration/v3-to-v4/code/services",permalink:"/aberabook/dev-docs/migration/v3-to-v4/code/services",draft:!1,editUrl:"https://github.com/labs-solo/aberabook/edit/main/docusaurus/docs/dev-docs/migration/v3-to-v4/code/services.md",tags:[],version:"current",frontMatter:{title:"Services",displayed_sidebar:"devDocsSidebar",description:"Migrate services of a Strapi application from v3.6.x to v4.0.x",next:"./content-type-schema.md"},sidebar:"devDocsSidebar",previous:{title:"Routes",permalink:"/aberabook/dev-docs/migration/v3-to-v4/code/routes"},next:{title:"Frontend code migration",permalink:"/aberabook/dev-docs/migration/v3-to-v4/code/frontend"}},s={},p=[],l={toc:p};function m(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},l,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"v4-code-migration-updating-services"},"v4 code migration: Updating services"),(0,r.kt)("p",null,"This guide is part of the ",(0,r.kt)("a",{parentName:"p",href:"/aberabook/dev-docs/migration/v3-to-v4/code-migration"},"v4 code migration guide")," designed to help you migrate the code of a Strapi application from v3.6.x to v4.0.x"),(0,r.kt)("p",null,":::strapi v3/v4 comparison\nIn both Strapi v3 and v4, creating content-types automatically generates core API services. Services are a set of reusable functions."),(0,r.kt)("p",null,"In Strapi v3, services export an object containing actions that are merged with the existing actions of core API services, allowing customization."),(0,r.kt)("p",null,"In Strapi v4, services export the result of a call to the ",(0,r.kt)("a",{parentName:"p",href:"/dev-docs/backend-customization/services#adding-a-new-service"},(0,r.kt)("inlineCode",{parentName:"a"},"createCoreService")," factory function"),", with or without further customization.\n:::"),(0,r.kt)("p",null,"Migrating a ",(0,r.kt)("a",{parentName:"p",href:"/dev-docs/backend-customization/services"},"service")," to Strapi v4 consists in making sure it uses the ",(0,r.kt)("inlineCode",{parentName:"p"},"createCoreService")," factory function introduced in v4."),(0,r.kt)("p",null,"Due to the differences between services implementation in Strapi v3 and v4, it's recommended to create a new service file, then optionally bring existing v3 customizations into the new file and adapt them when necessary."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"The service file can be created automatically with the ",(0,r.kt)("a",{parentName:"p",href:"/dev-docs/cli#strapi-generate"},"interactive CLI command ",(0,r.kt)("inlineCode",{parentName:"a"},"strapi generate")),".")),(0,r.kt)("p",null,"To create a Strapi v4 service:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a ",(0,r.kt)("inlineCode",{parentName:"p"},"api/<api-name>/services/<service-name>.js")," file inside the ",(0,r.kt)("inlineCode",{parentName:"p"},"./src")," folder (see ",(0,r.kt)("a",{parentName:"p",href:"/dev-docs/project-structure"},"project structure"),").")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Copy and paste the following code at the top of the ",(0,r.kt)("inlineCode",{parentName:"p"},"./src/api/<api-name>/services/<service-name>.js")," file. The code imports the ",(0,r.kt)("inlineCode",{parentName:"p"},"createCoreService")," factory function from the factories included with the core of Strapi:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const { createCoreService } = require('@strapi/strapi').factories;\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Copy and paste the following code, replacing ",(0,r.kt)("inlineCode",{parentName:"p"},"api-name")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"content-type-name")," with appropriate names. The code exports the result of a call to the ",(0,r.kt)("inlineCode",{parentName:"p"},"createCoreService")," factory function, passing the unique identifier of the content-type (e.g. ",(0,r.kt)("inlineCode",{parentName:"p"},"api::api-name.content-type-name"),") as an argument:"),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = createCoreService('api::api-name.content-type-name')\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"(",(0,r.kt)("em",{parentName:"p"},"optional"),") To customize the service, pass a second argument to the ",(0,r.kt)("inlineCode",{parentName:"p"},"createCoreService")," factory function. This argument can be either an object or a function returning an object. The object contains methods, which can either be entirely new actions or replace or extend existing actions of core API controllers (see ",(0,r.kt)("a",{parentName:"p",href:"/dev-docs/backend-customization/services#implementation"},"services implementation documentation"),")."))),(0,r.kt)("details",null,(0,r.kt)("summary",null," Example of a v4 service without customization:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="./src/api/<content-type-name>/services/<service-name>.js"',title:'"./src/api/<content-type-name>/services/<service-name>.js"'},"\nconst { createCoreService } = require('@strapi/strapi').factories;\n\nmodule.exports = createCoreService('api::api-name.content-type-name');\n"))),(0,r.kt)("details",null,(0,r.kt)("summary",null," Example of a v4 service with customization:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="./src/api/<content-type-name>/services/<service-name>.js"',title:'"./src/api/<content-type-name>/services/<service-name>.js"'},"\nconst { createCoreService } = require('@strapi/strapi').factories;\n\nmodule.exports = createCoreService('api::api-name.content-type-name', ({ strapi }) => ({\n  async find(...args) {\n    const { results, pagination } = await super.find(...args);\n\n    results.forEach(result => {\n      result.counter = 1;\n    });\n\n    return { results, pagination };\n  },\n}));\n\n"))),(0,r.kt)("admonition",{title:"Customization tips",type:"tip"},(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"The original service\u2019s CRUD methods can be called using ",(0,r.kt)("inlineCode",{parentName:"li"},"super")," (e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"super.find()"),")."),(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"this.getFetchParams()")," utility function can be used to wrap parameters with some default parameters (e.g. a default value for ",(0,r.kt)("a",{parentName:"li",href:"/dev-docs/api/rest/filters-locale-publication#publication-state"},"the ",(0,r.kt)("inlineCode",{parentName:"a"},"publicationState")),"). ",(0,r.kt)("inlineCode",{parentName:"li"},"this.getFetchParams()")," has the following signature: ",(0,r.kt)("inlineCode",{parentName:"li"},"(params: Object) => Object"),".")),(0,r.kt)("p",{parentName:"admonition"},"More examples can be found in the ",(0,r.kt)("a",{parentName:"p",href:"/dev-docs/backend-customization/services#implementation"},"services implementation documentation"),".")),(0,r.kt)("p",null,":::strapi Next steps\n",(0,r.kt)("a",{parentName:"p",href:"/dev-docs/migration/v3-to-v4/code/backend"},"Migrating the backend code")," of Strapi to v4 also requires to at least migrate the core features of the Strapi server, such as the ",(0,r.kt)("a",{parentName:"p",href:"/dev-docs/migration/v3-to-v4/code/configuration"},"configuration"),", ",(0,r.kt)("a",{parentName:"p",href:"/dev-docs/migration/v3-to-v4/code/dependencies"},"dependencies"),", ",(0,r.kt)("a",{parentName:"p",href:"/dev-docs/migration/v3-to-v4/code/routes"},"routes"),", ",(0,r.kt)("a",{parentName:"p",href:"/dev-docs/migration/v3-to-v4/code/controllers"},"controllers"),", and ",(0,r.kt)("a",{parentName:"p",href:"/dev-docs/migration/v3-to-v4/code/content-type-schema"},"content-type schemas"),".\n:::"))}m.isMDXComponent=!0}}]);