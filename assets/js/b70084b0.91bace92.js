"use strict";(self.webpackChunkstrapi_docs=self.webpackChunkstrapi_docs||[]).push([[7410,6480],{3905:(t,e,n)=>{n.d(e,{Zo:()=>s,kt:()=>k});var a=n(67294);function r(t,e,n){return e in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function l(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(t);e&&(a=a.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),n.push.apply(n,a)}return n}function i(t){for(var e=1;e<arguments.length;e++){var n=null!=arguments[e]?arguments[e]:{};e%2?l(Object(n),!0).forEach((function(e){r(t,e,n[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):l(Object(n)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(n,e))}))}return t}function o(t,e){if(null==t)return{};var n,a,r=function(t,e){if(null==t)return{};var n,a,r={},l=Object.keys(t);for(a=0;a<l.length;a++)n=l[a],e.indexOf(n)>=0||(r[n]=t[n]);return r}(t,e);if(Object.getOwnPropertySymbols){var l=Object.getOwnPropertySymbols(t);for(a=0;a<l.length;a++)n=l[a],e.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}var d=a.createContext({}),p=function(t){var e=a.useContext(d),n=e;return t&&(n="function"==typeof t?t(e):i(i({},e),t)),n},s=function(t){var e=p(t.components);return a.createElement(d.Provider,{value:e},t.children)},m={inlineCode:"code",wrapper:function(t){var e=t.children;return a.createElement(a.Fragment,{},e)}},u=a.forwardRef((function(t,e){var n=t.components,r=t.mdxType,l=t.originalType,d=t.parentName,s=o(t,["components","mdxType","originalType","parentName"]),u=p(n),k=r,c=u["".concat(d,".").concat(k)]||u[k]||m[k]||l;return n?a.createElement(c,i(i({ref:e},s),{},{components:n})):a.createElement(c,i({ref:e},s))}));function k(t,e){var n=arguments,r=e&&e.mdxType;if("string"==typeof t||r){var l=n.length,i=new Array(l);i[0]=u;var o={};for(var d in e)hasOwnProperty.call(e,d)&&(o[d]=e[d]);o.originalType=t,o.mdxType="string"==typeof t?t:r,i[1]=o;for(var p=2;p<l;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},55935:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>d,contentTitle:()=>i,default:()=>k,frontMatter:()=>l,metadata:()=>o,toc:()=>m});var a=n(83117),r=(n(67294),n(3905));n(17155);const l={title:"Requests and Responses",description:"Learn more about requests and responses for Strapi, the most popular headless CMS."},i="Requests and Responses",o={unversionedId:"dev-docs/backend-customization/requests-responses",id:"dev-docs/backend-customization/requests-responses",title:"Requests and Responses",description:"Learn more about requests and responses for Strapi, the most popular headless CMS.",source:"@site/docs/dev-docs/backend-customization/requests-responses.md",sourceDirName:"dev-docs/backend-customization",slug:"/dev-docs/backend-customization/requests-responses",permalink:"/dev-docs/backend-customization/requests-responses",draft:!1,editUrl:"https://github.com/labs-solo/aberabook/edit/main/docusaurus/docs/dev-docs/backend-customization/requests-responses.md",tags:[],version:"current",frontMatter:{title:"Requests and Responses",description:"Learn more about requests and responses for Strapi, the most popular headless CMS."}},d={},p={width:"100%",margin:"0"},s={fontSize:"12px"},m=[{value:"<code>ctx.request</code>",id:"ctxrequest",level:2},{value:"<code>ctx.request.query</code>",id:"ctxrequestquery",level:3},{value:"<code>ctx.state</code>",id:"ctxstate",level:2},{value:"<code>ctx.state.user</code>",id:"ctxstateuser",level:3},{value:"<code>ctx.state.auth</code>",id:"ctxstateauth",level:3},{value:"<code>ctx.state.route</code>",id:"ctxstateroute",level:3},{value:"<code>ctx.response</code>",id:"ctxresponse",level:2},{value:"Accessing the request context anywhere",id:"accessing-the-request-context-anywhere",level:2}],u={toc:m};function k(t){let{components:e,...n}=t;return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"requests-and-responses"},"Requests and Responses"),(0,r.kt)("p",null,"The Strapi back end server is based on ",(0,r.kt)("a",{parentName:"p",href:"https://koajs.com/"},"Koa"),". When you send requests through the ",(0,r.kt)("a",{parentName:"p",href:"/dev-docs/api/rest"},"REST API"),", a context object (",(0,r.kt)("inlineCode",{parentName:"p"},"ctx"),") is passed to every element of the Strapi back end (e.g., ",(0,r.kt)("a",{parentName:"p",href:"/dev-docs/backend-customization/policies"},"policies"),", ",(0,r.kt)("a",{parentName:"p",href:"/dev-docs/backend-customization/controllers"},"controllers"),", ",(0,r.kt)("a",{parentName:"p",href:"/dev-docs/backend-customization/services"},"services"),")."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"ctx")," includes 3 main objects:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#ctxrequest"},(0,r.kt)("inlineCode",{parentName:"a"},"ctx.request"))," for information about the request sent by the client making an API request,"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"#ctxstate"},(0,r.kt)("inlineCode",{parentName:"a"},"ctx.state"))," for information about the state of the request within the Strapi back end,"),(0,r.kt)("li",{parentName:"ul"},"and ",(0,r.kt)("a",{parentName:"li",href:"#ctxresponse"},(0,r.kt)("inlineCode",{parentName:"a"},"ctx.response"))," for information about the response that the server will return.")),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"The request's context can also be accessed from anywhere in the code with the ",(0,r.kt)("a",{parentName:"p",href:"#accessing-the-request-context-anywhere"},(0,r.kt)("inlineCode",{parentName:"a"},"strapi.requestContext")," function"),".")),(0,r.kt)("admonition",{type:"info"},(0,r.kt)("p",{parentName:"admonition"},"In addition to the concepts and parameters described in the following documentation, you might find additional information in the ",(0,r.kt)("a",{parentName:"p",href:"http://koajs.com/#request"},"Koa request documentation"),", ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/koajs/router/blob/master/API.md"},"Koa Router documentation")," and ",(0,r.kt)("a",{parentName:"p",href:"http://koajs.com/#response"},"Koa response documentation"),".")),(0,r.kt)("figure",{style:p},(0,r.kt)("img",{src:"/img/assets/backend-customization/diagram-requests-responses.png",alt:"Simplified Strapi backend diagram with requests and responses highlighted"}),(0,r.kt)("em",null,(0,r.kt)("figcaption",{style:s},"The diagram represents a simplified version of how a request travels through the Strapi back end, with requests and responses highlighted. The backend customization introduction page includes a complete, ",(0,r.kt)("a",{href:"/dev-docs/backend-customization#interactive-diagram"},"interactive diagram"),"."))),(0,r.kt)("h2",{id:"ctxrequest"},(0,r.kt)("inlineCode",{parentName:"h2"},"ctx.request")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"ctx.request")," object contains the following parameters:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.body")),(0,r.kt)("td",{parentName:"tr",align:null},"Parsed version of the body."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Object"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.files")),(0,r.kt)("td",{parentName:"tr",align:null},"Files sent with the request."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Array"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.headers")),(0,r.kt)("td",{parentName:"tr",align:null},"Headers sent with the request."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Object"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.host")),(0,r.kt)("td",{parentName:"tr",align:null},"Host part of the URL, including the port."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"String"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.hostname")),(0,r.kt)("td",{parentName:"tr",align:null},"Host part of the URL, excluding the port."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"String"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.href")),(0,r.kt)("td",{parentName:"tr",align:null},"Complete URL of the requested resource, including the protocol, domain, port (if specified), path, and query parameters."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"String"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.ip")),(0,r.kt)("td",{parentName:"tr",align:null},"IP of the person sending the request."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"String"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.ips")),(0,r.kt)("td",{parentName:"tr",align:null},"When ",(0,r.kt)("inlineCode",{parentName:"td"},"X-Forwarded-For")," is present and ",(0,r.kt)("inlineCode",{parentName:"td"},"app.proxy")," is enabled, an array of IPs is returned, ordered from upstream to downstream. ",(0,r.kt)("br",null),(0,r.kt)("br",null),'For example if the value were "client, proxy1, proxy2", you would receive the ',(0,r.kt)("inlineCode",{parentName:"td"},'["client", "proxy1", "proxy2"]')," array."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Array"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.method")),(0,r.kt)("td",{parentName:"tr",align:null},"Request method (e.g., ",(0,r.kt)("inlineCode",{parentName:"td"},"GET"),", ",(0,r.kt)("inlineCode",{parentName:"td"},"POST"),")."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"String"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.origin")),(0,r.kt)("td",{parentName:"tr",align:null},"URL part before the first ",(0,r.kt)("inlineCode",{parentName:"td"},"/"),"."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"String"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.params")),(0,r.kt)("td",{parentName:"tr",align:null},"Parameters sent in the URL.",(0,r.kt)("br",null),(0,r.kt)("br",null),"For example, if the internal URL is ",(0,r.kt)("inlineCode",{parentName:"td"},"/restaurants/:id"),", whatever you replace ",(0,r.kt)("inlineCode",{parentName:"td"},":id")," in the real request becomes accessible through ",(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.params.id"),"."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Object"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.path")),(0,r.kt)("td",{parentName:"tr",align:null},"Path of the requested resource, excluding the query parameters."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"String"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.protocol")),(0,r.kt)("td",{parentName:"tr",align:null},"Protocol being used (e.g., ",(0,r.kt)("inlineCode",{parentName:"td"},"https")," or ",(0,r.kt)("inlineCode",{parentName:"td"},"http"),")."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"String"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.query")),(0,r.kt)("td",{parentName:"tr",align:null},"Strapi-specific ",(0,r.kt)("a",{parentName:"td",href:"#ctxrequestquery"},"query parameters"),"."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Object"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.subdomains")),(0,r.kt)("td",{parentName:"tr",align:null},"Subdomains included in the URL.",(0,r.kt)("br",null),(0,r.kt)("br",null),"For example, if the domain is ",(0,r.kt)("inlineCode",{parentName:"td"},"tobi.ferrets.example.com"),", the value is the following array: ",(0,r.kt)("inlineCode",{parentName:"td"},'["ferrets", "tobi"]'),"."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Array"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.url")),(0,r.kt)("td",{parentName:"tr",align:null},"Path and query parameters of the requested resource, excluding the protocol, domain, and port."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"String"))))),(0,r.kt)("details",null,(0,r.kt)("summary",null,"Differences between protocol, origin, url, href, path, host, and hostname :"),(0,r.kt)("p",null,"Given an API request sent to the ",(0,r.kt)("inlineCode",{parentName:"p"},"https://example.com:1337/api/restaurants?id=123")," URL, here is what different parameters of the ",(0,r.kt)("inlineCode",{parentName:"p"},"ctx.request")," object return:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Returned value"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.href")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"https://example.com:1337/api/restaurants?id=123"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.protocol")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"https"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.host")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"localhost:1337"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.hostname")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"localhost"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.origin")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"https://example.com:1337"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.url")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"/api/restaurants?id=123"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.path")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"/api/restaurants")))))),(0,r.kt)("h3",{id:"ctxrequestquery"},(0,r.kt)("inlineCode",{parentName:"h3"},"ctx.request.query")),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"ctx.request")," provides a ",(0,r.kt)("inlineCode",{parentName:"p"},"query")," object that gives access to Strapi query parameters. The following table lists available parameters with a short description and a link to the relevant REST API documentation section (see ",(0,r.kt)("a",{parentName:"p",href:"/dev-docs/api/rest/parameters"},"REST API parameters")," for more information):"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.query"),(0,r.kt)("br",null),(0,r.kt)("inlineCode",{parentName:"td"},"ctx.query")),(0,r.kt)("td",{parentName:"tr",align:null},"The whole query object."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Object"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.query.sort")),(0,r.kt)("td",{parentName:"tr",align:null},"Parameters to ",(0,r.kt)("a",{parentName:"td",href:"/dev-docs/api/rest/sort-pagination.md#sorting"},"sort the response")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"String")," or ",(0,r.kt)("inlineCode",{parentName:"td"},"Array"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.query.filters")),(0,r.kt)("td",{parentName:"tr",align:null},"Parameters to ",(0,r.kt)("a",{parentName:"td",href:"/dev-docs/api/rest/filters-locale-publication#filtering"},"filter the response")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Object"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.query.populate")),(0,r.kt)("td",{parentName:"tr",align:null},"Parameters to ",(0,r.kt)("a",{parentName:"td",href:"/dev-docs/api/rest/populate-select#population"},"populate relations, components, or dynamic zones")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"String")," or ",(0,r.kt)("inlineCode",{parentName:"td"},"Object"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.query.fields")),(0,r.kt)("td",{parentName:"tr",align:null},"Parameters to ",(0,r.kt)("a",{parentName:"td",href:"/dev-docs/api/rest/populate-select#field-selection"},"select only specific fields to return with the response")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Array"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.query.pagination")),(0,r.kt)("td",{parentName:"tr",align:null},"Parameter to ",(0,r.kt)("a",{parentName:"td",href:"/dev-docs/api/rest/sort-pagination.md#pagination"},"page through entries")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Object"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.query.publicationState")),(0,r.kt)("td",{parentName:"tr",align:null},"Parameter to ",(0,r.kt)("a",{parentName:"td",href:"/dev-docs/api/rest/filters-locale-publication#publication-state"},"select the Draft & Publish state")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"String"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.request.query.locale")),(0,r.kt)("td",{parentName:"tr",align:null},"Parameter to ",(0,r.kt)("a",{parentName:"td",href:"/dev-docs/api/rest/filters-locale-publication#locale"},"select one or multiple locales")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"String")," or ",(0,r.kt)("inlineCode",{parentName:"td"},"Array"))))),(0,r.kt)("h2",{id:"ctxstate"},(0,r.kt)("inlineCode",{parentName:"h2"},"ctx.state")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"ctx.state")," object gives access to the state of the request within the Strapi back end, including specific values about the ",(0,r.kt)("a",{parentName:"p",href:"#ctxstateuser"},"user"),", ",(0,r.kt)("a",{parentName:"p",href:"#ctxstateauth"},"authentication"),", ",(0,r.kt)("a",{parentName:"p",href:"#ctxstateroute"},"route"),":"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.state.isAuthenticated")),(0,r.kt)("td",{parentName:"tr",align:null},"Returns whether the current user is authenticated in any way."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Boolean"))))),(0,r.kt)("h3",{id:"ctxstateuser"},(0,r.kt)("inlineCode",{parentName:"h3"},"ctx.state.user")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"ctx.state.user")," object gives access to information about the user performing the request and includes the following parameters:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.state.user")),(0,r.kt)("td",{parentName:"tr",align:null},"User's information. Only one relation is populated."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Object"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.state.user.role")),(0,r.kt)("td",{parentName:"tr",align:null},"The user's role"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Object"))))),(0,r.kt)("h3",{id:"ctxstateauth"},(0,r.kt)("inlineCode",{parentName:"h3"},"ctx.state.auth")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"ctx.state.auth")," object gives access to information related to the authentication and includes the following parameters:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.state.auth.strategy")),(0,r.kt)("td",{parentName:"tr",align:null},"Information about the currently used authentication strategy (",(0,r.kt)("a",{parentName:"td",href:"/dev-docs/plugins/users-permissions"},"Users & Permissions plugin")," or ",(0,r.kt)("a",{parentName:"td",href:"/dev-docs/configurations/api-tokens"},"API tokens"),")"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Object"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.state.auth.strategy.name")),(0,r.kt)("td",{parentName:"tr",align:null},"Name of the currently used strategy"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"String"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.state.auth.credentials")),(0,r.kt)("td",{parentName:"tr",align:null},"The user's credentials"),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"String"))))),(0,r.kt)("h3",{id:"ctxstateroute"},(0,r.kt)("inlineCode",{parentName:"h3"},"ctx.state.route")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"ctx.state.route")," object gives access to information related to the current route and includes the following parameters:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.state.route.method")),(0,r.kt)("td",{parentName:"tr",align:null},"Method used to access the current route."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"String"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.state.route.path")),(0,r.kt)("td",{parentName:"tr",align:null},"Path of the current route."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"String"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.state.route.config")),(0,r.kt)("td",{parentName:"tr",align:null},"Configuration information about the current route."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Object"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.state.route.handler")),(0,r.kt)("td",{parentName:"tr",align:null},"Handler (controller) of the current route."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Object"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.state.route.info")),(0,r.kt)("td",{parentName:"tr",align:null},"Additional information about the current route, such as the apiName and the API request type."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Object"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.state.route.info.apiName")),(0,r.kt)("td",{parentName:"tr",align:null},"Name of the used API."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"String"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.state.route.info.type")),(0,r.kt)("td",{parentName:"tr",align:null},"Type of the used API."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"String"))))),(0,r.kt)("h2",{id:"ctxresponse"},(0,r.kt)("inlineCode",{parentName:"h2"},"ctx.response")),(0,r.kt)("p",null,"The ",(0,r.kt)("inlineCode",{parentName:"p"},"ctx.response")," object gives access to information related to the response that the server will return and includes the following parameters:"),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Parameter"),(0,r.kt)("th",{parentName:"tr",align:null},"Description"),(0,r.kt)("th",{parentName:"tr",align:null},"Type"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.response.body")),(0,r.kt)("td",{parentName:"tr",align:null},"Body of the response."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Any"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.response.status")),(0,r.kt)("td",{parentName:"tr",align:null},"Status code of the response."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Integer"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.response.message")),(0,r.kt)("td",{parentName:"tr",align:null},"Status message of the response.",(0,r.kt)("br",null),(0,r.kt)("br",null),"By default, ",(0,r.kt)("inlineCode",{parentName:"td"},"response.message")," is associated with ",(0,r.kt)("inlineCode",{parentName:"td"},"response.status"),"."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"String"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.response.header"),(0,r.kt)("br",null),(0,r.kt)("inlineCode",{parentName:"td"},"ctx.response.headers")),(0,r.kt)("td",{parentName:"tr",align:null},"Header(s) sent with the response."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Object"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.response.length")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Length"},(0,r.kt)("inlineCode",{parentName:"a"},"Content-Length"))," header value as a number when present, or deduces it from ",(0,r.kt)("inlineCode",{parentName:"td"},"ctx.body")," when possible; otherwise, returns ",(0,r.kt)("inlineCode",{parentName:"td"},"undefined"),"."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Integer"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.response.redirect"),(0,r.kt)("br",null),(0,r.kt)("inlineCode",{parentName:"td"},"ctx.response.redirect(url, [alt])")),(0,r.kt)("td",{parentName:"tr",align:null},"Performs a ",(0,r.kt)("inlineCode",{parentName:"td"},"302"),' redirect to the URL. The string "back" is special-cased to provide Referrer support; when Referrer is not present, alt or "/" is used.',(0,r.kt)("br",null),(0,r.kt)("br",null),"Example: ",(0,r.kt)("inlineCode",{parentName:"td"},"ctx.response.redirect('back', '/index.html');")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Function"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.response.attachment"),(0,r.kt)("br",null),(0,r.kt)("br",null),(0,r.kt)("inlineCode",{parentName:"td"},"ctx.response.attachment([filename], [options])")),(0,r.kt)("td",{parentName:"tr",align:null},"Sets ",(0,r.kt)("a",{parentName:"td",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Disposition"},(0,r.kt)("inlineCode",{parentName:"a"},"Content-Disposition")),' header to "attachment" to signal the client to prompt for download. Optionally specify the filename of the download and some ',(0,r.kt)("a",{parentName:"td",href:"https://github.com/jshttp/content-disposition#options"},"options"),"."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"Function"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.response.type")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type"},(0,r.kt)("inlineCode",{parentName:"a"},"Content-Type")),' header, void of parameters such as "charset".'),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"String"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.response.lastModified")),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("a",{parentName:"td",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Last-Modified"},(0,r.kt)("inlineCode",{parentName:"a"},"Last-Modified"))," header as a Date, if it exists."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"DateTime"))),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"ctx.response.etag")),(0,r.kt)("td",{parentName:"tr",align:null},"Sets the ",(0,r.kt)("a",{parentName:"td",href:"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/ETag"},(0,r.kt)("inlineCode",{parentName:"a"},"ETag")),' of a response including the wrapped "s.',(0,r.kt)("br",null),"There is no corresponding ",(0,r.kt)("inlineCode",{parentName:"td"},"response.etag")," getter."),(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"String"))))),(0,r.kt)("h2",{id:"accessing-the-request-context-anywhere"},"Accessing the request context anywhere"),(0,r.kt)("admonition",{title:"\u2728 New in v4.3.9",type:"callout"},(0,r.kt)("p",{parentName:"admonition"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"strapi.requestContext")," works with Strapi v4.3.9+.")),(0,r.kt)("p",null,"Strapi exposes a way to access the current request context from anywhere in the code (e.g. lifecycle functions)."),(0,r.kt)("p",null,"You can access the request as follows:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"const ctx = strapi.requestContext.get();\n")),(0,r.kt)("p",null,"You should only use this inside of functions that will be called in the context of an HTTP request."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"// correct\n\nconst service = {\n  myFunction() {\n    const ctx = strapi.requestContext.get();\n    console.log(ctx.state.user);\n  },\n};\n\n// incorrect\nconst ctx = strapi.requestContext.get();\n\nconst service = {\n  myFunction() {\n    console.log(ctx.state.user);\n  },\n};\n")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Example:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="./api/test/content-types/article/lifecycles.js"',title:'"./api/test/content-types/article/lifecycles.js"'},"\nmodule.exports = {\n  beforeUpdate() {\n    const ctx = strapi.requestContext.get();\n\n    console.log('User info in service: ', ctx.state.user);\n  },\n};\n")),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Strapi uses a Node.js feature called ",(0,r.kt)("a",{parentName:"p",href:"https://nodejs.org/docs/latest-v16.x/api/async_context.html#class-asynclocalstorage"},"AsyncLocalStorage")," to make the context available anywhere.")))}k.isMDXComponent=!0},17155:(t,e,n)=>{n.r(e),n.d(e,{assets:()=>d,contentTitle:()=>i,default:()=>m,frontMatter:()=>l,metadata:()=>o,toc:()=>p});var a=n(83117),r=(n(67294),n(3905));const l={},i=void 0,o={unversionedId:"snippets/backend-customization-feedback-cta",id:"snippets/backend-customization-feedback-cta",title:"backend-customization-feedback-cta",description:"We are currently reworking the Backend Customization section of the Strapi documentation. If you would like to help, please feel free to fill in this form to share with us your opinions, needs and requests.",source:"@site/docs/snippets/backend-customization-feedback-cta.md",sourceDirName:"snippets",slug:"/snippets/backend-customization-feedback-cta",permalink:"/snippets/backend-customization-feedback-cta",draft:!1,editUrl:"https://github.com/labs-solo/aberabook/edit/main/docusaurus/docs/snippets/backend-customization-feedback-cta.md",tags:[],version:"current",frontMatter:{}},d={},p=[],s={toc:p};function m(t){let{components:e,...n}=t;return(0,r.kt)("wrapper",(0,a.Z)({},s,n,{components:e,mdxType:"MDXLayout"}),(0,r.kt)("admonition",{title:"\ud83d\udcac Strapi team needs you to improve this documentation!",type:"callout"},(0,r.kt)("p",{parentName:"admonition"},"We are currently reworking the Backend Customization section of the Strapi documentation. If you would like to help, please feel free to fill in ",(0,r.kt)("a",{parentName:"p",href:"https://forms.gle/YS8zGUrG6FQ72dmh8"},"this form")," to share with us your opinions, needs and requests.")))}m.isMDXComponent=!0}}]);