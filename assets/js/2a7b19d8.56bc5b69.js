"use strict";(self.webpackChunkstrapi_docs=self.webpackChunkstrapi_docs||[]).push([[9753,4107,5963,9968],{3905:(e,t,n)=>{n.d(t,{Zo:()=>s,kt:()=>c});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function d(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var p=a.createContext({}),l=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},s=function(e){var t=l(e.components);return a.createElement(p.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},u=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,p=e.parentName,s=d(e,["components","mdxType","originalType","parentName"]),u=l(n),c=o,y=u["".concat(p,".").concat(c)]||u[c]||m[c]||i;return n?a.createElement(y,r(r({ref:t},s),{},{components:n})):a.createElement(y,r({ref:t},s))}));function c(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=u;var d={};for(var p in t)hasOwnProperty.call(t,p)&&(d[p]=t[p]);d.originalType=e,d.mdxType="string"==typeof e?e:o,r[1]=d;for(var l=2;l<i;l++)r[l]=n[l];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}u.displayName="MDXCreateElement"},76937:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>m,contentTitle:()=>l,default:()=>v,frontMatter:()=>p,metadata:()=>s,toc:()=>u});var a=n(83117),o=(n(67294),n(3905)),i=n(12874),r=n(43316),d=n(76104);const p={title:"Caddy Proxying",displayed_sidebar:"devDocsSidebar",description:"Learn how you can use a proxy application like Caddy to secure your Strapi application."},l="Caddy Proxying",s={unversionedId:"dev-docs/deployment/caddy-proxy",id:"dev-docs/deployment/caddy-proxy",title:"Caddy Proxying",description:"Learn how you can use a proxy application like Caddy to secure your Strapi application.",source:"@site/docs/dev-docs/deployment/caddy-proxy.md",sourceDirName:"dev-docs/deployment",slug:"/dev-docs/deployment/caddy-proxy",permalink:"/aberabook/dev-docs/deployment/caddy-proxy",draft:!1,editUrl:"https://github.com/labs-solo/aberabook/edit/main/docusaurus/docs/dev-docs/deployment/caddy-proxy.md",tags:[],version:"current",frontMatter:{title:"Caddy Proxying",displayed_sidebar:"devDocsSidebar",description:"Learn how you can use a proxy application like Caddy to secure your Strapi application."},sidebar:"devDocsSidebar",previous:{title:"Optional Software Guides",permalink:"/aberabook/dev-docs/deployment/optional-software-guides"},next:{title:"HAProxy Proxying",permalink:"/aberabook/dev-docs/deployment/haproxy-proxy"}},m={},u=[{value:"Configuration",id:"configuration",level:2},{value:"Caddy file",id:"caddy-file",level:3},{value:"Subdomain",id:"subdomain",level:4},{value:"Subfolder unified",id:"subfolder-unified",level:4}],c=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,o.kt)("div",t)},y=c("Tabs"),f=c("TabItem"),h={toc:u};function v(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},h,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"caddy-proxying"},"Caddy Proxying"),(0,o.kt)("p",null,'As Strapi does not handle SSL directly and hosting a Node.js service on the "edge" network is not a secure solution it is recommended that you use some sort of proxy application such as Nginx, Apache, HAProxy, Traefik, or others. This guide contains some sample configurations for Caddy, naturally these configs may not suit all environments and you will likely need to adjust them to fit your needs.'),(0,o.kt)("p",null,'Caddy has some very easy to use options relating to Let\'s encrypt and automated SSL certificate issuing/renewing, while it is certainly the "newer" web server market, it is quickly becoming a great "non-technical" user application for proxying. '),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"}," Caddy is still very much in development and as such is evolving often, this guide is based on Caddy v2.0.0.")),(0,o.kt)("h2",{id:"configuration"},"Configuration"),(0,o.kt)("p",null,'The following configuration is based on "Caddy File" type, this is a single file configuration that Caddy will use to run the web server. There are multiple other options such as the Caddy REST API that this guide will not cover, you should review the ',(0,o.kt)("a",{parentName:"p",href:"https://caddyserver.com/docs/"},"Caddy documentation")," for further information on alternatives. You can also visit the ",(0,o.kt)("a",{parentName:"p",href:"https://caddy.community/"},"Caddy Community")," to speak with others relating to configuration questions."),(0,o.kt)(r.default,{components:n.components,mdxType:"StrapiServer"}),(0,o.kt)("h3",{id:"caddy-file"},"Caddy file"),(0,o.kt)("p",null,"The Caddyfile is a convenient Caddy configuration format for humans. It is most people's favorite way to use Caddy because it is easy to write, easy to understand, and expressive enough for most use cases."),(0,o.kt)("p",null,"In the following examples you will need to replace your domain, and should you wish to use SSL you will need to tweak these Caddy file configs to suit your needs, SSL is not covered in this guide and you should review the Caddy documentation."),(0,o.kt)("p",null,"The following are 2 example Caddy configurations:"),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Subdomain-based such as ",(0,o.kt)("inlineCode",{parentName:"li"},"api.example.com")),(0,o.kt)("li",{parentName:"ul"},"Subfolder-based with both the API and Admin on the same subfolder (e.g. ",(0,o.kt)("inlineCode",{parentName:"li"},"example.com/test/api")," and ",(0,o.kt)("inlineCode",{parentName:"li"},"example.com/test/admin"),")")),(0,o.kt)(d.default,{components:n.components,mdxType:"SubfolderSplitWarning"}),(0,o.kt)(y,{mdxType:"Tabs"},(0,o.kt)(f,{value:"Subdomain",label:"Subdomain",mdxType:"TabItem"},(0,o.kt)("h4",{id:"subdomain"},"Subdomain"),(0,o.kt)("p",null,"This configuration is using a subdomain dedicated to Strapi only. It will bind to port 80 HTTP and proxies all requests (both API and admin) to the Strapi server running locally on the address specified. If you have configured Caddy properly to handle automated SSL, you can remove the ",(0,o.kt)("inlineCode",{parentName:"p"},"http://")," and Caddy will automatically convert all HTTP to HTTPS traffic."),(0,o.kt)("hr",null),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Example domain: ",(0,o.kt)("inlineCode",{parentName:"li"},"api.example.com")),(0,o.kt)("li",{parentName:"ul"},"Example admin panel: ",(0,o.kt)("inlineCode",{parentName:"li"},"api.example.com/admin")),(0,o.kt)("li",{parentName:"ul"},"Example API: ",(0,o.kt)("inlineCode",{parentName:"li"},"api.example.com/api")),(0,o.kt)("li",{parentName:"ul"},"Example uploaded Files (local provider): ",(0,o.kt)("inlineCode",{parentName:"li"},"api.example.com/uploads"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"# path: /etc/caddy/Caddyfile\n\nhttp://api.example.com {\n  reverse_proxy 127.0.0.1:1337\n}\n\n"))),(0,o.kt)(f,{value:"Subfolder unified",label:"Subfolder unified",mdxType:"TabItem"},(0,o.kt)("h4",{id:"subfolder-unified"},"Subfolder unified"),(0,o.kt)("p",null,"This configuration is using a subfolder dedicated to Strapi only. It will bind to port 80 HTTP and hosts the front-end files on ",(0,o.kt)("inlineCode",{parentName:"p"},"/var/www")," like a normal web server, but proxies all Strapi requests on the ",(0,o.kt)("inlineCode",{parentName:"p"},"example.com/test")," sub-path."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"This example configuration is not focused on the front end hosting and should be adjusted to your front-end software requirements.")),(0,o.kt)("hr",null),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Example domain: ",(0,o.kt)("inlineCode",{parentName:"li"},"example.com/test")),(0,o.kt)("li",{parentName:"ul"},"Example admin panel: ",(0,o.kt)("inlineCode",{parentName:"li"},"example.com/test/admin")),(0,o.kt)("li",{parentName:"ul"},"Example API: ",(0,o.kt)("inlineCode",{parentName:"li"},"example.com/test/api")),(0,o.kt)("li",{parentName:"ul"},"Example uploaded Files (local provider): ",(0,o.kt)("inlineCode",{parentName:"li"},"example.com/test/uploads"))),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"# path: /etc/caddy/Caddyfile\n\nhttp://example.com {\n  root * /var/www\n  file_server\n  route /test* {\n    uri strip_prefix /test\n    reverse_proxy 127.0.0.1:1337\n  }\n}\n")))),(0,o.kt)(i.default,{components:n.components,mdxType:"AdminRedirect"}))}v.isMDXComponent=!0},12874:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>r,default:()=>m,frontMatter:()=>i,metadata:()=>d,toc:()=>l});var a=n(83117),o=(n(67294),n(3905));const i={},r=void 0,d={unversionedId:"dev-docs/deployment/snippets-proxy/admin-redirect",id:"dev-docs/deployment/snippets-proxy/admin-redirect",title:"admin-redirect",description:"Redirecting landing page to admin panel",source:"@site/docs/dev-docs/deployment/snippets-proxy/admin-redirect.md",sourceDirName:"dev-docs/deployment/snippets-proxy",slug:"/dev-docs/deployment/snippets-proxy/admin-redirect",permalink:"/aberabook/dev-docs/deployment/snippets-proxy/admin-redirect",draft:!1,editUrl:"https://github.com/labs-solo/aberabook/edit/main/docusaurus/docs/dev-docs/deployment/snippets-proxy/admin-redirect.md",tags:[],version:"current",frontMatter:{}},p={},l=[{value:"Redirecting landing page to admin panel",id:"redirecting-landing-page-to-admin-panel",level:3}],s={toc:l};function m(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h3",{id:"redirecting-landing-page-to-admin-panel"},"Redirecting landing page to admin panel"),(0,o.kt)("p",null,"If you do not wish to have the default landing page mounted on ",(0,o.kt)("inlineCode",{parentName:"p"},"/")," you can create a custom middleware using the sample code below to automatically redirect to your admin panel."),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"This sample configuration expects that the admin panel is accessible on ",(0,o.kt)("inlineCode",{parentName:"p"},"/admin"),". If you used one of the above configurations to change this to ",(0,o.kt)("inlineCode",{parentName:"p"},"/dashboard")," you will also need to adjust this sample configuration.")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="./config/middlewares.js"',title:'"./config/middlewares.js"'},"module.exports = ({ env }) => [\n    // ...\n    { resolve: '../src/middlewares/admin-redirect' },\n];\n\n")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="./src/middlewares/admin-redirect.js"',title:'"./src/middlewares/admin-redirect.js"'},"module.exports = (_config, { strapi }) => {\n    const redirects = ['/', '/index.html'].map((path) => ({\n        method: 'GET',\n        path,\n        handler: (ctx) => ctx.redirect('/admin'),\n        config: { auth: false },\n    }));\n\n    strapi.server.routes(redirects);\n};\n")))}m.isMDXComponent=!0},43316:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>r,default:()=>y,frontMatter:()=>i,metadata:()=>d,toc:()=>l});var a=n(83117),o=(n(67294),n(3905));const i={},r=void 0,d={unversionedId:"dev-docs/deployment/snippets-proxy/strapi-server",id:"dev-docs/deployment/snippets-proxy/strapi-server",title:"strapi-server",description:"Strapi server",source:"@site/docs/dev-docs/deployment/snippets-proxy/strapi-server.md",sourceDirName:"dev-docs/deployment/snippets-proxy",slug:"/dev-docs/deployment/snippets-proxy/strapi-server",permalink:"/aberabook/dev-docs/deployment/snippets-proxy/strapi-server",draft:!1,editUrl:"https://github.com/labs-solo/aberabook/edit/main/docusaurus/docs/dev-docs/deployment/snippets-proxy/strapi-server.md",tags:[],version:"current",frontMatter:{}},p={},l=[{value:"Strapi server",id:"strapi-server",level:3},{value:"Subdomain Strapi configuration",id:"subdomain-strapi-configuration",level:4},{value:"Subfolder unified Strapi configuration",id:"subfolder-unified-strapi-configuration",level:4}],s=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,o.kt)("div",t)},m=s("Tabs"),u=s("TabItem"),c={toc:l};function y(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h3",{id:"strapi-server"},"Strapi server"),(0,o.kt)("p",null,"In order to take full advantage of a proxied Strapi application, Strapi should be configured so it's aware of the upstream proxy. Like with the below configurations there are 3 matching examples. Additional information can be found in the ",(0,o.kt)("a",{parentName:"p",href:"/dev-docs/configurations/server"},"server configuration")," and ",(0,o.kt)("a",{parentName:"p",href:"/dev-docs/configurations/admin-panel"},"admin configuration")," documentations."),(0,o.kt)("admonition",{type:"note"},(0,o.kt)("p",{parentName:"admonition"},"These examples use the default API Prefix of ",(0,o.kt)("inlineCode",{parentName:"p"},"/api"),". This can be changed without the need to directly modify the Nginx configuration (see the ",(0,o.kt)("a",{parentName:"p",href:"/dev-docs/configurations/api"},"API prefix")," documentation).")),(0,o.kt)("admonition",{type:"caution"},(0,o.kt)("p",{parentName:"admonition"},"If the ",(0,o.kt)("inlineCode",{parentName:"p"},"url")," key is changed in the ",(0,o.kt)("inlineCode",{parentName:"p"},"./config/admin.js")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"./config/server.js")," files, the admin panel needs to be rebuilt with ",(0,o.kt)("inlineCode",{parentName:"p"},"yarn build")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"npm run build"),".")),(0,o.kt)(m,{mdxType:"Tabs"},(0,o.kt)(u,{value:"Subdomain",label:"Subdomain",mdxType:"TabItem"},(0,o.kt)("h4",{id:"subdomain-strapi-configuration"},"Subdomain Strapi configuration"),(0,o.kt)("hr",null),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Example domain: ",(0,o.kt)("inlineCode",{parentName:"li"},"api.example.com")),(0,o.kt)("li",{parentName:"ul"},"Example admin: ",(0,o.kt)("inlineCode",{parentName:"li"},"api.example.com/admin")),(0,o.kt)("li",{parentName:"ul"},"Example API: ",(0,o.kt)("inlineCode",{parentName:"li"},"api.example.com/api")),(0,o.kt)("li",{parentName:"ul"},"Example uploaded files (local provider): ",(0,o.kt)("inlineCode",{parentName:"li"},"api.example.com/uploads"))),(0,o.kt)(m,{groupId:"js-ts",mdxType:"Tabs"},(0,o.kt)(u,{value:"javascript",label:"JavaScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="path: ./config/server.js"',title:'"path:','./config/server.js"':!0},"\nmodule.exports = ({ env }) => ({\n  host: env('HOST', '0.0.0.0'),\n  port: env.int('PORT', 1337),\n  url: 'https://api.example.com',\n});\n"))),(0,o.kt)(u,{value:"typescript",label:"TypeScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="path: ./config/server.ts"',title:'"path:','./config/server.ts"':!0},"\nexport default ({ env }) => ({\n  host: env('HOST', '0.0.0.0'),\n  port: env.int('PORT', 1337),\n  url: 'https://api.example.com',\n});\n"))))),(0,o.kt)(u,{value:"Subfolder unified",label:"Subfolder unified",mdxType:"TabItem"},(0,o.kt)("h4",{id:"subfolder-unified-strapi-configuration"},"Subfolder unified Strapi configuration"),(0,o.kt)("hr",null),(0,o.kt)("ul",null,(0,o.kt)("li",{parentName:"ul"},"Example domain: ",(0,o.kt)("inlineCode",{parentName:"li"},"example.com/test")),(0,o.kt)("li",{parentName:"ul"},"Example admin: ",(0,o.kt)("inlineCode",{parentName:"li"},"example.com/test/admin")),(0,o.kt)("li",{parentName:"ul"},"Example API: ",(0,o.kt)("inlineCode",{parentName:"li"},"example.com/test/api")),(0,o.kt)("li",{parentName:"ul"},"Example uploaded Files (local provider): ",(0,o.kt)("inlineCode",{parentName:"li"},"example.com/test/uploads"))),(0,o.kt)(m,{groupId:"js-ts",mdxType:"Tabs"},(0,o.kt)(u,{value:"javascript",label:"JavaScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="path: ./config/server.js"',title:'"path:','./config/server.js"':!0},"\nmodule.exports = ({ env }) => ({\n  host: env('HOST', '0.0.0.0'),\n  port: env.int('PORT', 1337),\n  url: 'https://example.com/test',\n});\n"))),(0,o.kt)(u,{value:"typescript",label:"TypeScript",mdxType:"TabItem"},(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="path: ./config/server.ts"',title:'"path:','./config/server.ts"':!0},"\nexport default ({ env }) => ({\n  host: env('HOST', '0.0.0.0'),\n  port: env.int('PORT', 1337),\n  url: 'https://example.com/test',\n});\n")))))))}y.isMDXComponent=!0},76104:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>r,default:()=>m,frontMatter:()=>i,metadata:()=>d,toc:()=>l});var a=n(83117),o=(n(67294),n(3905));const i={},r=void 0,d={unversionedId:"dev-docs/deployment/snippets-proxy/subfolder-split-warning",id:"dev-docs/deployment/snippets-proxy/subfolder-split-warning",title:"subfolder-split-warning",description:"Using subfolder split (eg//example.com/dashboard and https https https//example.com/strapi/api).",source:"@site/docs/dev-docs/deployment/snippets-proxy/subfolder-split-warning.md",sourceDirName:"dev-docs/deployment/snippets-proxy",slug:"/dev-docs/deployment/snippets-proxy/subfolder-split-warning",permalink:"/aberabook/dev-docs/deployment/snippets-proxy/subfolder-split-warning",draft:!1,editUrl:"https://github.com/labs-solo/aberabook/edit/main/docusaurus/docs/dev-docs/deployment/snippets-proxy/subfolder-split-warning.md",tags:[],version:"current",frontMatter:{}},p={},l=[],s={toc:l};function m(e){let{components:t,...n}=e;return(0,o.kt)("wrapper",(0,a.Z)({},s,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("admonition",{title:"Subfolder split is not supported",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"Using subfolder split (eg: ",(0,o.kt)("inlineCode",{parentName:"p"},"https://example.com/dashboard")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"https://example.com/api"),") are not supported nor recommended with Strapi. It's advised that you either use subdomains (eg: ",(0,o.kt)("inlineCode",{parentName:"p"},"https://api.example.com"),") or subfolder unified (eg: ",(0,o.kt)("inlineCode",{parentName:"p"},"https://example.com/strapi/dashboard")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"https://example.com/strapi/api"),").")))}m.isMDXComponent=!0}}]);