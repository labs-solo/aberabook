"use strict";(self.webpackChunkstrapi_docs=self.webpackChunkstrapi_docs||[]).push([[1261],{3905:(e,t,r)=>{r.d(t,{Zo:()=>u,kt:()=>d});var a=r(67294);function n(e,t,r){return t in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,a)}return r}function i(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach((function(t){n(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function s(e,t){if(null==e)return{};var r,a,n=function(e,t){if(null==e)return{};var r,a,n={},o=Object.keys(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||(n[r]=e[r]);return n}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)r=o[a],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(n[r]=e[r])}return n}var p=a.createContext({}),c=function(e){var t=a.useContext(p),r=t;return e&&(r="function"==typeof e?e(t):i(i({},t),e)),r},u=function(e){var t=c(e.components);return a.createElement(p.Provider,{value:t},e.children)},l={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var r=e.components,n=e.mdxType,o=e.originalType,p=e.parentName,u=s(e,["components","mdxType","originalType","parentName"]),m=c(r),d=n,f=m["".concat(p,".").concat(d)]||m[d]||l[d]||o;return r?a.createElement(f,i(i({ref:t},u),{},{components:r})):a.createElement(f,i({ref:t},u))}));function d(e,t){var r=arguments,n=t&&t.mdxType;if("string"==typeof e||n){var o=r.length,i=new Array(o);i[0]=m;var s={};for(var p in t)hasOwnProperty.call(t,p)&&(s[p]=t[p]);s.originalType=e,s.mdxType="string"==typeof e?e:n,i[1]=s;for(var c=2;c<o;c++)i[c]=r[c];return a.createElement.apply(null,i)}return a.createElement.apply(null,r)}m.displayName="MDXCreateElement"},86339:(e,t,r)=>{r.r(t),r.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>l,frontMatter:()=>o,metadata:()=>s,toc:()=>c});var a=r(83117),n=(r(67294),r(3905));const o={title:"Routes",displayed_sidebar:"devDocsSidebar",description:"Migrate routes of a Strapi application from v3.6.x to v4.0.x",next:"./controllers.md"},i="v4 code migration: Updating routes",s={unversionedId:"dev-docs/migration/v3-to-v4/code/routes",id:"dev-docs/migration/v3-to-v4/code/routes",title:"Routes",description:"Migrate routes of a Strapi application from v3.6.x to v4.0.x",source:"@site/docs/dev-docs/migration/v3-to-v4/code/routes.md",sourceDirName:"dev-docs/migration/v3-to-v4/code",slug:"/dev-docs/migration/v3-to-v4/code/routes",permalink:"/aberabook/dev-docs/migration/v3-to-v4/code/routes",draft:!1,editUrl:"https://github.com/labs-solo/aberabook/edit/main/docusaurus/docs/dev-docs/migration/v3-to-v4/code/routes.md",tags:[],version:"current",frontMatter:{title:"Routes",displayed_sidebar:"devDocsSidebar",description:"Migrate routes of a Strapi application from v3.6.x to v4.0.x",next:"./controllers.md"},sidebar:"devDocsSidebar",previous:{title:"Route middlewares",permalink:"/aberabook/dev-docs/migration/v3-to-v4/code/route-middlewares"},next:{title:"Services",permalink:"/aberabook/dev-docs/migration/v3-to-v4/code/services"}},p={},c=[{value:"Migrating core routers",id:"migrating-core-routers",level:2},{value:"Migrating custom routers",id:"migrating-custom-routers",level:2}],u={toc:c};function l(e){let{components:t,...r}=e;return(0,n.kt)("wrapper",(0,a.Z)({},u,r,{components:t,mdxType:"MDXLayout"}),(0,n.kt)("h1",{id:"v4-code-migration-updating-routes"},"v4 code migration: Updating routes"),(0,n.kt)("p",null,"This guide is part of the ",(0,n.kt)("a",{parentName:"p",href:"/aberabook/dev-docs/migration/v3-to-v4/code-migration"},"v4 code migration guide")," designed to help you migrate the code of a Strapi application from v3.6.x to v4.0.x"),(0,n.kt)("p",null,":::strapi v3/v4 comparison\nIn both Strapi v3 and v4, creating content-types automatically generates core API routes."),(0,n.kt)("p",null,"In Strapi v3, routes are defined in JSON files that export an object with a ",(0,n.kt)("inlineCode",{parentName:"p"},"routes")," property. ",(0,n.kt)("inlineCode",{parentName:"p"},"routes")," is an array of objects, each object being a route with its own parameters."),(0,n.kt)("p",null,"In Strapi v4, routes are defined in JavaScript files, called router files. 2 types of v4 router files coexist:"),(0,n.kt)("ul",null,(0,n.kt)("li",{parentName:"ul"},"core router files export the result of a call to the ",(0,n.kt)("a",{parentName:"li",href:"/dev-docs/backend-customization/routes#configuring-core-routers"},(0,n.kt)("inlineCode",{parentName:"a"},"createCoreRouter")," factory function")," introduced in Strapi v4"),(0,n.kt)("li",{parentName:"ul"},(0,n.kt)("a",{parentName:"li",href:"/dev-docs/backend-customization/routes#creating-custom-routers"},"custom router files")," have a structure similar to Strapi v3 routes.\n:::")),(0,n.kt)("p",null,"Migrating ",(0,n.kt)("a",{parentName:"p",href:"/dev-docs//backend-customization/routes"},"routes")," depends on whether you want to ",(0,n.kt)("a",{parentName:"p",href:"#migrating-core-routers"},"configure core routers")," or ",(0,n.kt)("a",{parentName:"p",href:"#migrating-custom-routers"},"migrate custom routers"),"."),(0,n.kt)("h2",{id:"migrating-core-routers"},"Migrating core routers"),(0,n.kt)("p",null,"Migrating a core router to Strapi v4 consists in making sure that each router file uses the ",(0,n.kt)("inlineCode",{parentName:"p"},"createCoreRouter")," factory function introduced in v4."),(0,n.kt)("p",null,"Due to the differences between routes implementation in Strapi v3 and v4, it's required to create a new router file, then optionally bring existing Strapi v3 customizations into the new file and adapt them when necessary."),(0,n.kt)("p",null,"To create a v4 core router file:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Create a ",(0,n.kt)("inlineCode",{parentName:"p"},"api/<api-name>/routes/<router-name>.js")," file inside the ",(0,n.kt)("inlineCode",{parentName:"p"},"./src")," folder (see ",(0,n.kt)("a",{parentName:"p",href:"/aberabook/dev-docs/project-structure"},"project structure"),").")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Copy and paste the following code at the top of the ",(0,n.kt)("inlineCode",{parentName:"p"},"./src/api/<api-name>/routes/<router-name>.js")," file. The code imports the ",(0,n.kt)("inlineCode",{parentName:"p"},"createCoreRouter")," factory function from the factories included with the core of Strapi:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-js"},"const { createCoreRouter } = require('@strapi/strapi').factories;\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Copy and paste the following code, replacing ",(0,n.kt)("inlineCode",{parentName:"p"},"api-name")," and ",(0,n.kt)("inlineCode",{parentName:"p"},"content-type-name")," with appropriate names. The code exports the result of a call to the ",(0,n.kt)("inlineCode",{parentName:"p"},"createCoreRouter")," factory function, passing the unique identifier of the content-type (e.g. ",(0,n.kt)("inlineCode",{parentName:"p"},"api::api-name.content-type-name"),") as an argument:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = createCoreRouter('api::api-name.content-type-name')\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"(",(0,n.kt)("em",{parentName:"p"},"optional"),") To configure the router, pass a second argument to the ",(0,n.kt)("inlineCode",{parentName:"p"},"createCoreRouter")," factory function. This argument can be either an object or a function returning an object. The object contains methods, which can either be entirely new actions or replace or extend existing actions of core API routes (see ",(0,n.kt)("a",{parentName:"p",href:"/dev-docs/backend-customization/routes#implementation"},"routes implementation documentation"),")."))),(0,n.kt)("details",null,(0,n.kt)("summary",null," Example of a Strapi v4 core router without customization:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="./src/api/<content-type-name>/routes/<router-name>.js"',title:'"./src/api/<content-type-name>/routes/<router-name>.js"'},"\nconst { createCoreRouter } = require('@strapi/strapi').factories;\n\nmodule.exports = createCoreRouter('api::api-name.content-type-name');\n"))),(0,n.kt)("details",null,(0,n.kt)("summary",null,"Example of a Strapi v4 core router with customization:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-jsx",metastring:'title="./src/api/<content-type-name>/routes/<router-name>.js"',title:'"./src/api/<content-type-name>/routes/<router-name>.js"'},"\nconst { createCoreRouter } = require('@strapi/strapi').factories;\n\nmodule.exports = createCoreRouter('api::api-name.content-type-name', {\n // creates an object with the basic CRUD configuration\n  // ...\n  config: {\n    find: {\n      // disables authorization requirement for the `find` route\n      policies: ['admin::isAuthenticatedAdmin'],\n      // here you can also customize auth & middlewares\n    },\n  },\n  // disables every action except `find` and `findOne`.\n  only: ['find', 'findOne'],\n});\n\n"))),(0,n.kt)("h2",{id:"migrating-custom-routers"},"Migrating custom routers"),(0,n.kt)("p",null,"Custom routers in Strapi v4 are JavaScript files that export an array of objects, each object being a route, in a structure similar to the JSON routers configuration files used in Strapi v3."),(0,n.kt)("p",null,"To migrate a custom router to Strapi v4:"),(0,n.kt)("ol",null,(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Create a ",(0,n.kt)("inlineCode",{parentName:"p"},"api/<api-name>/routes/<custom-router-name>.js")," file inside the ",(0,n.kt)("inlineCode",{parentName:"p"},"./src")," folder (see ",(0,n.kt)("a",{parentName:"p",href:"/aberabook/dev-docs/project-structure"},"project structure"),").")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Make sure this ",(0,n.kt)("inlineCode",{parentName:"p"},"./src/api/<api-name>/routes/<custom-router-name>.js")," file exports an object:"),(0,n.kt)("pre",{parentName:"li"},(0,n.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="./src/api/<api-name>/routes/<router-name>.js"',title:'"./src/api/<api-name>/routes/<router-name>.js"'},"\nmodule.exports = {\n\n}\n"))),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Copy and paste the ",(0,n.kt)("inlineCode",{parentName:"p"},"routes")," array declared in the Strapi v3 JSON file into the object exported by the Strapi v4 file.")),(0,n.kt)("li",{parentName:"ol"},(0,n.kt)("p",{parentName:"li"},"Convert the exported object in Strapi v4 to a cleaner JavaScript format, removing all ",(0,n.kt)("inlineCode",{parentName:"p"},'"')," on keys from the Strapi v3 JSON format (e.g. ",(0,n.kt)("inlineCode",{parentName:"p"},'"method"')," \u2192 ",(0,n.kt)("inlineCode",{parentName:"p"},"method"),", ",(0,n.kt)("inlineCode",{parentName:"p"},'"path"')," \u2192 ",(0,n.kt)("inlineCode",{parentName:"p"},"path"),")."))),(0,n.kt)("details",null,(0,n.kt)("summary",null," Example of a Strapi v4 custom router:"),(0,n.kt)("pre",null,(0,n.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="./src/api/restaurant/routes/custom-restaurant.js"',title:'"./src/api/restaurant/routes/custom-restaurant.js"'},"\nmodule.exports = {\n  routes: [\n    { // Path defined with a URL parameter\n      method: 'GET',\n      path: '/restaurants/:category/:id',\n      handler: 'Restaurant.findOneByCategory',\n    },\n    { // Path defined with a regular expression\n      method: 'GET',\n      path: '/restaurants/:region(\\\\d{2}|\\\\d{3})/:id', // Only match when the first parameter contains 2 or 3 digits.\n      handler: 'Restaurant.findOneByRegion',\n    },\n    { // Route with custom policies\n      method: 'POST',\n      path: \"/restaurants/:id/reservation\",\n      handler: 'Restaurant.reservation',\n      config: {\n        policies: [\"is-authenticated\", \"has-credit-card\"]\n      }\n    }\n  ]\n}\n\n"))),(0,n.kt)("p",null,":::strapi Next steps\n",(0,n.kt)("a",{parentName:"p",href:"/dev-docs/migration/v3-to-v4/code/backend"},"Migrating the backend code")," of Strapi to v4 also requires to at least migrate the core features of the Strapi server, such as the ",(0,n.kt)("a",{parentName:"p",href:"/dev-docs/migration/v3-to-v4/code/configuration"},"configuration"),", ",(0,n.kt)("a",{parentName:"p",href:"/dev-docs/migration/v3-to-v4/code/dependencies"},"dependencies"),", ",(0,n.kt)("a",{parentName:"p",href:"/dev-docs/migration/v3-to-v4/code/services"},"services"),", ",(0,n.kt)("a",{parentName:"p",href:"/dev-docs/migration/v3-to-v4/code/controllers"},"controllers"),", and ",(0,n.kt)("a",{parentName:"p",href:"/dev-docs/migration/v3-to-v4/code/content-type-schema"},"content-type schemas"),".\n:::"))}l.isMDXComponent=!0}}]);