"use strict";(self.webpackChunkstrapi_docs=self.webpackChunkstrapi_docs||[]).push([[8046,9898,2642],{3905:(e,t,a)=>{a.d(t,{Zo:()=>u,kt:()=>d});var n=a(67294);function r(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}function i(e,t){var a=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),a.push.apply(a,n)}return a}function o(e){for(var t=1;t<arguments.length;t++){var a=null!=arguments[t]?arguments[t]:{};t%2?i(Object(a),!0).forEach((function(t){r(e,t,a[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):i(Object(a)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(a,t))}))}return e}function l(e,t){if(null==e)return{};var a,n,r=function(e,t){if(null==e)return{};var a,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||(r[a]=e[a]);return r}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)a=i[n],t.indexOf(a)>=0||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a])}return r}var s=n.createContext({}),p=function(e){var t=n.useContext(s),a=t;return e&&(a="function"==typeof e?e(t):o(o({},t),e)),a},u=function(e){var t=p(e.components);return n.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return n.createElement(n.Fragment,{},t)}},c=n.forwardRef((function(e,t){var a=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=p(a),d=r,k=c["".concat(s,".").concat(d)]||c[d]||m[d]||i;return a?n.createElement(k,o(o({ref:t},u),{},{components:a})):n.createElement(k,o({ref:t},u))}));function d(e,t){var a=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var i=a.length,o=new Array(i);o[0]=c;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,o[1]=l;for(var p=2;p<i;p++)o[p]=a[p];return n.createElement.apply(null,o)}return n.createElement.apply(null,a)}c.displayName="MDXCreateElement"},54530:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>u,contentTitle:()=>s,default:()=>h,frontMatter:()=>l,metadata:()=>p,toc:()=>m});var n=a(83117),r=(a(67294),a(3905)),i=a(56927),o=a(14188);const l={title:"Azure Deployment",displayed_sidebar:"devDocsSidebar",description:"Learn in this guide how to deploy your Strapi application on Microsoft Azure."},s="Azure",p={unversionedId:"dev-docs/deployment/azure",id:"dev-docs/deployment/azure",title:"Azure Deployment",description:"Learn in this guide how to deploy your Strapi application on Microsoft Azure.",source:"@site/docs/dev-docs/deployment/azure.md",sourceDirName:"dev-docs/deployment",slug:"/dev-docs/deployment/azure",permalink:"/aberabook/dev-docs/deployment/azure",draft:!1,editUrl:"https://github.com/labs-solo/aberabook/edit/main/docusaurus/docs/dev-docs/deployment/azure.md",tags:[],version:"current",frontMatter:{title:"Azure Deployment",displayed_sidebar:"devDocsSidebar",description:"Learn in this guide how to deploy your Strapi application on Microsoft Azure."},sidebar:"devDocsSidebar",previous:{title:"AWS Deployment",permalink:"/aberabook/dev-docs/deployment/amazon-aws"},next:{title:"DigitalOcean App Platform",permalink:"/aberabook/dev-docs/deployment/digitalocean-app-platform"}},u={},m=[{value:"PaaS Deployment Guides",id:"paas-deployment-guides",level:2},{value:"Required Resources",id:"required-resources",level:3},{value:"Creating Resources via the Azure Portal",id:"creating-resources-via-the-azure-portal",level:3},{value:"Configuring the Resources",id:"configuring-the-resources",level:4},{value:"Configure the Storage Account",id:"configure-the-storage-account",level:5},{value:"Configure MySQL",id:"configure-mysql",level:5},{value:"Creating Resources via the Azure CLI",id:"creating-resources-via-the-azure-cli",level:3},{value:"Deploy with an Azure Resource Manager template",id:"deploy-with-an-azure-resource-manager-template",level:3},{value:"Configure Strapi for Azure AppService",id:"configure-strapi-for-azure-appservice",level:3},{value:"IaaS Deployment Guide",id:"iaas-deployment-guide",level:2},{value:"Create a Virtual Machine",id:"create-a-virtual-machine",level:3},{value:"1. Log in to your Azure Portal",id:"1-log-in-to-your-azure-portal",level:4},{value:"2. Create a VM by clicking on <code>Create a resource</code>",id:"2-create-a-vm-by-clicking-on-create-a-resource",level:4},{value:"3. Basics",id:"3-basics",level:4},{value:"4. Disks",id:"4-disks",level:4},{value:"5. Networking",id:"5-networking",level:4},{value:"6. Management",id:"6-management",level:4},{value:"7. Advanced",id:"7-advanced",level:4},{value:"8. Tags, Review + Create",id:"8-tags-review--create",level:4},{value:"Logging in and installing Strapi dependencies",id:"logging-in-and-installing-strapi-dependencies",level:3},{value:"1. SSH to your Administrator account created previously",id:"1-ssh-to-your-administrator-account-created-previously",level:4},{value:"2. Updating packages and installing dependencies",id:"2-updating-packages-and-installing-dependencies",level:4},{value:"3. Creating the Strapi service user and creating/cloning your project",id:"3-creating-the-strapi-service-user-and-creatingcloning-your-project",level:4},{value:"4. Choosing and installing a database",id:"4-choosing-and-installing-a-database",level:4},{value:"Creating or cloning our Strapi Project",id:"creating-or-cloning-our-strapi-project",level:3},{value:"1. Create the new project",id:"1-create-the-new-project",level:4},{value:"2. Modifying configurations to be more secure",id:"2-modifying-configurations-to-be-more-secure",level:4},{value:"3. Installing PM2 and running Strapi as a service",id:"3-installing-pm2-and-running-strapi-as-a-service",level:4},{value:"4. Starting Strapi on boot and persisting service between reboots",id:"4-starting-strapi-on-boot-and-persisting-service-between-reboots",level:4},{value:"Optional additions",id:"optional-additions",level:3},{value:"1. Securing your virtual machine with a firewall",id:"1-securing-your-virtual-machine-with-a-firewall",level:4},{value:"2. Installing a proxy for SSL",id:"2-installing-a-proxy-for-ssl",level:4},{value:"3. File upload providers",id:"3-file-upload-providers",level:4}],c=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",t)},d=c("Tabs"),k=c("TabItem"),g={toc:m};function h(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},g,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"azure"},"Azure"),(0,r.kt)("p",null,"This is a step-by-step guide for deploying a Strapi project to ",(0,r.kt)("a",{parentName:"p",href:"https://azure.microsoft.com/"},"Azure")," using Platform-as-a-Service (PaaS). If you're interested in using Infrastructure-as-a-Service (IaaS) refer to ",(0,r.kt)("a",{parentName:"p",href:"#iaas-deployment-guide"},"IaaS deployment guide"),"."),(0,r.kt)("admonition",{type:"prerequisites"},(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"You should have created a ",(0,r.kt)("a",{parentName:"li",href:"/dev-docs/quick-start"},"Strapi project"),"."),(0,r.kt)("li",{parentName:"ul"},"You have should read through the ",(0,r.kt)("a",{parentName:"li",href:"/dev-docs/deployment#application-configuration"},"configuration documentation"),"."),(0,r.kt)("li",{parentName:"ul"},"You must have an ",(0,r.kt)("a",{parentName:"li",href:"https://azure.microsoft.com/free/"},"Azure account")," before doing these steps."))),(0,r.kt)(o.default,{mdxType:"ConsiderStrapiCloud"}),(0,r.kt)("h2",{id:"paas-deployment-guides"},"PaaS Deployment Guides"),(0,r.kt)("p",null,"There are 3 ways which you can deploy the Azure resources:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"via the ",(0,r.kt)("a",{parentName:"li",href:"#creating-resources-via-the-azure-portal"},"Azure Portal"),","),(0,r.kt)("li",{parentName:"ul"},"via the ",(0,r.kt)("a",{parentName:"li",href:"#creating-resources-via-the-azure-cli"},"Azure CLI"),","),(0,r.kt)("li",{parentName:"ul"},"or via an ",(0,r.kt)("a",{parentName:"li",href:"#deploy-with-an-azure-resource-manager-template"},"Azure Resource Manager template"),".")),(0,r.kt)("p",null,"When Strapi is running in a PaaS hosting model, a custom storage provider will be required to avoid the transient disk of the PaaS model, ",(0,r.kt)("a",{parentName:"p",href:"#configure-strapi-for-azure-appservice"},"which is covered towards the end"),"."),(0,r.kt)("h3",{id:"required-resources"},"Required Resources"),(0,r.kt)("p",null,"There are three resources in Azure that are required to run Strapi in a PaaS model, ",(0,r.kt)("a",{parentName:"p",href:"https://azure.microsoft.com/services/app-service/?WT.mc_id=javascript-37811-aapowell"},"AppService")," to host the Strapi web application, ",(0,r.kt)("a",{parentName:"p",href:"https://azure.microsoft.com/product-categories/storage/?WT.mc_id=javascript-37811-aapowell"},"Storage")," to store images/uploaded assets, and a database, Azure has managed MySQL and Postgres to choose from (for this tutorial, we'll use MySQL, but the steps are the same for Postgres)."),(0,r.kt)("h3",{id:"creating-resources-via-the-azure-portal"},"Creating Resources via the Azure Portal"),(0,r.kt)("p",null,"In this section we'll use the Azure Portal to create the required resources to host Strapi."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Navigate to the ",(0,r.kt)("a",{parentName:"p",href:"https://portal.azure.com/?WT.mc_id=javascript-37811-aapowell"},"Azure Portal"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click ",(0,r.kt)("strong",{parentName:"p"},"Create a resource")," and search for ",(0,r.kt)("em",{parentName:"p"},"Resource group")," from the provided search box.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Provide a name for your Resource Group, ",(0,r.kt)("inlineCode",{parentName:"p"},"my-strapi-app"),", and select a region.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click ",(0,r.kt)("strong",{parentName:"p"},"Review + create")," then ",(0,r.kt)("strong",{parentName:"p"},"Create"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Navigate to the Resource Group once it's created, click ",(0,r.kt)("strong",{parentName:"p"},"Create resources"),".\nand search for ",(0,r.kt)("em",{parentName:"p"},"Web App"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Ensure the ",(0,r.kt)("em",{parentName:"p"},"Subscription")," and ",(0,r.kt)("em",{parentName:"p"},"Resource Group")," are correct, then provide the following configuration for the app:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"Name")," - ",(0,r.kt)("inlineCode",{parentName:"li"},"my-strapi-app")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"Publish")," - ",(0,r.kt)("inlineCode",{parentName:"li"},"Code")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"Runtime stack")," - ",(0,r.kt)("inlineCode",{parentName:"li"},"Node 16 LTS")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"Operating System")," - ",(0,r.kt)("inlineCode",{parentName:"li"},"Linux")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"Region")," - Select an appropriate region"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Use the ",(0,r.kt)("em",{parentName:"p"},"App Service Plan")," to select the appropriate Sku and size for the level of scale your app will need (refer to ",(0,r.kt)("a",{parentName:"p",href:"https://azure.microsoft.com/pricing/details/app-service/windows/?WT.mc_id=javascript-37811-aapowell"},"the Azure docs")," for more information on the various Sku and sizes).")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click ",(0,r.kt)("strong",{parentName:"p"},"Review + create")," then ",(0,r.kt)("strong",{parentName:"p"},"Create"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Navigate back to the Resource Group and click ",(0,r.kt)("strong",{parentName:"p"},"Create")," then search for ",(0,r.kt)("em",{parentName:"p"},"Storage account")," and click ",(0,r.kt)("strong",{parentName:"p"},"Create"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Ensure the ",(0,r.kt)("em",{parentName:"p"},"Subscription")," and ",(0,r.kt)("em",{parentName:"p"},"Resource Group")," are correct, then provide the following configuration for the storage account:"))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"Name")," - ",(0,r.kt)("inlineCode",{parentName:"li"},"my-strapi-app")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"Region")," - Select an appropriate region"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"Performance")," - ",(0,r.kt)("inlineCode",{parentName:"li"},"Standard")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"Redundancy")," - Select the appropriate level of redundancy for your files")),(0,r.kt)("ol",{start:11},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Click ",(0,r.kt)("strong",{parentName:"p"},"Review + create")," then ",(0,r.kt)("strong",{parentName:"p"},"Create"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Navigate back to the Resource Group and click ",(0,r.kt)("strong",{parentName:"p"},"Create")," then search for ",(0,r.kt)("em",{parentName:"p"},"Azure Database for MySQL")," and click ",(0,r.kt)("strong",{parentName:"p"},"Create"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Select ",(0,r.kt)("em",{parentName:"p"},"Single server")," for the service type.")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Ensure the ",(0,r.kt)("em",{parentName:"p"},"Subscription")," and ",(0,r.kt)("em",{parentName:"p"},"Resource Group")," are correct, then provide the following configuration for the storage account:"))),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"Name")," - ",(0,r.kt)("inlineCode",{parentName:"li"},"my-strapi-db")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"Data source")," - ",(0,r.kt)("inlineCode",{parentName:"li"},"None")," (unless you're wanting to import from a backup)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"Location")," - Select an appropriate region"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"Version")," - ",(0,r.kt)("inlineCode",{parentName:"li"},"5.7")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("em",{parentName:"li"},"Compute + storage")," - Select an appropriate scale for your requirements (Basic is adequate for many Strapi workloads)")),(0,r.kt)("ol",{start:15},(0,r.kt)("li",{parentName:"ol"},"Enter a username and password for the ",(0,r.kt)("em",{parentName:"li"},"Administrator account"),", click ",(0,r.kt)("strong",{parentName:"li"},"Review + create")," then ",(0,r.kt)("strong",{parentName:"li"},"Create"),".")),(0,r.kt)("h4",{id:"configuring-the-resources"},"Configuring the Resources"),(0,r.kt)("p",null,"Once all the resources are created, you will need to get the connection information for the MySQL and Storage account to the Web App, as well as configure the resources for use."),(0,r.kt)("h5",{id:"configure-the-storage-account"},"Configure the Storage Account"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Navigate to the Storage Account resource, then ",(0,r.kt)("strong",{parentName:"li"},"Data storage")," - ",(0,r.kt)("strong",{parentName:"li"},"Containers"),"."),(0,r.kt)("li",{parentName:"ol"},"Create a new Container, provide a ",(0,r.kt)("em",{parentName:"li"},"Name"),", ",(0,r.kt)("inlineCode",{parentName:"li"},"strapi-uploads"),", and set ",(0,r.kt)("em",{parentName:"li"},"Public access level")," to ",(0,r.kt)("inlineCode",{parentName:"li"},"Blob"),", then click ",(0,r.kt)("strong",{parentName:"li"},"Create"),"."),(0,r.kt)("li",{parentName:"ol"},"Navigate to ",(0,r.kt)("strong",{parentName:"li"},"Security + networking")," - ",(0,r.kt)("strong",{parentName:"li"},"Access keys"),", copy the ",(0,r.kt)("em",{parentName:"li"},"Storage account name")," and ",(0,r.kt)("em",{parentName:"li"},"key1"),"."),(0,r.kt)("li",{parentName:"ol"},"Navigate to the ",(0,r.kt)("strong",{parentName:"li"},"Web App")," you created and go to ",(0,r.kt)("strong",{parentName:"li"},"Settings")," - ",(0,r.kt)("strong",{parentName:"li"},"Configuration"),"."),(0,r.kt)("li",{parentName:"ol"},"Create new application settings for the Storage account, storage account key and container name (these will become the environment variables available to Strapi) and click ",(0,r.kt)("em",{parentName:"li"},"Save"),".")),(0,r.kt)("h5",{id:"configure-mysql"},"Configure MySQL"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Navigate to the MySQL resource then ",(0,r.kt)("strong",{parentName:"p"},"Settings")," - ",(0,r.kt)("strong",{parentName:"p"},"Connection security"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Set ",(0,r.kt)("inlineCode",{parentName:"p"},"Allow access to Azure services")," to ",(0,r.kt)("inlineCode",{parentName:"p"},"Yes")," and click ",(0,r.kt)("strong",{parentName:"p"},"Save"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Navigate to ",(0,r.kt)("strong",{parentName:"p"},"Overview")," and copy ",(0,r.kt)("em",{parentName:"p"},"Server name")," and ",(0,r.kt)("em",{parentName:"p"},"Server admin login name"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Open the ",(0,r.kt)("a",{parentName:"p",href:"https://shell.azure.com?WT.mc_id=javascript-37811-aapowell"},"Azure Cloud Shell")," and log into the ",(0,r.kt)("inlineCode",{parentName:"p"},"mysql")," CLI:"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"mysql --host <server> --user <username> -p")))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a database for Strapi to use ",(0,r.kt)("inlineCode",{parentName:"p"},"CREATE DATABASE strapi;")," then close the Cloud Shell."),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"(",(0,r.kt)("em",{parentName:"li"},"Optional"),") - Create a separate non-server admin user (see ",(0,r.kt)("a",{parentName:"li",href:"https://docs.microsoft.com/azure/mysql/howto-create-users?tabs=single-server&WT.mc_id=javascript-37811-aapowell"},"Azure documentation")," for guidance)"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Navigate to the ",(0,r.kt)("strong",{parentName:"p"},"Web App")," you created and go to ",(0,r.kt)("strong",{parentName:"p"},"Settings")," - ",(0,r.kt)("strong",{parentName:"p"},"Configuration"),".")),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create new application settings for the Database host, username and password (these will become the environment variables available to Strapi) and click ",(0,r.kt)("em",{parentName:"p"},"Save"),"."))),(0,r.kt)("h3",{id:"creating-resources-via-the-azure-cli"},"Creating Resources via the Azure CLI"),(0,r.kt)("p",null,"In this section, we'll use the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/cli/azure/?WT.mc_id=javascript-37811-aapowell"},"Azure CLI")," to create the required resources. This will assume you have some familiarity with the Azure CLI and how to find the right values."),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a new Resource Group."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"rgName=my-strapi-app\nlocation=westus\naz group create --name $rgName --location $location\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a new Linux App Service Plan (ensure you change the ",(0,r.kt)("inlineCode",{parentName:"p"},"number-of-workers")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"sku")," to meet your scale requirements)."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"appPlanName=strapi-app-service-plan\naz appservice plan create --resource-group $rgName --name $appPlanName --is-linux --number-of-workers 4 --sku S1 --location $location\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a Web App running Node.js 16."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'webAppName=my-strapi-app\naz webapp create --resource-group $rgName --name $webAppName --plan $appPlanName --runtime "node|16-lts"\n'))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a Storage Account."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"saName=mystrapiapp\naz storage account create --resource-group $rgName --name $saName --location $location\n\n# Get the access key\nsaKey=$(az storage account keys list --account-name $saName --query \"[?keyName=='key1'].value\" --output tsv)\n\n# Add a container to the storage account\ncontainer=strapi-uploads\naz storage container create --name $container --public-access blob --account-key $saKey --account-name $saName\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Create a MySQL database."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"serverName=my-strapi-db\ndbName=strapi\nusername=strapi\npassword=...\n\n# Create the server\naz mysql server create --resource-group $rgName --name $serverName --location $location --admin-user $username --admin-password $password --version 5.7 --sku-name B_Gen5_1\n\n# Create the database\naz mysql db create --resource-group $rgName --name $dbName --server-name $serverName\n\n# Allow Azure resources through the firewall\naz mysql server firewall-rule create --resource-group $rgName --server-name $serverName --name AllowAllAzureIps --start-ip-address 0.0.0.0 --end-ip-address 0.0.0.0\n"))),(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("p",{parentName:"li"},"Add configuration values to the Web App."),(0,r.kt)("pre",{parentName:"li"},(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"az webapp config appsettings set --resource-group $rgName --name $webAppName --setting STORAGE_ACCOUNT=$saName\naz webapp config appsettings set --resource-group $rgName --name $webAppName --setting STORAGE_ACCOUNT_KEY=$saKey\naz webapp config appsettings set --resource-group $rgName --name $webAppName --setting STORAGE_ACCOUNT_CONTAINER=$container\naz webapp config appsettings set --resource-group $rgName --name $webAppName --setting DATABASE_HOST=$serverName.mysql.database.azure.com\naz webapp config appsettings set --resource-group $rgName --name $webAppName --setting DATABASE_USERNAME=$username@$serverName\naz webapp config appsettings set --resource-group $rgName --name $webAppName --setting DATABASE_PASSWORD=$password\n")))),(0,r.kt)("h3",{id:"deploy-with-an-azure-resource-manager-template"},"Deploy with an Azure Resource Manager template"),(0,r.kt)("p",null,"To deploy using an Azure Resource Manager template, use the button below, or upload ",(0,r.kt)("a",{parentName:"p",href:"https://gist.githubusercontent.com/aaronpowell/f216f119ffe5ed52945b46d0bb55569b/raw/2490a9295ea25c905096dbaae57da6ef8edb0e43/azuredeploy.json"},"this template")," as a custom deployment in Azure."),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://portal.azure.com/#create/Microsoft.Template/uri/https%3A%2F%2Fgist.githubusercontent.com%2Faaronpowell%2Ff216f119ffe5ed52945b46d0bb55569b%2Fraw%2F2490a9295ea25c905096dbaae57da6ef8edb0e43%2Fazuredeploy.json"},(0,r.kt)("img",{parentName:"a",src:"https://aka.ms/deploytoazurebutton",alt:"Deploy to Azure"}))),(0,r.kt)("h3",{id:"configure-strapi-for-azure-appservice"},"Configure Strapi for Azure AppService"),(0,r.kt)("p",null,"Azure AppService can be deployed to using CI/CD pipelines or via FTPS, refer to the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/azure/app-service/deploy-continuous-deployment?tabs=github&WT.mc_id=javascript-37811-aapowell"},"Azure docs")," on how to do this for your preferred manner."),(0,r.kt)("p",null,"As AppService is a PaaS hosting model, an upload provider will be required to save the uploaded assets to Azure Storage. Check out ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/jakeFeldman/strapi-provider-upload-azure-storage"},"this community provider")," for more details on using Azure Storage as an upload provider."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"For local development, you can either use the local disk upload provider, or the Azure Storage upload provider against the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.microsoft.com/azure/storage/common/storage-use-azurite?toc=%2Fazure%2Fstorage%2Fblobs%2Ftoc.json&tabs=visual-studio&WT.mc_id=javascript-37811-aapowell"},"Storage emulator"),".")),(0,r.kt)("p",null,"To start the Node.js application, AppService will run the ",(0,r.kt)("inlineCode",{parentName:"p"},"npm start")," command. As there is no guarantee that the symlinks created by ",(0,r.kt)("inlineCode",{parentName:"p"},"npm install")," were preserved (in the case of an upload from a CI/CD pipeline) it is recommended that the ",(0,r.kt)("inlineCode",{parentName:"p"},"npm start")," command directly references the Strapi entry point:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-json"},'"scripts": {\n    "start": "node node_modules/@strapi/strapi/bin/strapi.js start"\n}\n')),(0,r.kt)("h2",{id:"iaas-deployment-guide"},"IaaS Deployment Guide"),(0,r.kt)("p",null,"Databases can be on a ",(0,r.kt)("a",{parentName:"p",href:"https://azure.microsoft.com/services/virtual-machines/"},"Azure Virtual Machine"),", hosted externally as a service, or via the ",(0,r.kt)("a",{parentName:"p",href:"https://azure.microsoft.com/services/postgresql/"},"Azure Managed Databases"),"."),(0,r.kt)("admonition",{type:"prerequisites"},(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"You must have an ",(0,r.kt)("a",{parentName:"li",href:"https://azure.microsoft.com/free/"},"Azure account")," before doing these steps."),(0,r.kt)("li",{parentName:"ul"},"An SSH key to access the virtual machine"))),(0,r.kt)("h3",{id:"create-a-virtual-machine"},"Create a Virtual Machine"),(0,r.kt)("p",null,"You will want to use an Azure Virtual Machine for Strapi deployments, the Azure web-app (IIS) deployments are not recommended."),(0,r.kt)("h4",{id:"1-log-in-to-your-azure-portal"},"1. Log in to your ",(0,r.kt)("a",{parentName:"h4",href:"https://portal.azure.com/#home"},"Azure Portal")),(0,r.kt)("h4",{id:"2-create-a-vm-by-clicking-on-create-a-resource"},"2. Create a VM by clicking on ",(0,r.kt)("inlineCode",{parentName:"h4"},"Create a resource")),(0,r.kt)("h4",{id:"3-basics"},"3. Basics"),(0,r.kt)("p",null,"Virtual machines are listed under the ",(0,r.kt)("inlineCode",{parentName:"p"},"Compute")," category. You will need the following options:"),(0,r.kt)("p",null,"Project Details:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Subscription"),": Can be left as the default"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Resource Group"),": If you have none, simply hit ",(0,r.kt)("inlineCode",{parentName:"li"},"Create new"))),(0,r.kt)("p",null,"Instance Details:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Virtual machine name"),": This name is used as a resource identifier and the VM's hostname so try to keep it simple"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Region"),": Select the nearest region to you, or your target area"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Availability options"),": Leave as default"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Image"),": Ubuntu Server 18.04 LTS"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Azure Spot instance"),": No"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Size"),": B1ms (1vCPU / 2 GiB of Ram) is the recommended minimum as you need at least 2 GiB of RAM to build the Admin panel")),(0,r.kt)("p",null,"Administrator Account:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Authentication type"),": It's recommended you use ",(0,r.kt)("inlineCode",{parentName:"li"},"SSH public key")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Username"),": This is the SSH user, it can be set to whatever you like except ",(0,r.kt)("inlineCode",{parentName:"li"},"root"))),(0,r.kt)("p",null,"Inbound port rules:"),(0,r.kt)("p",null,"More configuration for this will be done when we get to the ",(0,r.kt)("inlineCode",{parentName:"p"},"Networking")," tab of the VM creation for now just leave these as the defaults."),(0,r.kt)("h4",{id:"4-disks"},"4. Disks"),(0,r.kt)("p",null,"It is entirely up to you which OS Disk type you use, for the cheapest option you should select ",(0,r.kt)("inlineCode",{parentName:"p"},"Standard HDD")," with no encryption. You can also add additional disks to the virtual machine if you need additional space (such as for uploads)."),(0,r.kt)("h4",{id:"5-networking"},"5. Networking"),(0,r.kt)("p",null,"For the networking configuration you will want to leave the following as defaults:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Virtual network"),(0,r.kt)("li",{parentName:"ul"},"Subnet"),(0,r.kt)("li",{parentName:"ul"},"Public IP"),(0,r.kt)("li",{parentName:"ul"},"Accelerated networking"),(0,r.kt)("li",{parentName:"ul"},"Load Balancing (off/no)")),(0,r.kt)("p",null,"However for the NIC network security group we will want to select ",(0,r.kt)("inlineCode",{parentName:"p"},"Advanced")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"Create New"),". You can name this whatever you like but for inbound rules we want to allow:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"SSH (TCP/22) - Already on be default"),(0,r.kt)("li",{parentName:"ul"},"HTTPS (Any/443)"),(0,r.kt)("li",{parentName:"ul"},"HTTP (Any/80)"),(0,r.kt)("li",{parentName:"ul"},"Strapi (Any/1337)")),(0,r.kt)("p",null,"For each of the ports to allow, you will hit create new and enter the following information:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Source"),": Any"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Source port ranges"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"*")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Destination"),": Any"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Destination port ranges"),": The port from above (80, 443, or 1337)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Protocol"),": Any"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Action"),": Allow"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Priority"),": This should be auto-filled for you"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Name"),": something to easily describe this rule such as ",(0,r.kt)("inlineCode",{parentName:"li"},"HTTPS_Port")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"Strapi_Port"))),(0,r.kt)("h4",{id:"6-management"},"6. Management"),(0,r.kt)("p",null,"Entirely optional but you can enable the ",(0,r.kt)("inlineCode",{parentName:"p"},"OS guest diagnostics")," to configure alerting later on, everything else on this tab is also entirely optional. For now let's leave everything as the default options."),(0,r.kt)("h4",{id:"7-advanced"},"7. Advanced"),(0,r.kt)("p",null,"If you are familiar with standard Linux ",(0,r.kt)("inlineCode",{parentName:"p"},"Cloud init")," you are welcome to add in any configuration script to jump-start your virtual machine with some pre-configured packages, however we will leave everything here as default."),(0,r.kt)("h4",{id:"8-tags-review--create"},"8. Tags, Review + Create"),(0,r.kt)("p",null,'You are welcome to tag this virtual machine to easily identify it and others part of your "Project" later on.'),(0,r.kt)("p",null,"Finally review you configuration and wait for Azure to validate the configuration, on this page you will also see the price of your VM per hour. This price will vary based on the region and size of virtual machine you selected (along with any additional options)."),(0,r.kt)("p",null,"Once you have finished verifying your config hit the ",(0,r.kt)("inlineCode",{parentName:"p"},"Create")," button. It may take a few minutes for your deployment to complete, you will see a log of the deployment on the next page. When it's finished you will see ",(0,r.kt)("inlineCode",{parentName:"p"},"Your deployment is complete"),", simply hit ",(0,r.kt)("inlineCode",{parentName:"p"},"Go to resource"),"."),(0,r.kt)("h3",{id:"logging-in-and-installing-strapi-dependencies"},"Logging in and installing Strapi dependencies"),(0,r.kt)("p",null,"These next steps will help you set up a production server and setup a non-root service account for managing your Strapi instance. You will need the administrator account you created previously and the public IP listed on your resource page."),(0,r.kt)("h4",{id:"1-ssh-to-your-administrator-account-created-previously"},"1. SSH to your Administrator account created previously"),(0,r.kt)("p",null,"You will use the admin user created previously as well as the SSH key you added to your Azure account. For Linux/Mac users you can use your terminal, likewise for Windows users you can use the built -in SSH tool in Powershell or use an SSH client like Putty."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"ssh yourAdminUser@yourAzureVMPublicIP\n\n# ssh strapiAdmin@10.0.0.1\n")),(0,r.kt)("h4",{id:"2-updating-packages-and-installing-dependencies"},"2. Updating packages and installing dependencies"),(0,r.kt)("p",null,"After you login via SSH we need to update the container and install any packages that Strapi may need. The following packages have been identified to be required to run Strapi on Ubuntu 18.04 LTS:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"libpng-dev"),(0,r.kt)("li",{parentName:"ul"},"build-essential"),(0,r.kt)("li",{parentName:"ul"},"nodejs (v12 thus we will use an external apt repo)"),(0,r.kt)("li",{parentName:"ul"},"yarn (optional but recommended)")),(0,r.kt)("p",null,"First we need to update existing packages, you will use the apt package manager to do this:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt update\nsudo apt upgrade -y\n")),(0,r.kt)("p",null,"After the updates have installed, we will move on to installing required dependencies from the existing apt repos before we add any additional ones:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt install libpng-dev build-essential -y\n")),(0,r.kt)("p",null,"For Node.js it is recommended you use the ",(0,r.kt)("a",{parentName:"p",href:"https://github.com/nodesource/distributions/blob/master/README.md#debinstall"},"official source"),", per the instructions we will use the following commands:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash - &&\\\nsudo apt-get install -y nodejs\n")),(0,r.kt)("p",null,"Likewise for Yarn we will use the instructions from the ",(0,r.kt)("a",{parentName:"p",href:"https://yarnpkg.com/getting-started/install"},"Yarn documentation"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"corepack enable\nyarn set version stable\nyarn install\n")),(0,r.kt)("p",null,"To verify you have everything installed properly you can run the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"node -v && npm -v && yarn -v\n")),(0,r.kt)("p",null,"This should print out the versions of each."),(0,r.kt)("h4",{id:"3-creating-the-strapi-service-user-and-creatingcloning-your-project"},"3. Creating the Strapi service user and creating/cloning your project"),(0,r.kt)("p",null,"A service user is defined as a user who has limited permissions and access, this user typically does not have access to ",(0,r.kt)("inlineCode",{parentName:"p"},"sudo")," nor can modify anything else on the system."),(0,r.kt)("p",null,"We will create the service user with a disabled login to ensure it cannot be accessed via SSH."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'sudo adduser --shell /bin/bash --disabled-login --gecos "" --quiet strapi\n')),(0,r.kt)("p",null,"We will be making the ",(0,r.kt)("inlineCode",{parentName:"p"},"/srv/strapi")," directory to hold our project. From here we can either create a new project or clone an existing one from say a Github or Gitlab repository. For private repositories, you will likely need to setup additional SSH keys and access."),(0,r.kt)("p",null,"First we will make the directory, then we will give the ",(0,r.kt)("inlineCode",{parentName:"p"},"strapi")," service user access to read/write."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo mkdir /srv/strapi\nsudo chown strapi:strapi /srv/strapi\n")),(0,r.kt)("h4",{id:"4-choosing-and-installing-a-database"},"4. Choosing and installing a database"),(0,r.kt)("p",null,"Strapi will need a database in order to save data to, you have multiple options for this."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Using Azure managed databases"),(0,r.kt)("li",{parentName:"ul"},"Installing a database on this virtual machine"),(0,r.kt)("li",{parentName:"ul"},"Using SQLite on this virtual machine (does not require any additional software)")),(0,r.kt)("p",null,"For Azure managed databases you can use the following:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Azure Database for MySQL"),(0,r.kt)("li",{parentName:"ul"},"Azure Database for PostgreSQL"),(0,r.kt)("li",{parentName:"ul"},"Azure Database for MariaDB")),(0,r.kt)("p",null,"Likewise you can use any of the following installed locally on the virtual machine:"),(0,r.kt)(i.default,{components:a.components,mdxType:"DatabaseRequire"}),(0,r.kt)("p",null,"In our example we will be using MariaDB 10.4 LTS using the MariaDB apt repo. Per the ",(0,r.kt)("a",{parentName:"p",href:"https://downloads.mariadb.org/mariadb/repositories/#distro=Ubuntu&distro_release=bionic--ubuntu_bionic&mirror=digitalocean-sfo&version=10.4"},"documentation")," we will use the following commands:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo apt-key adv --fetch-keys 'https://mariadb.org/mariadb_release_signing_key.asc'\nsudo add-apt-repository 'deb [arch=amd64,arm64,ppc64el] http://sfo1.mirrors.digitalocean.com/mariadb/repo/10.4/ubuntu bionic main'\n\nsudo apt update\nsudo apt install mariadb-server-10.4 -y\n")),(0,r.kt)("p",null,"Then we will need to create our Strapi database, database user, and grant the user access. We will need to enter a MySQL shell to perform these commands. MariaDB 10.4+ no longer has a root password and instead the root user is granted access via ",(0,r.kt)("inlineCode",{parentName:"p"},"sudo")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo mysql -u root\n")),(0,r.kt)("p",null,"You should now see the following prompt ",(0,r.kt)("inlineCode",{parentName:"p"},"MariaDB [(none)]>"),", this is the MySQL shell that allows us to give commands to the MariaDB server."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# Create the database\ncreate database strapi_dev;\n\n# Create the database user\ncreate user strapi@localhost identified by 'mysecurepassword';\n\n# Grant the database user permissions\ngrant all privileges on strapi_dev.* to strapi@localhost;\n\n# Flush Privileges to reload the grant tables\nFLUSH PRIVILEGES;\n\n# Exit the MySQL shell\nexit\n")),(0,r.kt)("p",null,"And we now have everything we need to create/start our Strapi project."),(0,r.kt)("h3",{id:"creating-or-cloning-our-strapi-project"},"Creating or cloning our Strapi Project"),(0,r.kt)("p",null,"If you are cloning a project from Git your configuration steps may be different depending on how you store private information such as database information, JWT secret keys, and various other secrets. In our case we will be creating a new project."),(0,r.kt)("h4",{id:"1-create-the-new-project"},"1. Create the new project"),(0,r.kt)("p",null,"You will first need to change users into the service user created previously, and change directories to the service directory"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# Change users\nsudo su strapi\n\n# Change directory\ncd /srv/strapi\n")),(0,r.kt)("p",null,"Now we can use Yarn to create our project, this ",(0,r.kt)("strong",{parentName:"p"},"does not")," require you to install any global packages much like npx."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"yarn create strapi-app mystrapiapp\n")),(0,r.kt)("p",null,"This will bring you to an interactive command shell to enter the following information:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Choose your installation type"),": Custom (manual settings)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Choose your default database client"),": mysql"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Database name"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"strapi_dev")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Host"),": Keep the default of ",(0,r.kt)("inlineCode",{parentName:"li"},"127.0.0.1")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Port"),": Keep the default of ",(0,r.kt)("inlineCode",{parentName:"li"},"3306")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Username"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"strapi")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Password"),": ",(0,r.kt)("inlineCode",{parentName:"li"},"mysecurepassword")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Enable SSL connection"),": Keep the default of ",(0,r.kt)("inlineCode",{parentName:"li"},"N"))),(0,r.kt)("p",null,"Yarn will now install the project and install all the Node.js dependencies, we can now change directory again and start the project."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# Change directory\ncd mystrapiapp\n\n# Temporary start (will build the Admin panel)\nyarn develop\n")),(0,r.kt)("p",null,"Now you should be able to access your Strapi application on the public IP of your virtual machine via the default Strapi port of ",(0,r.kt)("inlineCode",{parentName:"p"},"1337"),". Naturally if we close the SSH session the Strapi server will also be killed so we need to run it as a service."),(0,r.kt)("h4",{id:"2-modifying-configurations-to-be-more-secure"},"2. Modifying configurations to be more secure"),(0,r.kt)("p",null,"By default Strapi will predefine environment variables to use with your database config."),(0,r.kt)("p",null,"If we edit the ",(0,r.kt)("inlineCode",{parentName:"p"},"./config/database.js")," file using ",(0,r.kt)("inlineCode",{parentName:"p"},"nano")," we can replace a few key settings:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"nano /srv/strapi/mystrapiapp/config/database.js\n")),(0,r.kt)("p",null,"Using the following example we will remove any private information:"),(0,r.kt)(d,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(k,{value:"javascript",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="path: /srv/strapi/mystrapiapp/config/database.js"',title:'"path:','/srv/strapi/mystrapiapp/config/database.js"':!0},"\nmodule.exports = ({ env }) => ({\n  connection: {\n    client: 'mysql',\n    connection: {\n      host: env('DB_HOST'),\n      port: env.int('DB_PORT'),\n      database: env('DB_NAME'),\n      user: env('DB_USER'),\n      password: env('DB_PASS'),\n      ssl: {\n        rejectUnauthorized: env.bool('DATABASE_SSL_SELF', false), // For self-signed certificates\n      },\n    },\n    debug: false,\n  },\n});\n"))),(0,r.kt)(k,{value:"typescript",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="path: /srv/strapi/mystrapiapp/config/database.ts"',title:'"path:','/srv/strapi/mystrapiapp/config/database.ts"':!0},"\n  export default ({ env }) => ({\n  connection: {\n    client: 'mysql',\n    connection: {\n      host: env('DB_HOST'),\n      port: env.int('DB_PORT'),\n      database: env('DB_NAME'),\n      user: env('DB_USER'),\n      password: env('DB_PASS'),\n      ssl: {\n        rejectUnauthorized: env.bool('DATABASE_SSL_SELF', false), // For self-signed certificates\n      },\n    },\n    debug: false,\n  },\n});\n")))),(0,r.kt)("h4",{id:"3-installing-pm2-and-running-strapi-as-a-service"},"3. Installing PM2 and running Strapi as a service"),(0,r.kt)("p",null,"Now we will install ",(0,r.kt)("a",{parentName:"p",href:"https://pm2.keymetrics.io/docs/usage/quick-start/"},"PM2")," to run Strapi as a service, and using the PM2 ecosystem config file we can define our environment variables."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Using the lifecycle file ",(0,r.kt)("strong",{parentName:"p"},"is not")," required and is entirely optional, you can instead define your environment variables via the CLI")),(0,r.kt)("p",null,"Using Yarn, we will install ",(0,r.kt)("inlineCode",{parentName:"p"},"PM2")," globally, and adjust our ",(0,r.kt)("inlineCode",{parentName:"p"},".bashrc")," file to allow us to use global Yarn packages:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# Install PM2\nyarn global add pm2\n\n# Edit our ~/.bashrc file for global Yarn packages\nnano ~/.bashrc\n")),(0,r.kt)("p",null,"You will want to paste the following ",(0,r.kt)("strong",{parentName:"p"},"at the end")," of the `.bashrc file:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'export PATH="$PATH:$(yarn global bin)"\n')),(0,r.kt)("p",null,"From here you can either exit the service user and log back in for the changes to take effect or simply run:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"source ~/.bashrc\n")),(0,r.kt)("p",null,"And we will create our ",(0,r.kt)("inlineCode",{parentName:"p"},"ecosystem.config.js")," using the ",(0,r.kt)("inlineCode",{parentName:"p"},"pm2 init")," command, you should run this in your Strapi project directory"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"# Create the ecosystem file\npm2 init\n")),(0,r.kt)("p",null,"You should get the message ",(0,r.kt)("inlineCode",{parentName:"p"},"File /srv/strapi/mystrapiapp/ecosystem.config.js generated"),", lets go ahead and edit this file using ",(0,r.kt)("inlineCode",{parentName:"p"},"nano")," and add our config settings."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"nano /srv/strapi/mystrapiapp/ecosystem.config.js\n")),(0,r.kt)("p",null,"Replace the boilerplate information with something like the following:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = {\n  apps: [\n    {\n      name: 'strapi-dev',\n      cwd: '/srv/strapi/mystrapiapp',\n      script: 'npm',\n      args: 'start',\n      env: {\n        NODE_ENV: 'development',\n        DB_HOST: 'localhost',\n        DB_PORT: '5432',\n        DB_NAME: 'strapi_dev',\n        DB_USER: 'strapi',\n        DB_PASS: 'mysecurepassword',\n        JWT_SECRET: 'aSecretKey',\n      },\n    },\n  ],\n};\n")),(0,r.kt)("p",null,"You can also set your environment variables in a ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file in your project like so:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"DB_HOST=localhost\nDB_PORT=5432\nDB_NAME=strapi_dev\nDB_USER=strapi\nDB_PASS=mysecurepassword\nJWT_SECRET=aSecretKey\n")),(0,r.kt)("p",null,"We recommend you continue setting the ",(0,r.kt)("inlineCode",{parentName:"p"},"NODE_ENV")," variable in the ",(0,r.kt)("inlineCode",{parentName:"p"},"ecosystem.config.js")," file."),(0,r.kt)("p",null,"Then use the following command to start the Strapi service:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pm2 start ecosystem.config.js\n")),(0,r.kt)("p",null,"The Strapi ",(0,r.kt)("inlineCode",{parentName:"p"},"PM2")," service is now set-up to use an ",(0,r.kt)("inlineCode",{parentName:"p"},"ecosystem.config.js")," to manage your application."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"OPTIONAL:")," You may see your project and set-up your first administrator user, by ",(0,r.kt)("a",{parentName:"p",href:"/dev-docs/quick-start"},"creating an admin user"),"."),(0,r.kt)("h4",{id:"4-starting-strapi-on-boot-and-persisting-service-between-reboots"},"4. Starting Strapi on boot and persisting service between reboots"),(0,r.kt)("p",null,"Follow the steps below to have your app launch on system startup."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Generate and configure a startup script to launch PM2, it will generate a Startup Script to copy/paste, do so:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pm2 startup systemd\n\n[PM2] Init System found: systemd\n[PM2] To setup the Startup Script, copy/paste the following command:\nsudo env PATH=$PATH:/usr/bin /usr/lib/node_modules/pm2/bin/pm2 startup systemd -u your-name --hp /home/your-name\n")),(0,r.kt)("p",null,"For the following command we want to be using your virtual machine admin user ",(0,r.kt)("strong",{parentName:"p"},"not the service user"),", to exit from the service user you can simply run the command ",(0,r.kt)("inlineCode",{parentName:"p"},"exit")," to return to your admin user."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Copy/paste the generated command as the virtual machine admin user (",(0,r.kt)("strong",{parentName:"li"},"DO NOT")," use the below command as you need to replace the service user name, the previous command will give you exactly what you need):")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo env PATH=$PATH:/usr/bin /usr/lib/node_modules/pm2/bin/pm2 startup systemd -u your-name --hp /home/your-name\n\n[PM2] Init System found: systemd\nPlatform systemd\n\n. . .\n\n\n[PM2] [v] Command successfully executed.\n+---------------------------------------+\n[PM2] Freeze a process list on reboot via:\n   $ pm2 save\n\n[PM2] Remove init script via:\n   $ pm2 unstartup systemd\n")),(0,r.kt)("p",null,"Now as the service user run the following (again use ",(0,r.kt)("inlineCode",{parentName:"p"},"sudo su yourserviceuser")," to change back)"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Next, ",(0,r.kt)("inlineCode",{parentName:"li"},"Save")," the new ",(0,r.kt)("inlineCode",{parentName:"li"},"PM2")," process list and environment.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pm2 save\n\n[PM2] Saving current process list...\n[PM2] Successfully saved in /home/your-name/.pm2/dump.pm2\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"OPTIONAL"),": You can test to see if the script above works whenever your system reboots with the ",(0,r.kt)("inlineCode",{parentName:"li"},"sudo reboot")," command. You will need to login again with your ",(0,r.kt)("strong",{parentName:"li"},"service user")," and then run ",(0,r.kt)("inlineCode",{parentName:"li"},"pm2 list")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"systemctl status pm2-your-name")," to verify everything is working.")),(0,r.kt)("h3",{id:"optional-additions"},"Optional additions"),(0,r.kt)("p",null,"Below are some optional additions to secure your virtual machine and Strapi service."),(0,r.kt)("h4",{id:"1-securing-your-virtual-machine-with-a-firewall"},"1. Securing your virtual machine with a firewall"),(0,r.kt)("p",null,"Azure virtual machines come with a firewall at the host level (see previous instructions ",(0,r.kt)("a",{parentName:"p",href:"#_5-networking"},"here"),"). However it is recommended that you use the built in Ubuntu firewall as well known as UFW or Uncomplicated Firewall."),(0,r.kt)("p",null,"See the following ",(0,r.kt)("a",{parentName:"p",href:"https://www.digitalocean.com/community/tutorials/how-to-set-up-a-firewall-with-ufw-on-ubuntu-18-04"},"DigitalOcean guide")," to see some examples of using UFW."),(0,r.kt)("h4",{id:"2-installing-a-proxy-for-ssl"},"2. Installing a proxy for SSL"),(0,r.kt)("p",null,"There are many different types of proxy services you could use, anything from load balancing, offloading SSL, to fault tolerance. You can view a few ",(0,r.kt)("a",{parentName:"p",href:"/dev-docs/deployment#optional-software-guides"},"examples")," based around Strapi and basic SSL offloading."),(0,r.kt)("h4",{id:"3-file-upload-providers"},"3. File upload providers"),(0,r.kt)("p",null,"There are many options for storing files outside of your virtual machine, Strapi have built a few and the community is constantly building new ones. See the ",(0,r.kt)("a",{parentName:"p",href:"/dev-docs/providers"},"following guide")," on searching for options as well as installing them."))}h.isMDXComponent=!0},14188:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var n=a(83117),r=(a(67294),a(3905));const i={},o=void 0,l={unversionedId:"snippets/consider-strapi-cloud",id:"snippets/consider-strapi-cloud",title:"consider-strapi-cloud",description:"You can also use Strapi Cloud to quickly deploy and host your project.",source:"@site/docs/snippets/consider-strapi-cloud.md",sourceDirName:"snippets",slug:"/snippets/consider-strapi-cloud",permalink:"/aberabook/snippets/consider-strapi-cloud",draft:!1,editUrl:"https://github.com/labs-solo/aberabook/edit/main/docusaurus/docs/snippets/consider-strapi-cloud.md",tags:[],version:"current",frontMatter:{}},s={},p=[],u={toc:p};function m(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("admonition",{title:"\u2601\ufe0f Strapi Cloud",type:"callout"},(0,r.kt)("p",{parentName:"admonition"},"You can also use ",(0,r.kt)("a",{parentName:"p",href:"/cloud/intro"},"Strapi Cloud")," to quickly deploy and host your project.")))}m.isMDXComponent=!0},56927:(e,t,a)=>{a.r(t),a.d(t,{assets:()=>s,contentTitle:()=>o,default:()=>m,frontMatter:()=>i,metadata:()=>l,toc:()=>p});var n=a(83117),r=(a(67294),a(3905));const i={},o=void 0,l={unversionedId:"snippets/database-require",id:"snippets/database-require",title:"database-require",description:"| Database   | Recommended | Minimum |",source:"@site/docs/snippets/database-require.md",sourceDirName:"snippets",slug:"/snippets/database-require",permalink:"/aberabook/snippets/database-require",draft:!1,editUrl:"https://github.com/labs-solo/aberabook/edit/main/docusaurus/docs/snippets/database-require.md",tags:[],version:"current",frontMatter:{}},s={},p=[],u={toc:p};function m(e){let{components:t,...a}=e;return(0,r.kt)("wrapper",(0,n.Z)({},u,a,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Database"),(0,r.kt)("th",{parentName:"tr",align:null},"Recommended"),(0,r.kt)("th",{parentName:"tr",align:null},"Minimum"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"MySQL"),(0,r.kt)("td",{parentName:"tr",align:null},"8.0"),(0,r.kt)("td",{parentName:"tr",align:null},"5.7.8")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"MariaDB"),(0,r.kt)("td",{parentName:"tr",align:null},"10.6"),(0,r.kt)("td",{parentName:"tr",align:null},"10.3")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"PostgreSQL"),(0,r.kt)("td",{parentName:"tr",align:null},"14.0"),(0,r.kt)("td",{parentName:"tr",align:null},"11.0")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},"SQLite"),(0,r.kt)("td",{parentName:"tr",align:null},"3"),(0,r.kt)("td",{parentName:"tr",align:null},"3")))))}m.isMDXComponent=!0}}]);