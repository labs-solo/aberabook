"use strict";(self.webpackChunkstrapi_docs=self.webpackChunkstrapi_docs||[]).push([[3062],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>m});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var p=a.createContext({}),d=function(e){var t=a.useContext(p),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=d(e.components);return a.createElement(p.Provider,{value:t},e.children)},s={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,p=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),c=d(n),m=r,g=c["".concat(p,".").concat(m)]||c[m]||s[m]||o;return n?a.createElement(g,i(i({ref:t},u),{},{components:n})):a.createElement(g,i({ref:t},u))}));function m(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=c;var l={};for(var p in t)hasOwnProperty.call(t,p)&&(l[p]=t[p]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var d=2;d<o;d++)i[d]=n[d];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},76596:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>i,default:()=>g,frontMatter:()=>o,metadata:()=>l,toc:()=>d});var a=n(83117),r=(n(67294),n(3905));const o={title:"Upload Provider",displayed_sidebar:"cloudSidebar",description:"Configure Strapi Cloud to use a third-party upload provider.",canonicalUrl:"https://docs.strapi.io/cloud/advanced/upload.html"},i="Upload Provider",l={unversionedId:"cloud/advanced/upload",id:"cloud/advanced/upload",title:"Upload Provider",description:"Configure Strapi Cloud to use a third-party upload provider.",source:"@site/docs/cloud/advanced/upload.md",sourceDirName:"cloud/advanced",slug:"/cloud/advanced/upload",permalink:"/aberabook/cloud/advanced/upload",draft:!1,editUrl:"https://github.com/labs-solo/aberabook/edit/main/docusaurus/docs/cloud/advanced/upload.md",tags:[],version:"current",frontMatter:{title:"Upload Provider",displayed_sidebar:"cloudSidebar",description:"Configure Strapi Cloud to use a third-party upload provider.",canonicalUrl:"https://docs.strapi.io/cloud/advanced/upload.html"},sidebar:"cloudSidebar",previous:{title:"Email Provider",permalink:"/aberabook/cloud/advanced/email"}},p={},d=[{value:"Configuration",id:"configuration",level:2},{value:"Install the Provider Plugin",id:"install-the-provider-plugin",level:3},{value:"Configure the Provider",id:"configure-the-provider",level:3},{value:"Configure the Security Middleware",id:"configure-the-security-middleware",level:3},{value:"Strapi Cloud Configuration",id:"strapi-cloud-configuration",level:3},{value:"Deployment",id:"deployment",level:2}],u=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",t)},s=u("Tabs"),c=u("TabItem"),m={toc:d};function g(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},m,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"upload-provider"},"Upload Provider"),(0,r.kt)("p",null,"Strapi Cloud comes with a local upload provider out of the box. However, it can also be configured to utilize a third-party upload provider, if needed."),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Please be advised that Strapi are unable to provide support for third-party upload providers.")),(0,r.kt)("admonition",{type:"prerequisites"},(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"A local Strapi project running on ",(0,r.kt)("inlineCode",{parentName:"li"},"v4.8.2+"),"."),(0,r.kt)("li",{parentName:"ul"},"Credentials for a third-party upload provider (see ",(0,r.kt)("a",{parentName:"li",href:"https://market.strapi.io/providers"},"Strapi Market"),")."))),(0,r.kt)("h2",{id:"configuration"},"Configuration"),(0,r.kt)("p",null,"Configuring a third-party upload provider for use with Strapi Cloud requires 4 steps:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Install the provider plugin in your local Strapi project."),(0,r.kt)("li",{parentName:"ol"},"Configure the provider in your local Strapi project."),(0,r.kt)("li",{parentName:"ol"},"Configure the Security Middleware in your local Strapi project."),(0,r.kt)("li",{parentName:"ol"},"Add environment variables to the Strapi Cloud project.")),(0,r.kt)("h3",{id:"install-the-provider-plugin"},"Install the Provider Plugin"),(0,r.kt)("p",null,"Using either ",(0,r.kt)("inlineCode",{parentName:"p"},"npm")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"yarn"),", install the provider plugin in your local Strapi project as a package dependency by following the instructions in the respective entry for that provider in the ",(0,r.kt)("a",{parentName:"p",href:"https://market.strapi.io/providers"},"Marketplace"),"."),(0,r.kt)("h3",{id:"configure-the-provider"},"Configure the Provider"),(0,r.kt)("p",null,"To configure a 3rd-party upload provider in your Strapi project, create or edit the plugins configuration file for your production environment ",(0,r.kt)("inlineCode",{parentName:"p"},"./config/env/production/plugins.js|ts")," by adding upload configuration options as follows:"),(0,r.kt)(s,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(c,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"title=./config/env/production/plugins.js",title:"./config/env/production/plugins.js"},"\nmodule.exports = ({ env }) => ({\n// \u2026 some unrelated plugins configuration options\n// highlight-start\nupload: {\n   config: {\n      // \u2026 provider-specific upload configuration options go here\n   }\n// highlight-end\n// \u2026 some other unrelated plugins configuration options\n}\n});\n"))),(0,r.kt)(c,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:"title=./config/env/production/plugins.ts",title:"./config/env/production/plugins.ts"},"\nexport default ({ env }) => ({\n// \u2026 some unrelated plugins configuration options\n// highlight-start\nupload: {\n   config: {\n      // \u2026 provider-specific upload configuration options go here\n   }\n// highlight-end\n// \u2026 some other unrelated plugins configuration options\n}\n});\n")))),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"The file structure must match the above path exactly, or the configuration will not be applied to Strapi Cloud.")),(0,r.kt)("p",null,"Each provider will have different configuration settings available. Review the respective entry for that provider in the ",(0,r.kt)("a",{parentName:"p",href:"https://market.strapi.io/providers"},"Marketplace"),"."),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Example:")),(0,r.kt)(s,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(c,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)(s,{groupId:"upload-examples",mdxType:"Tabs"},(0,r.kt)(c,{value:"cloudinary",label:"Cloudinary",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"title=./config/env/production/plugins.js",title:"./config/env/production/plugins.js"},"module.exports = ({ env }) => ({\n  // ...\n  upload: {\n    config: {\n      provider: 'cloudinary',\n      providerOptions: {\n        cloud_name: env('CLOUDINARY_NAME'),\n        api_key: env('CLOUDINARY_KEY'),\n        api_secret: env('CLOUDINARY_SECRET'),\n      },\n      actionOptions: {\n        upload: {},\n        uploadStream: {},\n        delete: {},\n      },\n    },\n  },\n  // ...\n});\n"))),(0,r.kt)(c,{value:"amazon-s3",label:"Amazon S3",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"title=./config/env/production/plugins.js",title:"./config/env/production/plugins.js"},"module.exports = ({ env }) => ({\n  // ...\n  upload: {\n    config: {\n      provider: 'aws-s3',\n      providerOptions: {\n        baseUrl: env('CDN_URL'),\n        rootPath: env('CDN_ROOT_PATH'),\n        s3Options: {\n          accessKeyId: env('AWS_ACCESS_KEY_ID'),\n          secretAccessKey: env('AWS_ACCESS_SECRET'),\n          region: env('AWS_REGION'),\n          params: {\n            ACL: env('AWS_ACL', 'public-read'),\n            signedUrlExpires: env('AWS_SIGNED_URL_EXPIRES', 15 * 60),\n            Bucket: env('AWS_BUCKET'),\n          },\n        },\n      },\n      actionOptions: {\n        upload: {},\n        uploadStream: {},\n        delete: {},\n      },\n    },\n  },\n  // ...\n});\n"))))),(0,r.kt)(c,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)(s,{groupId:"upload-examples",mdxType:"Tabs"},(0,r.kt)(c,{value:"cloudinary",label:"Cloudinary",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:"title=./config/env/production/plugins.ts",title:"./config/env/production/plugins.ts"},"export default ({ env }) => ({\n  // ...\n  upload: {\n    config: {\n      provider: 'cloudinary',\n      providerOptions: {\n        cloud_name: env('CLOUDINARY_NAME'),\n        api_key: env('CLOUDINARY_KEY'),\n        api_secret: env('CLOUDINARY_SECRET'),\n      },\n      actionOptions: {\n        upload: {},\n        uploadStream: {},\n        delete: {},\n      },\n    },\n  },\n  // ...\n});\n"))),(0,r.kt)(c,{value:"amazon-s3",label:"Amazon S3",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:"title=./config/env/production/plugins.ts",title:"./config/env/production/plugins.ts"},"export default ({ env }) => ({\n  // ...\n  upload: {\n    config: {\n      provider: 'aws-s3',\n      providerOptions: {\n        baseUrl: env('CDN_URL'),\n        rootPath: env('CDN_ROOT_PATH'),\n        s3Options: {\n          accessKeyId: env('AWS_ACCESS_KEY_ID'),\n          secretAccessKey: env('AWS_ACCESS_SECRET'),\n          region: env('AWS_REGION'),\n          params: {\n            ACL: env('AWS_ACL', 'public-read'),\n            signedUrlExpires: env('AWS_SIGNED_URL_EXPIRES', 15 * 60),\n            Bucket: env('AWS_BUCKET'),\n          },\n        },\n      },\n      actionOptions: {\n        upload: {},\n        uploadStream: {},\n        delete: {},\n      },\n    },\n  },\n  // ...\n});\n")))))),(0,r.kt)("h3",{id:"configure-the-security-middleware"},"Configure the Security Middleware"),(0,r.kt)("p",null,"Due to the default settings in the Strapi Security Middleware you will need to modify the ",(0,r.kt)("inlineCode",{parentName:"p"},"contentSecurityPolicy")," settings to properly see thumbnail previews in the Media Library."),(0,r.kt)("p",null,"To do this in your Strapi project:"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Navigate to ",(0,r.kt)("inlineCode",{parentName:"li"},"./config/middleware.js")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"./config/middleware.ts")," in your Strapi project."),(0,r.kt)("li",{parentName:"ol"},"Replace the default ",(0,r.kt)("inlineCode",{parentName:"li"},"strapi::security")," string with the object provided by the upload provider.")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Example:")),(0,r.kt)(s,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(c,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)(s,{groupId:"upload-examples",mdxType:"Tabs"},(0,r.kt)(c,{value:"cloudinary",label:"Cloudinary",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"title=./config/middleware.js",title:"./config/middleware.js"},"module.exports = [\n  // ...\n  {\n    name: 'strapi::security',\n    config: {\n      contentSecurityPolicy: {\n        useDefaults: true,\n        directives: {\n          'connect-src': [\"'self'\", 'https:'],\n          'img-src': [\n            \"'self'\", \n            'data:', \n            'blob:', \n            'market-assets.strapi.io', \n            'res.cloudinary.com'\n          ],\n          'media-src': [\n            \"'self'\",\n            'data:',\n            'blob:',\n            'market-assets.strapi.io',\n            'res.cloudinary.com',\n          ],\n          upgradeInsecureRequests: null,\n        },\n      },\n    },\n  },\n  // ...\n];\n"))),(0,r.kt)(c,{value:"amazon-s3",label:"Amazon S3",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:"title=./config/middleware.js",title:"./config/middleware.js"},"module.exports = [\n  // ...\n  {\n    name: 'strapi::security',\n    config: {\n      contentSecurityPolicy: {\n        useDefaults: true,\n        directives: {\n          'connect-src': [\"'self'\", 'https:'],\n          'img-src': [\n            \"'self'\",\n            'data:',\n            'blob:',\n            'market-assets.strapi.io',\n            'yourBucketName.s3.yourRegion.amazonaws.com',\n          ],\n          'media-src': [\n            \"'self'\",\n            'data:',\n            'blob:',\n            'market-assets.strapi.io',\n            'yourBucketName.s3.yourRegion.amazonaws.com',\n          ],\n          upgradeInsecureRequests: null,\n        },\n      },\n    },\n  },\n  // ...\n];\n"))))),(0,r.kt)(c,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)(s,{groupId:"upload-examples",mdxType:"Tabs"},(0,r.kt)(c,{value:"cloudinary",label:"Cloudinary",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:"title=./config/middleware.ts",title:"./config/middleware.ts"},"export default [\n  // ...\n  {\n    name: 'strapi::security',\n    config: {\n      contentSecurityPolicy: {\n        useDefaults: true,\n        directives: {\n          'connect-src': [\"'self'\", 'https:'],\n          'img-src': [\n            \"'self'\", \n            'data:', \n            'blob:', \n            'market-assets.strapi.io', \n            'res.cloudinary.com'\n          ],\n          'media-src': [\n            \"'self'\",\n            'data:',\n            'blob:',\n            'market-assets.strapi.io',\n            'res.cloudinary.com',\n          ],\n          upgradeInsecureRequests: null,\n        },\n      },\n    },\n  },\n  // ...\n];\n"))),(0,r.kt)(c,{value:"amazon-s3",label:"Amazon S3",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:"title=./config/middleware.ts",title:"./config/middleware.ts"},"export default [\n  // ...\n  {\n    name: 'strapi::security',\n    config: {\n      contentSecurityPolicy: {\n        useDefaults: true,\n        directives: {\n          'connect-src': [\"'self'\", 'https:'],\n          'img-src': [\n            \"'self'\",\n            'data:',\n            'blob:',\n            'market-assets.strapi.io',\n            'yourBucketName.s3.yourRegion.amazonaws.com',\n          ],\n          'media-src': [\n            \"'self'\",\n            'data:',\n            'blob:',\n            'market-assets.strapi.io',\n            'yourBucketName.s3.yourRegion.amazonaws.com',\n          ],\n          upgradeInsecureRequests: null,\n        },\n      },\n    },\n  },\n  // ...\n];\n")))))),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Before pushing the above changes to GitHub, add environment variables to the Strapi Cloud project to prevent triggering a rebuild and new deployment of the project before the changes are complete.")),(0,r.kt)("h3",{id:"strapi-cloud-configuration"},"Strapi Cloud Configuration"),(0,r.kt)("ol",null,(0,r.kt)("li",{parentName:"ol"},"Log into Strapi Cloud and click on the corresponding project on the Projects page."),(0,r.kt)("li",{parentName:"ol"},"Click on the ",(0,r.kt)("strong",{parentName:"li"},"Settings")," tab and choose ",(0,r.kt)("strong",{parentName:"li"},"Variables")," in the left menu."),(0,r.kt)("li",{parentName:"ol"},"Add the required environment variables specific to the upload provider."),(0,r.kt)("li",{parentName:"ol"},"Click ",(0,r.kt)("strong",{parentName:"li"},"Save"),".")),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"Example:")),(0,r.kt)(s,{groupId:"env-var",mdxType:"Tabs"},(0,r.kt)(c,{value:"cloudinary",label:"Cloudinary",mdxType:"TabItem"},(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Variable"),(0,r.kt)("th",{parentName:"tr",align:null},"Value"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"CLOUDINARY_NAME")),(0,r.kt)("td",{parentName:"tr",align:null},"your_cloudinary_name")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"CLOUDINARY_KEY")),(0,r.kt)("td",{parentName:"tr",align:null},"your_cloudinary_api_key")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"CLOUDINARY_SECRET")),(0,r.kt)("td",{parentName:"tr",align:null},"your_cloudinary_secret"))))),(0,r.kt)(c,{value:"amazon-s3",label:"Amazon S3",mdxType:"TabItem"},(0,r.kt)("table",null,(0,r.kt)("thead",{parentName:"table"},(0,r.kt)("tr",{parentName:"thead"},(0,r.kt)("th",{parentName:"tr",align:null},"Variable"),(0,r.kt)("th",{parentName:"tr",align:null},"Value"))),(0,r.kt)("tbody",{parentName:"table"},(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"AWS_ACCESS_KEY_ID")),(0,r.kt)("td",{parentName:"tr",align:null},"your_aws_access_key_id")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"AWS_ACCESS_SECRET")),(0,r.kt)("td",{parentName:"tr",align:null},"your_aws_access_secret")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"AWS_REGION")),(0,r.kt)("td",{parentName:"tr",align:null},"your_aws_region")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"AWS_BUCKET")),(0,r.kt)("td",{parentName:"tr",align:null},"your_aws_bucket")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"CDN_URL")),(0,r.kt)("td",{parentName:"tr",align:null},"your_cdn_url")),(0,r.kt)("tr",{parentName:"tbody"},(0,r.kt)("td",{parentName:"tr",align:null},(0,r.kt)("inlineCode",{parentName:"td"},"CDN_ROOT_PATH")),(0,r.kt)("td",{parentName:"tr",align:null},"your_cdn_root_path")))))),(0,r.kt)("h2",{id:"deployment"},"Deployment"),(0,r.kt)("p",null,"To deploy the project and utilize the third-party upload provider, push the changes from earlier. This will trigger a rebuild and new deployment of the Strapi Cloud project."),(0,r.kt)("p",null,"Once the application finishes building, the project will use the new upload provider."),(0,r.kt)("p",null,":::strapi Custom Provider\nIf you want to create a custom upload provider, please refer to the ",(0,r.kt)("a",{parentName:"p",href:"/dev-docs/providers#creating-providers"},"Providers")," documentation in the Developer Documentation.\n:::"))}g.isMDXComponent=!0}}]);