"use strict";(self.webpackChunkstrapi_docs=self.webpackChunkstrapi_docs||[]).push([[9143,1518,931],{3905:(e,t,n)=>{n.d(t,{Zo:()=>d,kt:()=>c});var a=n(67294);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,i=function(e,t){if(null==e)return{};var n,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},d=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},m=a.forwardRef((function(e,t){var n=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,d=l(e,["components","mdxType","originalType","parentName"]),m=p(n),c=i,g=m["".concat(s,".").concat(c)]||m[c]||u[c]||o;return n?a.createElement(g,r(r({ref:t},d),{},{components:n})):a.createElement(g,r({ref:t},d))}));function c(e,t){var n=arguments,i=t&&t.mdxType;if("string"==typeof e||i){var o=n.length,r=new Array(o);r[0]=m;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:i,r[1]=l;for(var p=2;p<o;p++)r[p]=n[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}m.displayName="MDXCreateElement"},1319:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>d,contentTitle:()=>s,default:()=>k,frontMatter:()=>l,metadata:()=>p,toc:()=>u});var a=n(83117),i=(n(67294),n(3905)),o=n(81322),r=n(61770);const l={title:"Migrate from 4.5.1+ to 4.6.1 - Strapi Developer Docs",description:"Learn how you can migrate your Strapi application from 4.5.1+ to 4.6.1.",displayed_sidebar:"devDocsSidebar"},s="v4.5.1+ to v4.6.1 migration guide",p={unversionedId:"dev-docs/migration/v4/migration-guide-4.5.1-to-4.6.1",id:"dev-docs/migration/v4/migration-guide-4.5.1-to-4.6.1",title:"Migrate from 4.5.1+ to 4.6.1 - Strapi Developer Docs",description:"Learn how you can migrate your Strapi application from 4.5.1+ to 4.6.1.",source:"@site/docs/dev-docs/migration/v4/migration-guide-4.5.1-to-4.6.1.md",sourceDirName:"dev-docs/migration/v4",slug:"/dev-docs/migration/v4/migration-guide-4.5.1-to-4.6.1",permalink:"/aberabook/dev-docs/migration/v4/migration-guide-4.5.1-to-4.6.1",draft:!1,editUrl:"https://github.com/labs-solo/aberabook/edit/main/docusaurus/docs/dev-docs/migration/v4/migration-guide-4.5.1-to-4.6.1.md",tags:[],version:"current",frontMatter:{title:"Migrate from 4.5.1+ to 4.6.1 - Strapi Developer Docs",description:"Learn how you can migrate your Strapi application from 4.5.1+ to 4.6.1.",displayed_sidebar:"devDocsSidebar"},sidebar:"devDocsSidebar"},d={},u=[{value:"Upgrading the application dependencies to 4.6.1",id:"upgrading-the-application-dependencies-to-461",level:2},{value:"Migrate Audit Log Tables (optional &amp; EE only)",id:"migrate-audit-log-tables-optional--ee-only",level:2},{value:"Changing the webhooks configuration (optional)",id:"changing-the-webhooks-configuration-optional",level:2},{value:"Updating the sizeLimit provider configuration",id:"updating-the-sizelimit-provider-configuration",level:2},{value:"Rebuild the application",id:"rebuild-the-application",level:2},{value:"Restart the application",id:"restart-the-application",level:2}],m=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,i.kt)("div",t)},c=m("Tabs"),g=m("TabItem"),b={toc:u};function k(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},b,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"v451-to-v461-migration-guide"},"v4.5.1+ to v4.6.1 migration guide"),(0,i.kt)("p",null,"The Strapi v4.5.1+ to v4.6.1 migration guide upgrades v4.5.1+ to v4.6.1. We introduced a configuration for webhooks to receive populated relations. Also, this migration guide is needed for all users who were limiting media size for the local upload provider."),(0,i.kt)("p",null,"The migration guide consists of:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Upgrading the application dependencies"),(0,i.kt)("li",{parentName:"ul"},"Changing the webhooks configuration (optional)"),(0,i.kt)("li",{parentName:"ul"},"Updating the local upload provider ",(0,i.kt)("inlineCode",{parentName:"li"},"sizeLimit")),(0,i.kt)("li",{parentName:"ul"},"Reinitializing the application")),(0,i.kt)("h2",{id:"upgrading-the-application-dependencies-to-461"},"Upgrading the application dependencies to 4.6.1"),(0,i.kt)("admonition",{type:"prerequisites"},(0,i.kt)("p",{parentName:"admonition"},"Stop the server before starting the upgrade.")),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Upgrade all of the Strapi packages in ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"4.6.1"),":"),(0,i.kt)("pre",{parentName:"li"},(0,i.kt)("code",{parentName:"pre",className:"language-json",metastring:'title="package.json"',title:'"package.json"'},'\n{\n  // ...\n  "dependencies": {\n    "@strapi/strapi": "4.6.1",\n    "@strapi/plugin-users-permissions": "4.6.1",\n    "@strapi/plugin-i18n": "4.6.1"\n    // ...\n  }\n}\n'))),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Save the edited ",(0,i.kt)("inlineCode",{parentName:"p"},"package.json")," file.")),(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},"Run either ",(0,i.kt)("inlineCode",{parentName:"p"},"yarn")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"npm install")," to install the new version."))),(0,i.kt)("admonition",{type:"tip"},(0,i.kt)("p",{parentName:"admonition"},"If the operation doesn't work, try removing your ",(0,i.kt)("inlineCode",{parentName:"p"},"yarn.lock")," or ",(0,i.kt)("inlineCode",{parentName:"p"},"package-lock.json"),". If that doesn't help, remove the ",(0,i.kt)("inlineCode",{parentName:"p"},"node_modules")," folder as well and try again.")),(0,i.kt)("h2",{id:"migrate-audit-log-tables-optional--ee-only"},"Migrate Audit Log Tables (optional & EE only)"),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"This specific section only applies to Strapi Enterprise customers or Cloud customers who have the Audit Logs feature enabled.")),(0,i.kt)("p",null,"If you updated to v4.6.0 originally and are now updating to v4.6.1 while being a Strapi Enterprise customer, there was a small breaking change with the table names for Audit Logs. This is only relevant if you are using the Audit Logs feature."),(0,i.kt)("p",null,"Between v4.6.0 and v4.6.1 the Audit log table names changed from ",(0,i.kt)("inlineCode",{parentName:"p"},"audit_logs")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"strapi_audit_logs")," and likewise the link table changed from ",(0,i.kt)("inlineCode",{parentName:"p"},"audit_logs_user_links")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"strapi_audit_logs_user_links"),"."),(0,i.kt)("p",null,"To migrate these tables properly without losing your audit log data:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"Make a backup of the database in case something unexpected happens."),(0,i.kt)("li",{parentName:"ol"},"In the ",(0,i.kt)("inlineCode",{parentName:"li"},"./database/migrations")," folder, create a file named: ",(0,i.kt)("inlineCode",{parentName:"li"},"2023.02.08T00.00.00.update-audit-logs-tables.js"),"."),(0,i.kt)("li",{parentName:"ol"},"Copy and paste the following code into the previously created file:")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js"},'const tables = {\n  auditLogs: {\n    fq: ["audit_logs_created_by_id_fk", "audit_logs_updated_by_id_fk"],\n    indexes: ["audit_logs_created_by_id_fk", "audit_logs_updated_by_id_fk"],\n    tableOld: "audit_logs",\n    tableNew: "strapi_audit_logs",\n  },\n  auditLogsUser: {\n    fq: ["audit_logs_user_links_fk", "audit_logs_user_links_inv_fk"],\n    indexes: ["audit_logs_user_links_fk", "audit_logs_user_links_inv_fk"],\n    tableOld: "audit_logs_user_links",\n    tableNew: "strapi_audit_logs_user_links",\n  },\n};\n\nmodule.exports = {\n  async up(knex) {\n    // Drop all of the schema entries we cache\n    await knex.from("strapi_database_schema").delete();\n\n    // Rename the auditLog table\n    if (await knex.schema.hasTable(tables.auditLogs.tableOld)) {\n      await knex.schema.renameTable(\n        tables.auditLogs.tableOld,\n        tables.auditLogs.tableNew\n      );\n    }\n\n    // Rename the auditLogUser table\n    if (await knex.schema.hasTable(tables.auditLogsUser.tableOld)) {\n      await knex.schema.renameTable(\n        tables.auditLogsUser.tableOld,\n        tables.auditLogsUser.tableNew\n      );\n    }\n\n    try {\n      // Drop the auditLog table fq and indexes\n      for (const fq of tables.auditLogs.fq) {\n        await knex.schema.alterTable(tables.auditLogs.tableNew, (table) => {\n          table.dropForeign([], fq);\n        });\n      }\n\n      for (const index of tables.auditLogs.indexes) {\n        await knex.schema.alterTable(tables.auditLogs.tableNew, (table) => {\n          table.dropIndex([], index);\n        });\n      }\n\n      // Drop the auditLogUser table fq and indexes\n      for (const fq of tables.auditLogsUser.fq) {\n        await knex.schema.alterTable(tables.auditLogsUser.tableNew, (table) => {\n          table.dropForeign([], fq);\n        });\n      }\n\n      for (const index of tables.auditLogsUser.indexes) {\n        await knex.schema.alterTable(tables.auditLogsUser.tableNew, (table) => {\n          table.dropIndex([], index);\n        });\n      }\n    } catch (e) {\n      console.log(e);\n    }\n  },\n};\n')),(0,i.kt)("ol",{start:5},(0,i.kt)("li",{parentName:"ol"},"Save the file.")),(0,i.kt)("h2",{id:"changing-the-webhooks-configuration-optional"},"Changing the webhooks configuration (optional)"),(0,i.kt)("p",null,"By default, and for backward compatibility reasons, webhooks will receive the entity with its relations populated again. We do recommend to disable this behavior if you were not using it, as it may cause performance issues when having many relations. If you need populated relations in your webhook, we recommend doing a separate query in your webhook listener to fetch the entity only with the necessary data."),(0,i.kt)("p",null,"If you want to change this behavior, you can do so by editing the ",(0,i.kt)("inlineCode",{parentName:"p"},"./config/server.js")," file (or ",(0,i.kt)("inlineCode",{parentName:"p"},"./config/server.ts")," if you are using TypeScript) and add the following configuration:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-jsx"},"'use strict';\n\nmodule.exports = ({ env }) => ({\n  host: env('HOST', '0.0.0.0'),\n  port: env.int('PORT', 1337),\n  url: 'http://localhost:1337',\n  webhooks: {\n    // Add this to not receive populated relations in webhooks\n    populateRelations: false,\n  },\n});\n")),(0,i.kt)("p",null,"With this, you will no longer receive populated relations in webhooks, and ",(0,i.kt)("strong",{parentName:"p"},"response times on the Content Manager will be shorter"),"."),(0,i.kt)("p",null,"You can see more of the available configuration options in the ",(0,i.kt)("a",{parentName:"p",href:"/dev-docs/configurations/server"},"server configuration documentation"),"."),(0,i.kt)("h2",{id:"updating-the-sizelimit-provider-configuration"},"Updating the sizeLimit provider configuration"),(0,i.kt)("p",null,"This step is only required if you were using the ",(0,i.kt)("a",{parentName:"p",href:"/dev-docs/plugins/upload#max-file-size"},(0,i.kt)("inlineCode",{parentName:"a"},"sizeLimit")," configuration")," for your upload provider."),(0,i.kt)("admonition",{type:"caution"},(0,i.kt)("p",{parentName:"admonition"},"The documentation required the ",(0,i.kt)("inlineCode",{parentName:"p"},"sizeLimit")," to be in bytes, but it was actually in kilobytes. This is now fixed, and the limit will be interpreted as bytes."),(0,i.kt)("p",{parentName:"admonition"},"If you, for some reason, were limiting the file size to kilobytes, you should update the value to be in bytes.")),(0,i.kt)("p",null,"We recommend to move the ",(0,i.kt)("inlineCode",{parentName:"p"},"sizeLimit")," outside the provider options like the following, as it will be deprecated in the next major version."),(0,i.kt)(c,{groupId:"js-ts",mdxType:"Tabs"},(0,i.kt)(g,{value:"js",label:"JavaScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="./config/plugins.js"',title:'"./config/plugins.js"'},"\nmodule.exports = {\n  // ...\n  upload: {\n    config: {\n      sizeLimit: 250 * 1024 * 1024, // Now\n      providerOptions: {\n        sizeLimit: 250 * 1024 * 1024 // Before\n      }\n    }\n  }\n};\n"))),(0,i.kt)(g,{value:"ts",label:"TypeScript",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="./config/plugins.ts"',title:'"./config/plugins.ts"'},"\nexport default {\n  // ...\n  upload: {\n    config: {\n      sizeLimit: 250 * 1024 * 1024, // Now\n      providerOptions: {\n        sizeLimit: 250 * 1024 * 1024 // Before\n      }\n    }\n  }\n};\n")))),(0,i.kt)("p",null,"To change the script:"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},"In the ",(0,i.kt)("inlineCode",{parentName:"li"},"./config/plugins.js")," file, identify the upload configuration if you have one."),(0,i.kt)("li",{parentName:"ol"},"(",(0,i.kt)("em",{parentName:"li"},"optional"),") If you have a ",(0,i.kt)("inlineCode",{parentName:"li"},"sizeLimit"),", move it one level above ",(0,i.kt)("inlineCode",{parentName:"li"},"providerOptions"),".")),(0,i.kt)("h2",{id:"rebuild-the-application"},"Rebuild the application"),(0,i.kt)(o.default,{components:n.components,mdxType:"BuildCommand"}),(0,i.kt)("h2",{id:"restart-the-application"},"Restart the application"),(0,i.kt)(r.default,{components:n.components,mdxType:"DevelopCommand"}))}k.isMDXComponent=!0},81322:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>g,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var a=n(83117),i=(n(67294),n(3905));const o={},r=void 0,l={unversionedId:"snippets/build-npm-yarn",id:"snippets/build-npm-yarn",title:"build-npm-yarn",description:"Run the following command in your project root directory to rebuild Strapi's admin panel:",source:"@site/docs/snippets/build-npm-yarn.md",sourceDirName:"snippets",slug:"/snippets/build-npm-yarn",permalink:"/aberabook/snippets/build-npm-yarn",draft:!1,editUrl:"https://github.com/labs-solo/aberabook/edit/main/docusaurus/docs/snippets/build-npm-yarn.md",tags:[],version:"current",frontMatter:{}},s={},p=[],d=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,i.kt)("div",t)},u=d("Tabs"),m=d("TabItem"),c={toc:p};function g(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Run the following command in your project root directory to rebuild Strapi's admin panel:"),(0,i.kt)(u,{groupId:"yarn-npm",mdxType:"Tabs"},(0,i.kt)(m,{value:"yarn",label:"yarn",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"yarn build\n"))),(0,i.kt)(m,{value:"npm",label:"npm",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"npm run build\n")))))}g.isMDXComponent=!0},61770:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>r,default:()=>g,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var a=n(83117),i=(n(67294),n(3905));const o={},r=void 0,l={unversionedId:"snippets/develop-npm-yarn",id:"snippets/develop-npm-yarn",title:"develop-npm-yarn",description:"Run the following command in your project root directory to restart the application:",source:"@site/docs/snippets/develop-npm-yarn.md",sourceDirName:"snippets",slug:"/snippets/develop-npm-yarn",permalink:"/aberabook/snippets/develop-npm-yarn",draft:!1,editUrl:"https://github.com/labs-solo/aberabook/edit/main/docusaurus/docs/snippets/develop-npm-yarn.md",tags:[],version:"current",frontMatter:{}},s={},p=[],d=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,i.kt)("div",t)},u=d("Tabs"),m=d("TabItem"),c={toc:p};function g(e){let{components:t,...n}=e;return(0,i.kt)("wrapper",(0,a.Z)({},c,n,{components:t,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Run the following command in your project root directory to restart the application:"),(0,i.kt)(u,{groupId:"yarn-npm",mdxType:"Tabs"},(0,i.kt)(m,{value:"yarn",label:"yarn",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"yarn develop\n"))),(0,i.kt)(m,{value:"npm",label:"npm",mdxType:"TabItem"},(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"npm run develop\n")))))}g.isMDXComponent=!0}}]);