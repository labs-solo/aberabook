"use strict";(self.webpackChunkstrapi_docs=self.webpackChunkstrapi_docs||[]).push([[1740,2642],{3905:(e,t,n)=>{n.d(t,{Zo:()=>u,kt:()=>c});var a=n(67294);function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){r(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,r=function(e,t){if(null==e)return{};var n,a,r={},o=Object.keys(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||(r[n]=e[n]);return r}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)n=o[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(r[n]=e[n])}return r}var s=a.createContext({}),p=function(e){var t=a.useContext(s),n=t;return e&&(n="function"==typeof e?e(t):i(i({},t),e)),n},u=function(e){var t=p(e.components);return a.createElement(s.Provider,{value:t},e.children)},m={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},d=a.forwardRef((function(e,t){var n=e.components,r=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=p(n),c=r,k=d["".concat(s,".").concat(c)]||d[c]||m[c]||o;return n?a.createElement(k,i(i({ref:t},u),{},{components:n})):a.createElement(k,i({ref:t},u))}));function c(e,t){var n=arguments,r=t&&t.mdxType;if("string"==typeof e||r){var o=n.length,i=new Array(o);i[0]=d;var l={};for(var s in t)hasOwnProperty.call(t,s)&&(l[s]=t[s]);l.originalType=e,l.mdxType="string"==typeof e?e:r,i[1]=l;for(var p=2;p<o;p++)i[p]=n[p];return a.createElement.apply(null,i)}return a.createElement.apply(null,n)}d.displayName="MDXCreateElement"},57430:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>p,contentTitle:()=>l,default:()=>g,frontMatter:()=>i,metadata:()=>s,toc:()=>u});var a=n(83117),r=(n(67294),n(3905)),o=n(14188);const i={title:"AWS Deployment",displayed_sidebar:"devDocsSidebar",description:"Learn in this guide how to deploy your Strapi application on AWS EC2, host your database on AWS RDS and upload your assets on AWS S3."},l="Amazon AWS",s={unversionedId:"dev-docs/deployment/amazon-aws",id:"dev-docs/deployment/amazon-aws",title:"AWS Deployment",description:"Learn in this guide how to deploy your Strapi application on AWS EC2, host your database on AWS RDS and upload your assets on AWS S3.",source:"@site/docs/dev-docs/deployment/amazon-aws.md",sourceDirName:"dev-docs/deployment",slug:"/dev-docs/deployment/amazon-aws",permalink:"/aberabook/dev-docs/deployment/amazon-aws",draft:!1,editUrl:"https://github.com/labs-solo/aberabook/edit/main/docusaurus/docs/dev-docs/deployment/amazon-aws.md",tags:[],version:"current",frontMatter:{title:"AWS Deployment",displayed_sidebar:"devDocsSidebar",description:"Learn in this guide how to deploy your Strapi application on AWS EC2, host your database on AWS RDS and upload your assets on AWS S3."},sidebar:"devDocsSidebar",previous:{title:"Hosting Guides",permalink:"/aberabook/dev-docs/deployment/hosting-guides"},next:{title:"Azure Deployment",permalink:"/aberabook/dev-docs/deployment/azure"}},p={},u=[{value:"Amazon AWS Install Requirements and creating an IAM non-root user",id:"amazon-aws-install-requirements-and-creating-an-iam-non-root-user",level:3},{value:"1. Follow these instructions for creating your Administrator IAM Admin User and Group",id:"1-follow-these-instructions-for-creating-your-administrator-iam-admin-user-and-group",level:4},{value:"2. Next, create a <strong>regular user</strong> for the creation and management of your Strapi project",id:"2-next-create-a-regular-user-for-the-creation-and-management-of-your-strapi-project",level:4},{value:"3. <code>Log into</code> your <strong>AWS Management Console</strong> as your <code>regular user</code>",id:"3-log-into-your-aws-management-console-as-your-regular-user",level:4},{value:"Additional IAM User Resources",id:"additional-iam-user-resources",level:4},{value:"Create your AWS VPC",id:"create-your-aws-vpc",level:3},{value:"1. From your <strong>AWS Management Console</strong> and as your <strong><em>regular</em></strong> user",id:"1-from-your-aws-management-console-and-as-your-regular-user",level:4},{value:"Launch an EC2 virtual machine",id:"launch-an-ec2-virtual-machine",level:3},{value:"1. From your <strong>AWS Management Console</strong> and as your <strong><em>regular</em></strong> user",id:"1-from-your-aws-management-console-and-as-your-regular-user-1",level:4},{value:"2. <strong>Select Appropriate Region</strong>",id:"2-select-appropriate-region-1",level:4},{value:"3. Click on the orange <code>Launch Instance</code> button",id:"3-click-on-the-orange-launch-instance-button",level:4},{value:"Install a PostgreSQL database on AWS RDS",id:"install-a-postgresql-database-on-aws-rds",level:3},{value:"1. Navigate to the <code>AWS RDS Service</code>",id:"1-navigate-to-the-aws-rds-service",level:4},{value:"2. Select your region",id:"2-select-your-region",level:4},{value:"3. Create the database",id:"3-create-the-database",level:4},{value:"Configure S3 for image hosting",id:"configure-s3-for-image-hosting",level:3},{value:"1. Navigate to the <code>Amazon S3</code>",id:"1-navigate-to-the-amazon-s3",level:4},{value:"2. Create the bucket",id:"2-create-the-bucket",level:4},{value:"Configure EC2 as a Node.js server",id:"configure-ec2-as-a-nodejs-server",level:3},{value:"1. Setup the <code>.pem</code> file",id:"1-setup-the-pem-file",level:4},{value:"2. Log in to your server as the default <code>ubuntu</code> user:",id:"2-log-in-to-your-server-as-the-default-ubuntu-user",level:4},{value:"3. Install <strong>Node.js</strong> with <strong>npm</strong>:",id:"3-install-nodejs-with-npm",level:4},{value:"4. Create and change npm&#39;s default directory.",id:"4-create-and-change-npms-default-directory",level:4},{value:"Install and Configure Git versioning on your server",id:"install-and-configure-git-versioning-on-your-server",level:3},{value:"1. Check to see if <code>Git</code> is installed",id:"1-check-to-see-if-git-is-installed",level:4},{value:"2. <strong>OPTIONAL:</strong> Install Git.",id:"2-optional-install-git",level:4},{value:"3. Configure the global <strong>username</strong> and <strong>email</strong> settings: Setting up Git - Your Identity",id:"3-configure-the-global-username-and-email-settings-setting-up-git---your-identity",level:4},{value:"Prepare and clone Strapi project to server",id:"prepare-and-clone-strapi-project-to-server",level:3},{value:"1. Install <code>pg</code> in your Strapi project.",id:"1-install-pg-in-your-strapi-project",level:4},{value:"2. Edit the <code>./config/database.js</code> file.",id:"2-edit-the-configdatabasejs-file",level:4},{value:"3. Install the <strong>Strapi AWS S3 Upload Provider</strong>:",id:"3-install-the-strapi-aws-s3-upload-provider",level:4},{value:"4. Push your local changes to your project&#39;s GitHub repository",id:"4-push-your-local-changes-to-your-projects-github-repository",level:4},{value:"5. Deploy from GitHub",id:"5-deploy-from-github",level:4},{value:"6. Install <strong>PM2 Runtime</strong>",id:"6-install-pm2-runtime",level:4},{value:"7. Configure <strong>PM2 Runtime</strong> to launch project on system startup.",id:"7-configure-pm2-runtime-to-launch-project-on-system-startup",level:4},{value:"Create you first Administrator user",id:"create-you-first-administrator-user",level:3},{value:"1. Locate your <code>IPv4 Public IP</code>",id:"1-locate-your-ipv4-public-ip",level:4},{value:"2. Next, create your <strong>Administrator</strong> user, and login to Strapi",id:"2-next-create-your-administrator-user-and-login-to-strapi",level:4},{value:"Set up a webhook",id:"set-up-a-webhook",level:3},{value:"Further steps to take",id:"further-steps-to-take",level:3}],m=e=>function(t){return console.warn("Component "+e+" was not imported, exported, or provided by MDXProvider as global scope"),(0,r.kt)("div",t)},d=m("Tabs"),c=m("TabItem"),k={toc:u};function g(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},k,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"amazon-aws"},"Amazon AWS"),(0,r.kt)("p",null,"This is a step-by-step guide for deploying a Strapi project to ",(0,r.kt)("a",{parentName:"p",href:"https://aws.amazon.com/ec2/"},"Amazon AWS EC2")," inside your ",(0,r.kt)("a",{parentName:"p",href:"https://aws.amazon.com/vpc/"},"AWS VPC"),". This guide will connect to an ",(0,r.kt)("a",{parentName:"p",href:"https://aws.amazon.com/rds/"},"Amazon AWS RDS")," for managing and hosting the database. Optionally, this guide will show you how to connect host and serve images on ",(0,r.kt)("a",{parentName:"p",href:"https://aws.amazon.com/s3/"},"Amazon AWS S3"),"."),(0,r.kt)("admonition",{type:"prerequisites"},(0,r.kt)("ul",{parentName:"admonition"},(0,r.kt)("li",{parentName:"ul"},"You have created a ",(0,r.kt)("a",{parentName:"li",href:"/dev-docs/quick-start"},"Strapi project"),", to use for deploying on AWS."),(0,r.kt)("li",{parentName:"ul"},"You have read through the ",(0,r.kt)("a",{parentName:"li",href:"/dev-docs/deployment#application-configuration"},"configuration")," section."))),(0,r.kt)(o.default,{mdxType:"ConsiderStrapiCloud"}),(0,r.kt)("h3",{id:"amazon-aws-install-requirements-and-creating-an-iam-non-root-user"},"Amazon AWS Install Requirements and creating an IAM non-root user"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"You must have an ",(0,r.kt)("a",{parentName:"li",href:"https://aws.amazon.com/free"},"Amazon AWS")," account before doing these steps.")),(0,r.kt)("p",null,"Best practices for using ",(0,r.kt)("strong",{parentName:"p"},"AWS Amazon")," services state to not use your root account user and to use instead the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/introduction.html"},"IAM (AWS Identity and Access Management) service"),". Your root user is therefore only used for a very few ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/general/latest/gr/aws_tasks-that-require-root.html"},"select tasks"),". For example, for ",(0,r.kt)("strong",{parentName:"p"},"billing"),", you create an ",(0,r.kt)("strong",{parentName:"p"},"Administrator user and Group")," for such things. And other, more routine tasks are done with a ",(0,r.kt)("strong",{parentName:"p"},"regular IAM User"),"."),(0,r.kt)("h4",{id:"1-follow-these-instructions-for-creating-your-administrator-iam-admin-user-and-group"},"1. Follow these instructions for ",(0,r.kt)("a",{parentName:"h4",href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/getting-started_create-admin-group.html"},"creating your Administrator IAM Admin User and Group")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Login as ",(0,r.kt)("strong",{parentName:"li"},"root"),"."),(0,r.kt)("li",{parentName:"ul"},"Create ",(0,r.kt)("strong",{parentName:"li"},"Administrator")," role.")),(0,r.kt)("h4",{id:"2-next-create-a-regular-user-for-the-creation-and-management-of-your-strapi-project"},"2. Next, create a ",(0,r.kt)("strong",{parentName:"h4"},"regular user")," for the creation and management of your Strapi project"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Copy your ",(0,r.kt)("strong",{parentName:"li"},"IAM Users sign-in link")," found here: ",(0,r.kt)("a",{parentName:"li",href:"https://console.aws.amazon.com/iam/home"},"IAM Console")," and then log out of your ",(0,r.kt)("strong",{parentName:"li"},"root user")," and log in to your ",(0,r.kt)("strong",{parentName:"li"},"administrator")," user you just created."),(0,r.kt)("li",{parentName:"ul"},"Return to the IAM Console by ",(0,r.kt)("inlineCode",{parentName:"li"},"searching for IAM")," and clicking or going here: ",(0,r.kt)("a",{parentName:"li",href:"https://console.aws.amazon.com/iam/home"},"IAM Console"),"."),(0,r.kt)("li",{parentName:"ul"},"Click on ",(0,r.kt)("inlineCode",{parentName:"li"},"Users"),", in the left hand menu, and then click ",(0,r.kt)("inlineCode",{parentName:"li"},"Add User"),":",(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"In the ",(0,r.kt)("strong",{parentName:"li"},"Set user details")," screen:")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Provide a ",(0,r.kt)("strong",{parentName:"li"},"User name"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Access Type"),": Check both ",(0,r.kt)("inlineCode",{parentName:"li"},"Programmatic access")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"AWS Management Console access"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Autogenerate a password")," or click ",(0,r.kt)("inlineCode",{parentName:"li"},"Custom password")," and provide one."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"OPTIONAL:")," For simplicity, ",(0,r.kt)("inlineCode",{parentName:"li"},"uncheck")," the ",(0,r.kt)("strong",{parentName:"li"},"Require password reset"),"."),(0,r.kt)("li",{parentName:"ul"},"Click ",(0,r.kt)("inlineCode",{parentName:"li"},"Next: Permissions"),".")),(0,r.kt)("ol",{parentName:"li",start:2},(0,r.kt)("li",{parentName:"ol"},"In the ",(0,r.kt)("strong",{parentName:"li"},"Set Permissions")," screen, do the following:")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Click ",(0,r.kt)("inlineCode",{parentName:"li"},"Create group"),", name it, e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"Developers"),", and then choose appropriate policies under ",(0,r.kt)("strong",{parentName:"li"},"Policy Name"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"search for ",(0,r.kt)("inlineCode",{parentName:"li"},"ec2")," and check ",(0,r.kt)("inlineCode",{parentName:"li"},"AmazonEC2FullAccess")),(0,r.kt)("li",{parentName:"ul"},"search for ",(0,r.kt)("inlineCode",{parentName:"li"},"RDS")," and check ",(0,r.kt)("inlineCode",{parentName:"li"},"AmazonRDSFullAccess")),(0,r.kt)("li",{parentName:"ul"},"search for ",(0,r.kt)("inlineCode",{parentName:"li"},"s3")," and check ",(0,r.kt)("inlineCode",{parentName:"li"},"AmazonS3FullAccess")),(0,r.kt)("li",{parentName:"ul"},"search for ",(0,r.kt)("inlineCode",{parentName:"li"},"vpc")," and check ",(0,r.kt)("inlineCode",{parentName:"li"},"AmazonVPCFullAccess")),(0,r.kt)("li",{parentName:"ul"},"Click ",(0,r.kt)("inlineCode",{parentName:"li"},"Create group")))),(0,r.kt)("li",{parentName:"ul"},"Click to ",(0,r.kt)("inlineCode",{parentName:"li"},"Add user to group")," and check the ",(0,r.kt)("inlineCode",{parentName:"li"},"Developers")," group, to add the new user."),(0,r.kt)("li",{parentName:"ul"},"Click ",(0,r.kt)("inlineCode",{parentName:"li"},"Next: Tags"),".")),(0,r.kt)("ol",{parentName:"li",start:3},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Add tags")," (optional)")),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"This step is ",(0,r.kt)("strong",{parentName:"li"},"optional")," and based on your workflow and project scope."),(0,r.kt)("li",{parentName:"ul"},"Click ",(0,r.kt)("inlineCode",{parentName:"li"},"Next: Review"),".")),(0,r.kt)("ol",{parentName:"li",start:4},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Review"))),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Review the information and ensure it is correct. Use ",(0,r.kt)("inlineCode",{parentName:"li"},"Previous")," to correct anything."),(0,r.kt)("li",{parentName:"ul"},"Click ",(0,r.kt)("inlineCode",{parentName:"li"},"Create user"),".")),(0,r.kt)("ol",{parentName:"li",start:5},(0,r.kt)("li",{parentName:"ol"},(0,r.kt)("strong",{parentName:"li"},"Success")," - These are very ",(0,r.kt)("strong",{parentName:"li"},"IMPORTANT CREDENTIALS"),(0,r.kt)("em",{parentName:"li"},"If you do not do these steps you will have to reset your ",(0,r.kt)("inlineCode",{parentName:"em"},"Access key ID")," and ",(0,r.kt)("inlineCode",{parentName:"em"},"Secret access key")," later."))),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Download the .csv file")," and store it in a safe place. This contains the user name, login link, Access key ID and Secret access key."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"OPTIONAL:")," Add these credentials to your ","*","Password manager","*","*","."),(0,r.kt)("li",{parentName:"ul"},"Click on the ",(0,r.kt)("inlineCode",{parentName:"li"},"AWS Management Console Access sign-in link"),". This will log you out of ",(0,r.kt)("inlineCode",{parentName:"li"},"Administrator"),".")))),(0,r.kt)("h4",{id:"3-log-into-your-aws-management-console-as-your-regular-user"},"3. ",(0,r.kt)("inlineCode",{parentName:"h4"},"Log into")," your ",(0,r.kt)("strong",{parentName:"h4"},"AWS Management Console")," as your ",(0,r.kt)("inlineCode",{parentName:"h4"},"regular user")),(0,r.kt)("p",null,"You may now proceed to the next steps."),(0,r.kt)("h4",{id:"additional-iam-user-resources"},"Additional IAM User Resources"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/best-practices.html"},"IAM Best Practices"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("a",{parentName:"li",href:"https://docs.aws.amazon.com/IAM/latest/UserGuide/id_credentials_access-keys.html"},"Instructions to reset Access key ID and Secret access key"),".")),(0,r.kt)("h3",{id:"create-your-aws-vpc"},"Create your AWS VPC"),(0,r.kt)("p",null," A VPC is an isolated portion of the AWS Cloud populated by AWS objects, such as Amazon EC2 instances. A VPC is logically isolated from other virtual networks in the AWS Cloud. You can launch your AWS resources, such as Amazon EC2 instances, into your VPC. You can specify an IP address range for the VPC, add subnets, associate security groups, and configure route tables."),(0,r.kt)("h4",{id:"1-from-your-aws-management-console-and-as-your-regular-user"},"1. From your ",(0,r.kt)("strong",{parentName:"h4"},"AWS Management Console")," and as your ",(0,r.kt)("strong",{parentName:"h4"},(0,r.kt)("em",{parentName:"strong"},"regular"))," user"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Find Services"),", search for ",(0,r.kt)("inlineCode",{parentName:"p"},"VPC")," and click on ",(0,r.kt)("inlineCode",{parentName:"p"},"EC2, Isolated Cloud Resources")),(0,r.kt)("h4",{parentName:"li",id:"2-select-appropriate-region"},"2. ",(0,r.kt)("strong",{parentName:"h4"},"Select Appropriate Region")),(0,r.kt)("p",{parentName:"li"},"In the top menu, near your IAM Account User name, select, from the dropdown, the most appropriate region to host your Strapi project. For example, ",(0,r.kt)("inlineCode",{parentName:"p"},"US East (N.Virginia)")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"Asia Pacific (Hong Kong)"),". You will want to remember this region for configuring other services on AWS and serving these services from the same region."),(0,r.kt)("h4",{parentName:"li",id:"3-click-on-the-orange-create-vpc-button"},"3. Click on the orange ",(0,r.kt)("inlineCode",{parentName:"h4"},"Create VPC")," button")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Select")," ",(0,r.kt)("strong",{parentName:"p"},"VPC and More"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Select")," ",(0,r.kt)("strong",{parentName:"p"},"Auto-generate nametags"),". Add a suitable name, e.g. ",(0,r.kt)("inlineCode",{parentName:"p"},"strapi-vpc"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Leave")," ",(0,r.kt)("strong",{parentName:"p"},"IPv4 CIDR block")," as ",(0,r.kt)("strong",{parentName:"p"},"10.0.0.0/16")," (unless you have a specific reason to change it).")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Leave")," ",(0,r.kt)("strong",{parentName:"p"},"Tenancy")," as ",(0,r.kt)("strong",{parentName:"p"},"Default"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Select")," ",(0,r.kt)("strong",{parentName:"p"},"2")," for ",(0,r.kt)("strong",{parentName:"p"},"Number of Availability Zones (AZs)"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Select")," ",(0,r.kt)("strong",{parentName:"p"},"2")," for ",(0,r.kt)("strong",{parentName:"p"},"Number of Public Subnets"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Select")," ",(0,r.kt)("strong",{parentName:"p"},"2")," for ",(0,r.kt)("strong",{parentName:"p"},"Number of Private Subnets"))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Select")," ",(0,r.kt)("strong",{parentName:"p"},"0")," for ",(0,r.kt)("strong",{parentName:"p"},"NAT gateways"),".\n::: tip\nIf you know that you will need to scale your project, you can increase the number of subnets and NAT gateways. For example, if you are expecting a large number of users, you may want to increase the number of private subnets and NAT gateways. For more information, see ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/vpc/latest/userguide/VPC_Subnets.html#vpc-sizing-ipv4"},"VPC and Subnet Sizing"),".\n:::")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Select")," ",(0,r.kt)("strong",{parentName:"p"},"S3 Gateway")," for ",(0,r.kt)("strong",{parentName:"p"},"VPC Endpoints"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Check")," ",(0,r.kt)("strong",{parentName:"p"},"Enable DNS hostnames")," and ",(0,r.kt)("strong",{parentName:"p"},"Enable DNS resolution"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},(0,r.kt)("inlineCode",{parentName:"p"},"Select")," ",(0,r.kt)("strong",{parentName:"p"},"Create VPC"),"."))),(0,r.kt)("h3",{id:"launch-an-ec2-virtual-machine"},"Launch an EC2 virtual machine"),(0,r.kt)("p",null,"Amazon calls a virtual private server, a ",(0,r.kt)("strong",{parentName:"p"},"virtual server")," or ",(0,r.kt)("strong",{parentName:"p"},"Amazon EC2 instance"),". To use this service you will ",(0,r.kt)("inlineCode",{parentName:"p"},"Launch Instance"),". In this section, you will ",(0,r.kt)("strong",{parentName:"p"},"establish IAM credentials"),", ",(0,r.kt)("strong",{parentName:"p"},"launch a new instance")," and ",(0,r.kt)("strong",{parentName:"p"},"set-up primary security rules"),"."),(0,r.kt)("h4",{id:"1-from-your-aws-management-console-and-as-your-regular-user-1"},"1. From your ",(0,r.kt)("strong",{parentName:"h4"},"AWS Management Console")," and as your ",(0,r.kt)("strong",{parentName:"h4"},(0,r.kt)("em",{parentName:"strong"},"regular"))," user"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Find Services"),", search for ",(0,r.kt)("inlineCode",{parentName:"li"},"ec2")," and click on ",(0,r.kt)("inlineCode",{parentName:"li"},"EC2, Virtual Servers in the Cloud"))),(0,r.kt)("h4",{id:"2-select-appropriate-region-1"},"2. ",(0,r.kt)("strong",{parentName:"h4"},"Select Appropriate Region")),(0,r.kt)("p",null,"In the top menu, near your IAM Account User name, select, from the dropdown, the most appropriate region to host your Strapi project. For example, ",(0,r.kt)("inlineCode",{parentName:"p"},"US East (N.Virginia)")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"Asia Pacific (Hong Kong)"),". You will want to remember this region for configuring other services on AWS and serving these services from the same region."),(0,r.kt)("h4",{id:"3-click-on-the-orange-launch-instance-button"},"3. Click on the orange ",(0,r.kt)("inlineCode",{parentName:"h4"},"Launch Instance")," button"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Select")," ",(0,r.kt)("strong",{parentName:"li"},"Ubuntu Server 22.04 LTS (HVM), SSD Volume Type")),(0,r.kt)("li",{parentName:"ul"},"Ensure ",(0,r.kt)("inlineCode",{parentName:"li"},"General purpose")," + ",(0,r.kt)("inlineCode",{parentName:"li"},"t2.small")," is ",(0,r.kt)("inlineCode",{parentName:"li"},"checked"),".",(0,r.kt)("admonition",{parentName:"li",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("inlineCode",{parentName:"p"},"t2.small")," is the smallest instance type in which Strapi runs. ",(0,r.kt)("inlineCode",{parentName:"p"},"t2.nano")," and ",(0,r.kt)("inlineCode",{parentName:"p"},"t2.micro")," ",(0,r.kt)("strong",{parentName:"p"},"DO NOT")," work. At the moment, deploying the Strapi Admin interface requires more than 1g of RAM. Therefore, ",(0,r.kt)("strong",{parentName:"p"},"t2.small")," or larger instance is needed.")),"::: tip\nMake sure you are creating the instance in the correct VPC. You should choose a public subnet otherwise you will not be able to access the instance.\n:::"),(0,r.kt)("li",{parentName:"ul"},"Click the grey ",(0,r.kt)("inlineCode",{parentName:"li"},"Next: Configure Instance Details")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"Next: Add Storage")),(0,r.kt)("li",{parentName:"ul"},"In the ",(0,r.kt)("strong",{parentName:"li"},"Step 4: Add Storage")," verify the ",(0,r.kt)("inlineCode",{parentName:"li"},"General Purpose SSD (gp2)"),", then click ",(0,r.kt)("inlineCode",{parentName:"li"},"Next: Add tags"),"."),(0,r.kt)("li",{parentName:"ul"},"In the ",(0,r.kt)("strong",{parentName:"li"},"Step 5: Add Tags"),", add tags to suit your project or leave blank, then click ",(0,r.kt)("inlineCode",{parentName:"li"},"Next: Configure Security Group"),"."),(0,r.kt)("li",{parentName:"ul"},"In the ",(0,r.kt)("strong",{parentName:"li"},"Step 6: Configure Security Group"),", configure the ",(0,r.kt)("inlineCode",{parentName:"li"},"security settings")," as follows:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Assign a security group:")," Check as ",(0,r.kt)("inlineCode",{parentName:"li"},"Create a new security group")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Security group name:")," Name it, e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"strapi")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Description:")," Write a short description, e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"strapi instance security settings")),(0,r.kt)("li",{parentName:"ul"},"You should have a rule: ",(0,r.kt)("strong",{parentName:"li"},"Type:")," ",(0,r.kt)("inlineCode",{parentName:"li"},"SSH"),", ",(0,r.kt)("strong",{parentName:"li"},"Protocol:")," ",(0,r.kt)("inlineCode",{parentName:"li"},"TCP"),", ",(0,r.kt)("strong",{parentName:"li"},"Port Range")," ",(0,r.kt)("inlineCode",{parentName:"li"},"22"),", ",(0,r.kt)("strong",{parentName:"li"},"Source:")," ",(0,r.kt)("inlineCode",{parentName:"li"},"0.0.0.0/0")," (all IP addresses). If not, add it."),(0,r.kt)("li",{parentName:"ul"},"Click the grey ",(0,r.kt)("inlineCode",{parentName:"li"},"Add rule")," to add each of these rules:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Type:")," ",(0,r.kt)("inlineCode",{parentName:"li"},"SSH"),", ",(0,r.kt)("strong",{parentName:"li"},"Protocol:")," ",(0,r.kt)("inlineCode",{parentName:"li"},"TCP"),", ",(0,r.kt)("strong",{parentName:"li"},"Port Range")," ",(0,r.kt)("inlineCode",{parentName:"li"},"22"),", ",(0,r.kt)("strong",{parentName:"li"},"Source:")," ",(0,r.kt)("inlineCode",{parentName:"li"},"::/0")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Type:")," ",(0,r.kt)("inlineCode",{parentName:"li"},"HTTP"),", ",(0,r.kt)("strong",{parentName:"li"},"Protocol:")," ",(0,r.kt)("inlineCode",{parentName:"li"},"TCP"),", ",(0,r.kt)("strong",{parentName:"li"},"Port Range")," ",(0,r.kt)("inlineCode",{parentName:"li"},"80"),", ",(0,r.kt)("strong",{parentName:"li"},"Source:")," ",(0,r.kt)("inlineCode",{parentName:"li"},"0.0.0.0/0, ::/0")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Type:")," ",(0,r.kt)("inlineCode",{parentName:"li"},"HTTPS"),", ",(0,r.kt)("strong",{parentName:"li"},"Protocol:")," ",(0,r.kt)("inlineCode",{parentName:"li"},"TCP"),", ",(0,r.kt)("strong",{parentName:"li"},"Port Range")," ",(0,r.kt)("inlineCode",{parentName:"li"},"443"),", ",(0,r.kt)("strong",{parentName:"li"},"Source:")," ",(0,r.kt)("inlineCode",{parentName:"li"},"0.0.0.0/0, ::/0")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Type:")," ",(0,r.kt)("inlineCode",{parentName:"li"},"Custom TCP Rule"),", ",(0,r.kt)("strong",{parentName:"li"},"Protocol:")," ",(0,r.kt)("inlineCode",{parentName:"li"},"TCP"),", ",(0,r.kt)("strong",{parentName:"li"},"Port Range")," ",(0,r.kt)("inlineCode",{parentName:"li"},"1337"),", ",(0,r.kt)("strong",{parentName:"li"},"Source:")," ",(0,r.kt)("inlineCode",{parentName:"li"},"0.0.0.0/0")," ",(0,r.kt)("strong",{parentName:"li"},"Description:")," ",(0,r.kt)("inlineCode",{parentName:"li"},"Strapi for Testing Port"),"\nThese rules are basic configuration and security rules. You may want to tighten and limit these rules based on your own project and organizational policies.",(0,r.kt)("admonition",{parentName:"li",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"After setting up your Nginx rules and domain name with the proper aliases, you will need to delete the rule regarding port 1337 as this is for testing and setting up the project - ",(0,r.kt)("strong",{parentName:"p"},"not for production"),"."))))))),(0,r.kt)("li",{parentName:"ul"},"Click the blue ",(0,r.kt)("inlineCode",{parentName:"li"},"Review and Launch")," button."),(0,r.kt)("li",{parentName:"ul"},"Review the details, in the ",(0,r.kt)("strong",{parentName:"li"},"Step 7: Review Instance Launch"),", then click the blue ",(0,r.kt)("inlineCode",{parentName:"li"},"Launch")," button. Now, you need to ",(0,r.kt)("strong",{parentName:"li"},"select an existing key pair")," or ",(0,r.kt)("strong",{parentName:"li"},"create a new key pair"),". To create a new key pair, do the following:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Select the dropdown option ",(0,r.kt)("inlineCode",{parentName:"li"},"Create a new key pair"),"."),(0,r.kt)("li",{parentName:"ul"},"Name your the key pair name, e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"ec2-strapi-key-pair"),(0,r.kt)("admonition",{parentName:"li",type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Download the ",(0,r.kt)("strong",{parentName:"p"},"private key file")," (.pem file). This file is needed, so note where it was downloaded."))),(0,r.kt)("li",{parentName:"ul"},"After downloading the file, click the blue ",(0,r.kt)("inlineCode",{parentName:"li"},"Launch Instances")," button.")))),(0,r.kt)("p",null,"Your instance is now running. Continue to the next steps."),(0,r.kt)("h3",{id:"install-a-postgresql-database-on-aws-rds"},"Install a PostgreSQL database on AWS RDS"),(0,r.kt)("p",null,"Amazon calls their database hosting services ",(0,r.kt)("strong",{parentName:"p"},"RDS"),". Multiple database options exist and are available. In this guide, ",(0,r.kt)("strong",{parentName:"p"},"PostgreSQL")," is used as the example, and the steps are similar for each of the other database that are supported by Strapi. (",(0,r.kt)("strong",{parentName:"p"},"MySQL"),", ",(0,r.kt)("strong",{parentName:"p"},"PostgreSQL"),", ",(0,r.kt)("strong",{parentName:"p"},"MariaDB"),", ",(0,r.kt)("strong",{parentName:"p"},"SQLite"),"). You will set-up an ",(0,r.kt)("strong",{parentName:"p"},"RDS instance")," to host your ",(0,r.kt)("inlineCode",{parentName:"p"},"postgresql")," database."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},(0,r.kt)("strong",{parentName:"p"},"Amazon RDS")," does ",(0,r.kt)("strong",{parentName:"p"},"NOT")," have a completely free evaluation tier. After finishing this guide, if you are only testing, please remember to ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/AmazonRDS/latest/UserGuide/USER_DeleteInstance.html"},"delete the database"),". Otherwise, you will incur charges.")),(0,r.kt)("h4",{id:"1-navigate-to-the-aws-rds-service"},"1. Navigate to the ",(0,r.kt)("inlineCode",{parentName:"h4"},"AWS RDS Service")),(0,r.kt)("p",null,"In the top menu, click on ",(0,r.kt)("inlineCode",{parentName:"p"},"Services")," and do a search for ",(0,r.kt)("inlineCode",{parentName:"p"},"rds"),", click on ",(0,r.kt)("inlineCode",{parentName:"p"},"RDS, Managed Relational Database Service"),"."),(0,r.kt)("h4",{id:"2-select-your-region"},"2. Select your region"),(0,r.kt)("p",null,"In the top menu bar, select the region that is the same as the EC2 instance, e.g. ",(0,r.kt)("inlineCode",{parentName:"p"},"EU (Paris)")," or ",(0,r.kt)("inlineCode",{parentName:"p"},"US East (N. Virgina)"),"."),(0,r.kt)("h4",{id:"3-create-the-database"},"3. Create the database"),(0,r.kt)("p",null,"Click the orange ",(0,r.kt)("inlineCode",{parentName:"p"},"Create database")," button.\nFollow these steps to complete installation of a ",(0,r.kt)("inlineCode",{parentName:"p"},"PostgreSQL")," database:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Engine Options:")," Click on ",(0,r.kt)("inlineCode",{parentName:"li"},"PostgreSQL"),", version ",(0,r.kt)("strong",{parentName:"li"},"PostgreSQL 10.x-R1")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Templates:")," Click on ",(0,r.kt)("inlineCode",{parentName:"li"},"Free Tier"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Settings"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"DB instance identifier")," Give a name to your database, e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"strapi-database")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Credential Settings"),": This is your ",(0,r.kt)("inlineCode",{parentName:"li"},"psql")," database ",(0,r.kt)("em",{parentName:"li"},"username")," and ",(0,r.kt)("em",{parentName:"li"},"password"),".",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Master username:")," Keep as ",(0,r.kt)("inlineCode",{parentName:"li"},"postgres"),", or change (optional)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Uncheck")," ",(0,r.kt)("em",{parentName:"li"},"Auto generate a password"),", and then type in a new secret password."))))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Connectivity"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Connect to an EC2 compute instance")," Click on the ",(0,r.kt)("inlineCode",{parentName:"li"},"Instace")," dropdown, and select the EC2 instance you created earlier."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"OPTIONAL:")," Review any further options (",(0,r.kt)("strong",{parentName:"li"},"DB Instance size"),", ",(0,r.kt)("strong",{parentName:"li"},"Storage"),", ",(0,r.kt)("strong",{parentName:"li"},"Connectivity"),"), and modify to your project needs."),(0,r.kt)("li",{parentName:"ul"},"You need to give you Database a name. Under ",(0,r.kt)("strong",{parentName:"li"},"Additional configuration"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Additional configuration"),", and then ",(0,r.kt)("strong",{parentName:"li"},"Initial database name:")," Give your database a name, e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"strapi"),"."))),(0,r.kt)("li",{parentName:"ul"},"Review the rest of the options and click the orange, ",(0,r.kt)("inlineCode",{parentName:"li"},"Create database")," button.")),(0,r.kt)("p",null,"After a few minutes, you may refresh your page and see that your database has been successfully created."),(0,r.kt)("h3",{id:"configure-s3-for-image-hosting"},"Configure S3 for image hosting"),(0,r.kt)("p",null,"Amazon calls cloud storage services ",(0,r.kt)("strong",{parentName:"p"},"S3"),". You create a ",(0,r.kt)("strong",{parentName:"p"},"bucket"),", which holds the files, images, folders, etc... which then can be accessed and served by your application. This guide will show you how to use ",(0,r.kt)("strong",{parentName:"p"},"Amazon S3")," to host the images for your project."),(0,r.kt)("h4",{id:"1-navigate-to-the-amazon-s3"},"1. Navigate to the ",(0,r.kt)("inlineCode",{parentName:"h4"},"Amazon S3")),(0,r.kt)("p",null,"In the top menu, click on ",(0,r.kt)("inlineCode",{parentName:"p"},"Services")," and do a search for ",(0,r.kt)("inlineCode",{parentName:"p"},"s3"),", click on ",(0,r.kt)("inlineCode",{parentName:"p"},"Scalable storage in the cloud"),"."),(0,r.kt)("h4",{id:"2-create-the-bucket"},"2. Create the bucket"),(0,r.kt)("p",null,"Click on the blue ",(0,r.kt)("inlineCode",{parentName:"p"},"Create bucket")," button:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Give your bucket a unique name, under ",(0,r.kt)("strong",{parentName:"li"},"Bucket name"),", e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"my-project-name-images"),"."),(0,r.kt)("li",{parentName:"ul"},"Select the most appropriate region, under ",(0,r.kt)("strong",{parentName:"li"},"Region"),", e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"EU (Paris)")," or ",(0,r.kt)("inlineCode",{parentName:"li"},"US East (N. Virgina)"),"."),(0,r.kt)("li",{parentName:"ul"},"Click ",(0,r.kt)("inlineCode",{parentName:"li"},"Next"),"."),(0,r.kt)("li",{parentName:"ul"},"Configure any appropriate options for your project in the ",(0,r.kt)("strong",{parentName:"li"},"Configure Options")," page, and click ",(0,r.kt)("inlineCode",{parentName:"li"},"next"),"."),(0,r.kt)("li",{parentName:"ul"},"Under ",(0,r.kt)("strong",{parentName:"li"},"Block public access"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Uncheck ",(0,r.kt)("inlineCode",{parentName:"li"},"Block all public access")," and set the permissions as follows:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Uncheck")," Block new public ACLs and uploading public objects (Recommended)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Uncheck")," Block public access to buckets and objects granted through any access control lists (ACLs)"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Check")," Block public access to buckets and objects granted through new public bucket policies"),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"Check")," Block public and cross-account access to buckets and objects through any public bucket policies"))),(0,r.kt)("li",{parentName:"ul"},"Select ",(0,r.kt)("inlineCode",{parentName:"li"},"Do not grant Amazon S3 Log Delivery group write access to this bucket"),"."))),(0,r.kt)("li",{parentName:"ul"},"Click ",(0,r.kt)("inlineCode",{parentName:"li"},"Next"),"."),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"Review")," and click ",(0,r.kt)("inlineCode",{parentName:"li"},"Create bucket"),".")),(0,r.kt)("h3",{id:"configure-ec2-as-a-nodejs-server"},"Configure EC2 as a Node.js server"),(0,r.kt)("p",null,"You will set-up your EC2 server as a Node.js server. Including basic configuration and Git."),(0,r.kt)("p",null,"You will need your ",(0,r.kt)("strong",{parentName:"p"},"EC2")," ip address:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"In the ",(0,r.kt)("inlineCode",{parentName:"li"},"AWS Console"),", navigate to the ",(0,r.kt)("inlineCode",{parentName:"li"},"AWS EC2"),". In the top menu, click on ",(0,r.kt)("inlineCode",{parentName:"li"},"Services")," and do a search for ",(0,r.kt)("inlineCode",{parentName:"li"},"ec2"),", click on ",(0,r.kt)("inlineCode",{parentName:"li"},"Virtual Servers in the cloud"),"."),(0,r.kt)("li",{parentName:"ul"},"Click on ",(0,r.kt)("inlineCode",{parentName:"li"},"1 Running Instance")," and note the ",(0,r.kt)("inlineCode",{parentName:"li"},"IPv4 Public OP")," address. E.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"1.2.3.4"),".")),(0,r.kt)("h4",{id:"1-setup-the-pem-file"},"1. Setup the ",(0,r.kt)("inlineCode",{parentName:"h4"},".pem")," file"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"You downloaded, in a previous step, your ",(0,r.kt)("inlineCode",{parentName:"li"},"User")," .pem file. e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"ec2-strapi-key-pair.pem"),". This needs to be included in each attempt to ",(0,r.kt)("inlineCode",{parentName:"li"},"SSH")," into your ",(0,r.kt)("inlineCode",{parentName:"li"},"EC2 server"),". Move your ",(0,r.kt)("inlineCode",{parentName:"li"},".pem")," file to ",(0,r.kt)("inlineCode",{parentName:"li"},"~/.ssh/"),", follow these steps:"),(0,r.kt)("li",{parentName:"ul"},"On your local machine, navigate to the folder that contains your .pem file. e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"downloads")),(0,r.kt)("li",{parentName:"ul"},"Move the .pem file to ",(0,r.kt)("inlineCode",{parentName:"li"},"~/.ssh/")," and set file permissions:\n",(0,r.kt)("inlineCode",{parentName:"li"},"Path:./path-to/.pem-file/"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"mv ec2-strapi-key-pair.pem ~/.ssh/\nchmod 400 ~/.ssh/ec2-strapi-key-pair.pem\n")),(0,r.kt)("h4",{id:"2-log-in-to-your-server-as-the-default-ubuntu-user"},"2. Log in to your server as the default ",(0,r.kt)("inlineCode",{parentName:"h4"},"ubuntu")," user:"),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"In the future, each time you log into your ",(0,r.kt)("inlineCode",{parentName:"p"},"EC2")," server, you will need to add the path to the .pem file and add the IP address for your EC2 instance at the end, e.g. ",(0,r.kt)("inlineCode",{parentName:"p"},"ssh -i ~/.ssh/ec2-strapi-key-pair.pem ubuntu@1.2.3.4"),".")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},'ssh -i ~/.ssh/ec2-strapi-key-pair.pem ubuntu@1.2.3.4\n\nWelcome to Ubuntu 22.04.2 LTS (GNU/Linux 4.15.0-1032-aws x86_64)\n\n...\n\nTo run a command as administrator (user "root"), use "sudo <command>".\nSee "man sudo_root" for details.\n\nubuntu@ip-1.2.3.4:~$\n\n')),(0,r.kt)("h4",{id:"3-install-nodejs-with-npm"},"3. Install ",(0,r.kt)("strong",{parentName:"h4"},"Node.js")," with ",(0,r.kt)("strong",{parentName:"h4"},"npm"),":"),(0,r.kt)("p",null,"The following steps will install Node.js onto your EC2 server."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash",metastring:'title="example using Node.js 20"',title:'"example',using:!0,"Node.js":!0,'20"':!0},"cd ~\nsudo apt-get update\n...\nsudo apt-get install -y ca-certificates curl gnupg\n...\nsudo mkdir -p /etc/apt/keyrings\ncurl -fsSL https://deb.nodesource.com/gpgkey/nodesource-repo.gpg.key | sudo gpg --dearmor -o /etc/apt/keyrings/nodesource.gpg\nNODE_MAJOR=20\nsudo apt-get update\n...\nsudo apt-get install nodejs -y\n...\nnode -v && npm -v\n")),(0,r.kt)("p",null,"The last command ",(0,r.kt)("inlineCode",{parentName:"p"},"node -v && npm -v")," should output two versions numbers, eg. ",(0,r.kt)("inlineCode",{parentName:"p"},"v20.x.x, 6.x.x"),"."),(0,r.kt)("h4",{id:"4-create-and-change-npms-default-directory"},"4. Create and change npm's default directory."),(0,r.kt)("p",null,"The following steps are based on ",(0,r.kt)("a",{parentName:"p",href:"https://docs.npmjs.com/resolving-eacces-permissions-errors-when-installing-packages-globally"},"how to resolve access permissions from npmjs.com"),":"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Create a ",(0,r.kt)("inlineCode",{parentName:"li"},".npm-global")," directory and set the path to this directory for ",(0,r.kt)("inlineCode",{parentName:"li"},"node_modules"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd ~\nmkdir ~/.npm-global\nnpm config set prefix '~/.npm-global'\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Create (or modify) a ",(0,r.kt)("inlineCode",{parentName:"li"},"~/.profile")," file:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo nano ~/.profile\n")),(0,r.kt)("p",null,"Add these lines at the bottom of the ",(0,r.kt)("inlineCode",{parentName:"p"},"~/.profile")," file."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ini"},"# set PATH so global node modules install without permission issues\nexport PATH=~/.npm-global/bin:$PATH\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Lastly, update your system variables:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"source ~/.profile\n")),(0,r.kt)("p",null,"You are now ready to continue to the next section."),(0,r.kt)("h3",{id:"install-and-configure-git-versioning-on-your-server"},"Install and Configure Git versioning on your server"),(0,r.kt)("p",null,"A convenient way to maintain your Strapi application and update it during and after initial development is to use ",(0,r.kt)("a",{parentName:"p",href:"https://git-scm.com/book/en/v2/Getting-Started-About-Version-Control"},"Git"),". In order to use Git, you will need to have it installed on your EC2 instance. EC2 instances should have Git installed by default, so you will first check if it is installed and if it is not installed, you will need to install it."),(0,r.kt)("p",null,"The next step is to configure Git on your server."),(0,r.kt)("h4",{id:"1-check-to-see-if-git-is-installed"},"1. Check to see if ",(0,r.kt)("inlineCode",{parentName:"h4"},"Git")," is installed"),(0,r.kt)("p",null,"If you see a ",(0,r.kt)("inlineCode",{parentName:"p"},"git version 2.x.x")," then you do have ",(0,r.kt)("inlineCode",{parentName:"p"},"Git")," installed. Check with the following command:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"git --version\n")),(0,r.kt)("h4",{id:"2-optional-install-git"},"2. ",(0,r.kt)("strong",{parentName:"h4"},"OPTIONAL:")," Install Git."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Only do if ",(0,r.kt)("em",{parentName:"p"},"not installed"),", as above. Please follow these directions on ",(0,r.kt)("a",{parentName:"p",href:"https://git-scm.com/book/en/v2/Getting-Started-Installing-Git"},"how to install Git on Ubuntu 22.04"),".")),(0,r.kt)("h4",{id:"3-configure-the-global-username-and-email-settings-setting-up-git---your-identity"},"3. Configure the global ",(0,r.kt)("strong",{parentName:"h4"},"username")," and ",(0,r.kt)("strong",{parentName:"h4"},"email")," settings: ",(0,r.kt)("a",{parentName:"h4",href:"https://git-scm.com/book/en/v2/Getting-Started-First-Time-Git-Setup"},"Setting up Git - Your Identity")),(0,r.kt)("p",null,"After installing and configuring Git on your EC2 instance. Please continue to the next step."),(0,r.kt)("h3",{id:"prepare-and-clone-strapi-project-to-server"},"Prepare and clone Strapi project to server"),(0,r.kt)("p",null,"These instructions assume that you have already created a ",(0,r.kt)("strong",{parentName:"p"},"Strapi")," project, and have it in a ",(0,r.kt)("strong",{parentName:"p"},"GitHub")," repository."),(0,r.kt)("p",null,"You will need to update the ",(0,r.kt)("inlineCode",{parentName:"p"},"database.json")," file to configure Strapi to connect to the ",(0,r.kt)("inlineCode",{parentName:"p"},"RDS")," database. And you will need to install an npm package called ",(0,r.kt)("inlineCode",{parentName:"p"},"pg")," locally on your development server."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"The ",(0,r.kt)("inlineCode",{parentName:"p"},"pg")," package install is only necessary if you are using ",(0,r.kt)("strong",{parentName:"p"},"PostgresSQL")," as your database. Make sure to uninstall the sqlite3 package if you changed your database to PostgresSQL.")),(0,r.kt)("h4",{id:"1-install-pg-in-your-strapi-project"},"1. Install ",(0,r.kt)("inlineCode",{parentName:"h4"},"pg")," in your Strapi project."),(0,r.kt)("p",null,"On your development machine, navigate to your Strapi project root directory:\n",(0,r.kt)("inlineCode",{parentName:"p"},"Path: ./my-project/")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm install pg\n")),(0,r.kt)("h4",{id:"2-edit-the-configdatabasejs-file"},"2. Edit the ",(0,r.kt)("inlineCode",{parentName:"h4"},"./config/database.js")," file."),(0,r.kt)("p",null,"Copy/paste the following:"),(0,r.kt)(d,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(c,{value:"javascript",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js",metastring:'title="path: ./my-project/config/database.js"',title:'"path:','./my-project/config/database.js"':!0},'\nmodule.exports = ({ env }) => ({\n  connection: {\n    client: "postgres",\n    connection: {\n      host: env("DATABASE_HOST", "127.0.0.1"),\n      port: env.int("DATABASE_PORT", 5432),\n      database: env("DATABASE_NAME", "strapi"),\n      user: env("DATABASE_USERNAME", ""),\n      password: env("DATABASE_PASSWORD", ""),\n    },\n    useNullAsDefault: true,\n  },\n});\n'))),(0,r.kt)(c,{value:"typescript",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts",metastring:'title="path: ./my-project/config/database.ts"',title:'"path:','./my-project/config/database.ts"':!0},'\nexport default ({ env }) => ({\n  connection: {\n    client: "postgres",\n    connection: {\n      host: env("DATABASE_HOST", "127.0.0.1"),\n      port: env.int("DATABASE_PORT", 5432),\n      database: env("DATABASE_NAME", "strapi"),\n      user: env("DATABASE_USERNAME", ""),\n      password: env("DATABASE_PASSWORD", ""),\n    },\n    useNullAsDefault: true,\n  },\n});\n')))),(0,r.kt)("h4",{id:"3-install-the-strapi-aws-s3-upload-provider"},"3. Install the ",(0,r.kt)("strong",{parentName:"h4"},"Strapi AWS S3 Upload Provider"),":"),(0,r.kt)("p",null,"Path: ",(0,r.kt)("inlineCode",{parentName:"p"},"./my-project/"),"."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm install @strapi/provider-upload-aws-s3\n")),(0,r.kt)("p",null,"To enable and configure the provider, create or edit the file at ",(0,r.kt)("inlineCode",{parentName:"p"},"./config/plugins.js"),"."),(0,r.kt)(d,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(c,{value:"javascript",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = ({ env }) => ({\n  upload: {\n    config: {\n      provider: 'aws-s3',\n      providerOptions: {\n        s3Options: {\n          accessKeyId: env('AWS_ACCESS_KEY_ID'),\n          secretAccessKey: env('AWS_ACCESS_SECRET'),\n          region: env('AWS_REGION'),\n          params: {\n            Bucket: env('AWS_BUCKET_NAME'),\n          },\n        }\n      },\n      // These parameters could solve issues with ACL public-read access \u2014 see [this issue](https://github.com/strapi/strapi/issues/5868) for details\n      actionOptions: {\n        upload: {\n          ACL: null\n        },\n        uploadStream: {\n          ACL: null\n        },\n      }\n    },\n  }\n});\n"))),(0,r.kt)(c,{value:"typescript",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"export default ({ env }) => ({\n  upload: {\n      config: {\n          provider: 'aws-s3',\n          providerOptions: {\n              s3Options: {\n                  accessKeyId: env('AWS_ACCESS_KEY_ID'),\n                  secretAccessKey: env('AWS_ACCESS_SECRET'),\n                  region: env('AWS_REGION'),\n                  params: {\n                    Bucket: env('AWS_BUCKET_NAME'),\n                  },\n              }\n          },\n      },\n  }\n});\n")))),(0,r.kt)("p",null,"See the documentation about using an upload provider ",(0,r.kt)("a",{parentName:"p",href:"/dev-docs/providers"},"here"),"."),(0,r.kt)("h4",{id:"4-push-your-local-changes-to-your-projects-github-repository"},"4. Push your local changes to your project's GitHub repository"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"git add .\ngit commit -m 'Installed pg, aws-S3 upload provider and updated the config files'\ngit push\n")),(0,r.kt)("h4",{id:"5-deploy-from-github"},"5. Deploy from GitHub"),(0,r.kt)("p",null,"You will next deploy your Strapi project to your EC2 instance by ",(0,r.kt)("strong",{parentName:"p"},"cloning it from GitHub"),"."),(0,r.kt)("admonition",{type:"note"},(0,r.kt)("p",{parentName:"admonition"},"Cloning a GitHub repository requires a personal access token. See the ",(0,r.kt)("a",{parentName:"p",href:"https://docs.github.com/en/authentication/keeping-your-account-and-data-secure/creating-a-personal-access-token"},"GitHub documentation")," for how to generate and use a personal access token.")),(0,r.kt)("p",null,"From your terminal and logged into your EC2 instance as the ",(0,r.kt)("inlineCode",{parentName:"p"},"ubuntu")," user:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd ~\ngit clone https://github.com/your-name/your-project-repo.git\n")),(0,r.kt)("p",null,"Next, navigate to the ",(0,r.kt)("inlineCode",{parentName:"p"},"my-project")," folder, the root for Strapi. You will need to run ",(0,r.kt)("inlineCode",{parentName:"p"},"npm install")," to install the packages for your project. Make sure to uninstall the sqlite3 package if you changed your database to PostgresSQL."),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"Path: ./my-project/")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd ./my-project/\nnpm install\nNODE_ENV=production npm run build\n")),(0,r.kt)("p",null,"Next, you need to install ",(0,r.kt)("strong",{parentName:"p"},"PM2 Runtime")," and configure the ",(0,r.kt)("inlineCode",{parentName:"p"},"ecosystem.config.js")," file"),(0,r.kt)("h4",{id:"6-install-pm2-runtime"},"6. Install ",(0,r.kt)("strong",{parentName:"h4"},"PM2 Runtime")),(0,r.kt)("p",null,(0,r.kt)("a",{parentName:"p",href:"https://pm2.keymetrics.io"},"PM2 Runtime")," allows you to keep your Strapi project alive and to reload it without downtime."),(0,r.kt)("p",null,"Ensure you are logged in as a ",(0,r.kt)("strong",{parentName:"p"},"non-root")," user. You will install ",(0,r.kt)("strong",{parentName:"p"},"PM2")," globally:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"npm install pm2@latest -g\n")),(0,r.kt)("p",null,"Now, you will need to configure an ",(0,r.kt)("inlineCode",{parentName:"p"},"ecosystem.config.js")," file. This file will set ",(0,r.kt)("inlineCode",{parentName:"p"},"env")," variables that connect Strapi to your database. It will also be used to restart your project whenever any changes are made to files within the Strapi file system itself (such as when an update arrived from Github). You can read more about this file ",(0,r.kt)("a",{parentName:"p",href:"https://pm2.keymetrics.io/docs/usage/application-declaration/"},"here"),"."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"You will need to open your ",(0,r.kt)("inlineCode",{parentName:"li"},"nano")," editor and then ",(0,r.kt)("inlineCode",{parentName:"li"},"copy/paste")," the following:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd ~\npm2 init\nsudo nano ecosystem.config.js\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Next, replace the boilerplate content in the file, with the following:")),(0,r.kt)(d,{groupId:"js-ts",mdxType:"Tabs"},(0,r.kt)(c,{value:"javascript",label:"JavaScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"module.exports = {\n  apps: [\n    {\n      name: 'your-app-name', // Your project name\n      cwd: '/home/ubuntu/my-project', // Path to your project\n      script: 'npm', // For this example we're using npm, could also be yarn\n      args: 'start', // Script to start the Strapi server, `start` by default\n      env: {\n        APP_KEYS: 'your app keys', // you can find it in your project .env file.\n        API_TOKEN_SALT: 'your api token salt',\n        ADMIN_JWT_SECRET: 'your admin jwt secret',\n        JWT_SECRET: 'your jwt secret',\n        NODE_ENV: 'production',\n        DATABASE_HOST: 'your-unique-url.rds.amazonaws.com', // database Endpoint under 'Connectivity & Security' tab\n        DATABASE_PORT: '5432',\n        DATABASE_NAME: 'strapi', // DB name under 'Configuration' tab\n        DATABASE_USERNAME: 'postgres', // default username\n        DATABASE_PASSWORD: 'Password',\n        AWS_ACCESS_KEY_ID: 'aws-access-key-id',\n        AWS_ACCESS_SECRET: 'aws-access-secret', // Find it in Amazon S3 Dashboard\n        AWS_REGION: 'aws-region',\n        AWS_BUCKET_NAME: 'my-project-bucket-name',\n      },\n    },\n  ],\n};\n"))),(0,r.kt)(c,{value:"typescript",label:"TypeScript",mdxType:"TabItem"},(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-ts"},"export default {\n  apps: [\n    {\n      name: 'your-app-name',\n      cwd: '/home/ubuntu/my-project',\n      script: 'npm',\n      args: 'start',\n      env: {\n        NODE_ENV: 'production',\n        DATABASE_HOST: 'your-unique-url.rds.amazonaws.com', // database Endpoint under 'Connectivity & Security' tab\n        DATABASE_PORT: '5432',\n        DATABASE_NAME: 'strapi', // DB name under 'Configuration' tab\n        DATABASE_USERNAME: 'postgres', // default username\n        DATABASE_PASSWORD: 'Password',\n        AWS_ACCESS_KEY_ID: 'aws-access-key-id',\n        AWS_ACCESS_SECRET: 'aws-access-secret', // Find it in Amazon S3 Dashboard\n        AWS_REGION: 'aws-region',\n        AWS_BUCKET_NAME: 'my-project-bucket-name',\n      },\n    },\n  ],\n};\n\n")))),(0,r.kt)("p",null,"You can also set your environment variables in a ",(0,r.kt)("inlineCode",{parentName:"p"},".env")," file in your project like so:"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre"},"DATABASE_HOST=your-unique-url.rds.amazonaws.com\nDATABASE_PORT=5432\nDATABASE_NAME=strapi\nDATABASE_USERNAME=postgres\nDATABASE_PASSWORD=Password\nAWS_ACCESS_KEY_ID=aws-access-key-id\nAWS_ACCESS_SECRET=aws-access-secret\nAWS_REGION=aws-region\nAWS_BUCKET_NAME=my-project-bucket-name\n")),(0,r.kt)("p",null,"We recommend you continue setting the ",(0,r.kt)("inlineCode",{parentName:"p"},"NODE_ENV")," variable in the ",(0,r.kt)("inlineCode",{parentName:"p"},"ecosystem.config.js")," file."),(0,r.kt)("p",null,"Use the following command to start ",(0,r.kt)("inlineCode",{parentName:"p"},"pm2"),":"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd ~\npm2 start ecosystem.config.js\n")),(0,r.kt)("p",null,"Your Strapi project should now be available on ",(0,r.kt)("inlineCode",{parentName:"p"},"http://your-ip-address:1337/"),". Your IP address will be the one corresponding to your Ubuntu server."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"Earlier, ",(0,r.kt)("inlineCode",{parentName:"p"},"Port 1337")," was allowed access for ",(0,r.kt)("strong",{parentName:"p"},"testing and setup")," purposes. After setting up ",(0,r.kt)("strong",{parentName:"p"},"NGINX"),", the ",(0,r.kt)("strong",{parentName:"p"},"Port 1337")," needs to have access ",(0,r.kt)("strong",{parentName:"p"},"denied"),".")),(0,r.kt)("h4",{id:"7-configure-pm2-runtime-to-launch-project-on-system-startup"},"7. Configure ",(0,r.kt)("strong",{parentName:"h4"},"PM2 Runtime")," to launch project on system startup."),(0,r.kt)("p",null,"Follow the steps below to have your app launch on system startup."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"These steps are based on the ",(0,r.kt)("a",{parentName:"p",href:"https://pm2.keymetrics.io/docs/usage/startup/#startup-script-generator"},"PM2 Runtime Startup Guide"),".")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Generate and configure a startup script to launch PM2, it will generate a Startup Script to copy/paste, do so:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ cd ~\n$ pm2 startup systemd\n\n[PM2] Init System found: systemd\n[PM2] To setup the Startup Script, copy/paste the following command:\nsudo env PATH=$PATH:/usr/bin /usr/lib/node_modules/pm2/bin/pm2 startup systemd -u your-name --hp /home/your-name\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Copy/paste the generated command:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"$ sudo env PATH=$PATH:/usr/bin /usr/lib/node_modules/pm2/bin/pm2 startup systemd -u your-name --hp /home/your-name\n\n[PM2] Init System found: systemd\nPlatform systemd\n\n. . .\n\n\n[PM2] [v] Command successfully executed.\n+---------------------------------------+\n[PM2] Freeze a process list on reboot via:\n   $ pm2 save\n\n[PM2] Remove init script via:\n   $ pm2 unstartup systemd\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Next, ",(0,r.kt)("inlineCode",{parentName:"li"},"Save")," the new PM2 process list and environment.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"pm2 save\n\n[PM2] Saving current process list...\n[PM2] Successfully saved in /home/your-name/.pm2/dump.pm2\n\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("strong",{parentName:"li"},"OPTIONAL"),": You can test to see if the script above works whenever your system reboots with the ",(0,r.kt)("inlineCode",{parentName:"li"},"sudo reboot")," command. You will need to login again with your ",(0,r.kt)("strong",{parentName:"li"},"non-root user")," and then run ",(0,r.kt)("inlineCode",{parentName:"li"},"pm2 list")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"systemctl status pm2-ubuntu")," to verify everything is working.")),(0,r.kt)("h3",{id:"create-you-first-administrator-user"},"Create you first Administrator user"),(0,r.kt)("p",null,"The next steps will create an Administrator user on the strapi AWS instance."),(0,r.kt)("h4",{id:"1-locate-your-ipv4-public-ip"},"1. Locate your ",(0,r.kt)("inlineCode",{parentName:"h4"},"IPv4 Public IP")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Login as your regular user to your ",(0,r.kt)("inlineCode",{parentName:"li"},"EC2 Dashboard")),(0,r.kt)("li",{parentName:"ul"},"Click on ",(0,r.kt)("inlineCode",{parentName:"li"},"1 Running Instances"),"."),(0,r.kt)("li",{parentName:"ul"},"Below, in the ",(0,r.kt)("strong",{parentName:"li"},"Description")," tab, locate your ",(0,r.kt)("strong",{parentName:"li"},"IPv4 Public IP"))),(0,r.kt)("h4",{id:"2-next-create-your-administrator-user-and-login-to-strapi"},"2. Next, create your ",(0,r.kt)("strong",{parentName:"h4"},"Administrator")," user, and login to Strapi"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Go to ",(0,r.kt)("inlineCode",{parentName:"li"},"http://your-ip-address:1337/admin")),(0,r.kt)("li",{parentName:"ul"},"Complete the registration form."),(0,r.kt)("li",{parentName:"ul"},"Click ",(0,r.kt)("inlineCode",{parentName:"li"},"Ready to Start"))),(0,r.kt)("h3",{id:"set-up-a-webhook"},"Set up a webhook"),(0,r.kt)("p",null,"Providing that your project is set-up on GitHub, you will need to configure your ",(0,r.kt)("strong",{parentName:"p"},"Strapi Project Repository")," with a webhook. The following article provides additional information to the steps below: ",(0,r.kt)("a",{parentName:"p",href:"https://developer.github.com/webhooks/creating/"},"GitHub Creating Webhooks Guide"),"."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"You need to access the ",(0,r.kt)("inlineCode",{parentName:"p"},"Settings")," tab for your ",(0,r.kt)("inlineCode",{parentName:"p"},"Strapi Project Repository"),":"),(0,r.kt)("ol",{parentName:"li"},(0,r.kt)("li",{parentName:"ol"},"Navigate and click to ",(0,r.kt)("inlineCode",{parentName:"li"},"Settings")," for your repository."),(0,r.kt)("li",{parentName:"ol"},"Click on ",(0,r.kt)("inlineCode",{parentName:"li"},"Webhooks"),", then click ",(0,r.kt)("inlineCode",{parentName:"li"},"Add Webhook"),"."),(0,r.kt)("li",{parentName:"ol"},"The fields are filled out like this:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Payload URL: Enter ",(0,r.kt)("inlineCode",{parentName:"li"},"http://your-ip-address:8080")),(0,r.kt)("li",{parentName:"ul"},"Content type: Select ",(0,r.kt)("inlineCode",{parentName:"li"},"application/json")),(0,r.kt)("li",{parentName:"ul"},"Which events would you like to trigger this webhook: Select ",(0,r.kt)("inlineCode",{parentName:"li"},"Just the push event")),(0,r.kt)("li",{parentName:"ul"},"Secret: Enter ",(0,r.kt)("inlineCode",{parentName:"li"},"YourSecret")),(0,r.kt)("li",{parentName:"ul"},"Active: Select the checkbox"))),(0,r.kt)("li",{parentName:"ol"},"Review the fields and click ",(0,r.kt)("inlineCode",{parentName:"li"},"Add Webhook"),"."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Next, you need to create a ",(0,r.kt)("inlineCode",{parentName:"p"},"Webhook Script")," on your server. These commands create a new file called ",(0,r.kt)("inlineCode",{parentName:"p"},"webhook.js")," which will hold two variables:"))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd ~\nmkdir NodeWebHooks\ncd NodeWebHooks\nsudo nano webhook.js\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"In the ",(0,r.kt)("inlineCode",{parentName:"li"},"nano")," editor, copy/paste the following script, but make sure to replace ",(0,r.kt)("inlineCode",{parentName:"li"},"your_secret_key")," and ",(0,r.kt)("inlineCode",{parentName:"li"},"repo")," with the values that correspond to your project, then save and exit.")),(0,r.kt)("p",null,"(This script creates a variable called ",(0,r.kt)("inlineCode",{parentName:"p"},"PM2_CMD")," which is used after pulling from GitHub to update your project. The script first changes to the home directory and then runs the variable ",(0,r.kt)("inlineCode",{parentName:"p"},"PM2_CMD")," as ",(0,r.kt)("inlineCode",{parentName:"p"},"pm2 restart strapi"),". The project uses the ",(0,r.kt)("inlineCode",{parentName:"p"},"ecosystem.config.js")," as the point of starting your application.)"),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-js"},"var secret = 'your_secret_key'; // Your secret key from Settings in GitHub\nvar repo = '~/path-to-strapi-root-folder/'; // path to the root of your Strapi project on server\n\nconst http = require('http');\nconst crypto = require('crypto');\nconst exec = require('child_process').exec;\n\nconst PM2_CMD = 'cd ~ && pm2 startOrRestart ecosystem.config.js';\n\nhttp\n  .createServer(function(req, res) {\n    req.on('data', function(chunk) {\n      let sig =\n        'sha1=' +\n        crypto\n          .createHmac('sha1', secret)\n          .update(chunk.toString())\n          .digest('hex');\n\n      if (req.headers['x-hub-signature'] == sig) {\n        exec(`cd ${repo} && git pull && NODE_ENV=production npm run build && ${PM2_CMD}`, (error, stdout, stderr) => {\n          if (error) {\n            console.error(`exec error: ${error}`);\n            return;\n          }\n          console.log(`stdout: ${stdout}`);\n          console.log(`stderr: ${stderr}`);\n        });\n      }\n    });\n\n    res.end();\n  })\n  .listen(8080);\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Allow the port to communicate with outside web traffic for ",(0,r.kt)("inlineCode",{parentName:"li"},"port 8080"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Within your ",(0,r.kt)("strong",{parentName:"li"},"AWS EC2")," dashboard:",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"In the left hand menu, click on ",(0,r.kt)("inlineCode",{parentName:"li"},"Security Groups"),","),(0,r.kt)("li",{parentName:"ul"},"Select with the checkbox, the correct ",(0,r.kt)("inlineCode",{parentName:"li"},"Group Name"),", e.g. ",(0,r.kt)("inlineCode",{parentName:"li"},"strapi"),","),(0,r.kt)("li",{parentName:"ul"},"At the bottom of the screen, in the ",(0,r.kt)("strong",{parentName:"li"},"Inbound")," tab, click ",(0,r.kt)("inlineCode",{parentName:"li"},"Edit"),", and then ",(0,r.kt)("inlineCode",{parentName:"li"},"Add Rule"),":",(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Type: ",(0,r.kt)("inlineCode",{parentName:"li"},"Custom TCP")),(0,r.kt)("li",{parentName:"ul"},"Protocol: ",(0,r.kt)("inlineCode",{parentName:"li"},"TCP")),(0,r.kt)("li",{parentName:"ul"},"Port Range: ",(0,r.kt)("inlineCode",{parentName:"li"},"8080")),(0,r.kt)("li",{parentName:"ul"},"Source: ",(0,r.kt)("inlineCode",{parentName:"li"},"Custom")," ",(0,r.kt)("inlineCode",{parentName:"li"},"0.0.0.0/0, ::/0")))),(0,r.kt)("li",{parentName:"ul"},"Then ",(0,r.kt)("inlineCode",{parentName:"li"},"Save")))),(0,r.kt)("li",{parentName:"ul"},"If the ",(0,r.kt)("inlineCode",{parentName:"li"},"ufw")," firewall is enabled, configure settings to include ",(0,r.kt)("inlineCode",{parentName:"li"},"port 8080")," by running the following command:")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo ufw allow 8080/tcp\n")),(0,r.kt)("p",null,"Earlier you setup ",(0,r.kt)("inlineCode",{parentName:"p"},"pm2")," to start the services (your ",(0,r.kt)("strong",{parentName:"p"},"Strapi project"),") whenever the ",(0,r.kt)("strong",{parentName:"p"},"EC2 instance")," reboots or is started. You will now do the same for the ",(0,r.kt)("inlineCode",{parentName:"p"},"webhook")," script."),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Install the webhook as a ",(0,r.kt)("inlineCode",{parentName:"p"},"Systemd")," service"),(0,r.kt)("ul",{parentName:"li"},(0,r.kt)("li",{parentName:"ul"},"Run ",(0,r.kt)("inlineCode",{parentName:"li"},"echo $PATH")," and copy the output for use in the next step.")))),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"cd ~\necho $PATH\n\n/home/your-name/.npm-global/bin:/home/your-name/bin:/home/your-name/.local/bin:/usr/local/sbin:/usr/local/bin:/usr/sbin:/usr/bin:/sbin:/bin:/usr/games:/usr/local/games:/snap/bin\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Create a ",(0,r.kt)("inlineCode",{parentName:"li"},"webhook.service")," file:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo nano /etc/systemd/system/webhook.service\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"In the ",(0,r.kt)("inlineCode",{parentName:"li"},"nano")," editor, copy/paste the following script, but make sure to replace ",(0,r.kt)("inlineCode",{parentName:"li"},"ubuntu")," ",(0,r.kt)("strong",{parentName:"li"},"in two places")," if you changed the default ",(0,r.kt)("inlineCode",{parentName:"li"},"ubuntu")," user, and ",(0,r.kt)("inlineCode",{parentName:"li"},"paste the $PATH")," from above.")),(0,r.kt)("admonition",{type:"caution"},(0,r.kt)("p",{parentName:"admonition"},"Delete the #comments before saving, then save and exit.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"[Unit]\nDescription=Github webhook\nAfter=network.target\n\n[Service]\nEnvironment=PATH=/PASTE-PATH_HERE #path from echo $PATH (as above)\nType=simple\nUser=ubuntu #replace with your name, if changed from default ubuntu user\nExecStart=/usr/bin/node /home/ubuntu/NodeWebHooks/webhook.js #replace with your name, if changed from default ubuntu user\nRestart=on-failure\n\n[Install]\nWantedBy=multi-user.target\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Enable and start the new service so it starts when the system boots:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl enable webhook.service\nsudo systemctl start webhook\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"Check the status of the webhook:")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-bash"},"sudo systemctl status webhook\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"You may test your ",(0,r.kt)("strong",{parentName:"li"},"webhook")," by following the instructions ",(0,r.kt)("a",{parentName:"li",href:"https://www.digitalocean.com/community/tutorials/how-to-use-node-js-and-github-webhooks-to-keep-remote-projects-in-sync#step-4-testing-the-webhook"},"here"),".")),(0,r.kt)("h3",{id:"further-steps-to-take"},"Further steps to take"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"You can ",(0,r.kt)("strong",{parentName:"p"},"add a domain name")," or ",(0,r.kt)("strong",{parentName:"p"},"use a subdomain name")," for your Strapi project, you will need to ",(0,r.kt)("a",{parentName:"p",href:"https://docs.nginx.com/nginx/admin-guide/installing-nginx/installing-nginx-open-source/"},"install NGINX")," and ",(0,r.kt)("a",{parentName:"p",href:"https://docs.aws.amazon.com/elasticbeanstalk/latest/dg/nodejs-platform-proxy.html"},"configure it"),"."),(0,r.kt)("admonition",{parentName:"li",type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"After setting up ",(0,r.kt)("strong",{parentName:"p"},"NGINX"),", for security purposes, you need to disable port access on ",(0,r.kt)("inlineCode",{parentName:"p"},"Port 1337"),". You may do this easily from your ",(0,r.kt)("strong",{parentName:"p"},"EC2 Dashboard"),". In ",(0,r.kt)("inlineCode",{parentName:"p"},"Security Groups")," (left-hand menu), click the checkbox of the group, eg. ",(0,r.kt)("inlineCode",{parentName:"p"},"strapi"),", and below in the ",(0,r.kt)("inlineCode",{parentName:"p"},"inbound")," tab, click ",(0,r.kt)("inlineCode",{parentName:"p"},"Edit"),", and delete the rule for ",(0,r.kt)("inlineCode",{parentName:"p"},"Port Range")," : ",(0,r.kt)("inlineCode",{parentName:"p"},"1337")," by click the ",(0,r.kt)("inlineCode",{parentName:"p"},"x"),"."))),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"To ",(0,r.kt)("strong",{parentName:"p"},"install SSL"),", you will need to ",(0,r.kt)("a",{parentName:"p",href:"https://certbot.eff.org/docs/using.html"},"install and run Certbot by Let's Encrypt"),".")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("p",{parentName:"li"},"Set-up ",(0,r.kt)("a",{parentName:"p",href:"https://www.digitalocean.com/community/tutorials/how-to-configure-nginx-as-a-reverse-proxy-on-ubuntu-22-04"},"Nginx with HTTP/2 Support")," for Ubuntu 22.04."))),(0,r.kt)("p",null,"Your ",(0,r.kt)("inlineCode",{parentName:"p"},"Strapi")," project has been installed on an ",(0,r.kt)("strong",{parentName:"p"},"AWS EC2 instance")," using ",(0,r.kt)("strong",{parentName:"p"},"Ubuntu 22.04"),"."))}g.isMDXComponent=!0},14188:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>s,contentTitle:()=>i,default:()=>m,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var a=n(83117),r=(n(67294),n(3905));const o={},i=void 0,l={unversionedId:"snippets/consider-strapi-cloud",id:"snippets/consider-strapi-cloud",title:"consider-strapi-cloud",description:"You can also use Strapi Cloud to quickly deploy and host your project.",source:"@site/docs/snippets/consider-strapi-cloud.md",sourceDirName:"snippets",slug:"/snippets/consider-strapi-cloud",permalink:"/aberabook/snippets/consider-strapi-cloud",draft:!1,editUrl:"https://github.com/labs-solo/aberabook/edit/main/docusaurus/docs/snippets/consider-strapi-cloud.md",tags:[],version:"current",frontMatter:{}},s={},p=[],u={toc:p};function m(e){let{components:t,...n}=e;return(0,r.kt)("wrapper",(0,a.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,r.kt)("admonition",{title:"\u2601\ufe0f Strapi Cloud",type:"callout"},(0,r.kt)("p",{parentName:"admonition"},"You can also use ",(0,r.kt)("a",{parentName:"p",href:"/cloud/intro"},"Strapi Cloud")," to quickly deploy and host your project.")))}m.isMDXComponent=!0}}]);